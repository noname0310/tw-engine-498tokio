(()=>{var t={841:function(t,e,i){var s,r,n;!function(h,a){"use strict";r=[e,i(732)],void 0!==(n="function"==typeof(s=function(t,e){var i={AENC:"Audio encryption",APIC:"Attached picture",CHAP:"Chapter",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVAD:"Relative volume adjustment",RVRB:"Reverb",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMED:"Media type",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},s={T:function(t,i,s){var r={encoding:t.getUint8(i)};return r.value=e.readStr[0===r.encoding?"iso":"ucs"](t,i+1,s-1),r},TXXX:function(t,i,s){var r={encoding:t.getUint8(i)};if(s<2)return r;var n=0===r.encoding?"iso":"ucs",h=i+1,a=e.locateStrTrm[n](t,h,s-4);return-1===a||(r.description=e.readStr[n](t,h,a-h),a+="ucs"===n?2:1,r.value=e.readStr[n](t,a,i+s-a)),r},W:function(t,i,s){return{value:e.readStr.iso(t,i,s)}},WXXX:function(t,i,s){var r={encoding:t.getUint8(i)};if(s<2)return r;var n=0===r.encoding?"iso":"ucs",h=i+1,a=e.locateStrTrm[n](t,h,s-4);return-1===a||(r.description=e.readStr[n](t,h,a-h),a+="ucs"===n?2:1,r.value=e.readStr.iso(t,a,i+s-a)),r},COMM:function(t,i,s){var r={encoding:t.getUint8(i)};if(s<5)return r;var n=0===r.encoding?"iso":"ucs",h=i+4;r.language=e.readTrmStr.iso(t,i+1,3);var a=e.locateStrTrm[n](t,h,s-4);return-1===a||(r.description=e.readStr[n](t,h,a-h),a+="ucs"===n?2:1,r.text=e.readStr[n](t,a,i+s-a)),r},UFID:function(t,i,s){var r=e.readTrmStr.iso(t,i,s);return{ownerIdentifier:r,identifier:new DataView(t.buffer,i+r.length+1,s-r.length-1)}},IPLS:function(t,i,s){for(var r,n={encoding:t.getUint8(i),values:[]},h=0===n.encoding?"iso":"ucs",a=i+1;a<i+s;)-1===(r=e.locateStrTrm[h](t,a,s-(a-i)))&&(r=i+s),n.values.push(e.readStr[h](t,a,r-a)),a=r+("ucs"===h?2:1);return n},USER:function(t,i,s){var r={encoding:t.getUint8(i)};if(s<5)return r;r.language=e.readTrmStr.iso(t,i+1,3);var n=i+4,h=0===r.encoding?"iso":"ucs";return r.text=e.readStr[h](t,n,i+s-n),r},PRIV:function(t,i,s){var r=e.readTrmStr.iso(t,i,s);return{ownerIdentifier:r,privateData:new DataView(t.buffer,i+r.length+1,s-r.length-1)}},PCNT:function(t,e,i){return i<4?{}:{counter:t.getUint32(e)}},POPM:function(t,i,s){var r={email:e.readTrmStr.iso(t,i,s)};return i+=r.email.length+1,s<6||(r.rating=t.getUint8(i),r.counter=t.getUint32(i+1)),r},APIC:function(t,i,s){var r={encoding:t.getUint8(i)};if(s<4)return r;var n,h,a=0===r.encoding?"iso":"ucs";return n=i+1,-1===(h=e.locateStrTrm.iso(t,n,s-1))||(r.mimeType=e.readStr.iso(t,n,h-n),n=h+1,r.pictureType=t.getUint8(n),n+=1,-1===(h=e.locateStrTrm[a](t,n,i+s-n))||(r.description=e.readStr[a](t,n,h-n),n=h+("ucs"===a?2:1),r.pictureData=new DataView(t.buffer,n,i+s-n))),r},CHAP:function(i,s,r){var n={encoding:i.getUint8(s)},h=e.locateStrTrm.iso(i,s,r-1);if(-1===h)return n;n.id=e.readStr.iso(i,s,h-s),n.startTime=i.getUint32(h+1),n.endTime=i.getUint32(h+5),n.startOffset=i.getUint32(h+9),n.endOffset=i.getUint32(h+13);var a=h+17;for(n.frames=[];a<s+r;){var o=t.readId3v2TagFrame(i,a);n.frames.push(o),a+=o.header.size+10}return n}};t.readId3v2TagFrame=function(t,r){var n={header:{id:e.readStr.iso(t,r,4),size:t.getUint32(r+4),flagsOctet1:t.getUint8(r+8),flagsOctet2:t.getUint8(r+9)}};if(n.header.size<1)return n;var h,a,o=(h=s,"TXXX"===(a=n.header.id)?h.TXXX:"T"===a.charAt(0)?h.T:"WXXX"===a?h.WXXX:"W"===a.charAt(0)?h.W:"COMM"===a||"USLT"===a?h.COMM:h[a]||e.noOp);return n.name=i[n.header.id],n.content=o(t,r+10,n.header.size),n},t.readId3v2Tag=function(i,s){if(s||(s=0),i.byteLength-s<10)return null;if(!e.isSeq(e.seq.id3,i,s))return null;var r=i.getUint8(s+5),n={_section:{type:"ID3v2",offset:s},header:{majorVersion:i.getUint8(s+3),minorRevision:i.getUint8(s+4),flagsOctet:r,unsynchronisationFlag:128==(128&r),extendedHeaderFlag:64==(64&r),experimentalIndicatorFlag:32==(32&r),size:e.unsynchsafe(i.getUint32(s+6))},frames:[]};n._section.byteLength=n.header.size+10;var h,a=s+n._section.byteLength;if(3!==n.header.majorVersion)return n;for(s+=10;s<a&&0!==i.getUint32(s)&&(h=t.readId3v2TagFrame(i,s));)n.frames.push(h),s+=h.header.size+10;return n}})?s.apply(e,r):s)&&(t.exports=n)}()},732:function(t,e){var i,s,r;!function(n,h){"use strict";s=[e],void 0!==(r="function"==typeof(i=function(t){var e,i=(e=[],function(t){return e[0]=128==(128&t)?"1":"0",e[1]=64==(64&t)?"1":"0",e[2]=32==(32&t)?"1":"0",e[3]=16==(16&t)?"1":"0",e[4]=8==(8&t)?"1":"0",e[5]=4==(4&t)?"1":"0",e[6]=2==(2&t)?"1":"0",e[7]=1==(1&t)?"1":"0",e.join("")});t.getFrameByteLength=function(e,i,s,r,n){var h=t.sampleLengthMap[r][n],a=s?"11"===n?4:1:0,o=1e3*e/8;return Math.floor(h*o/i+a)},t.getXingOffset=function(t,e){var i="11"===e;return"11"===t?i?21:36:i?13:21},t.v1l1Bitrates={"0000":"free","0001":32,"0010":64,"0011":96,"0100":128,"0101":160,"0110":192,"0111":224,1e3:256,1001:288,1010:320,1011:352,1100:384,1101:416,1110:448,1111:"bad"},t.v1l2Bitrates={"0000":"free","0001":32,"0010":48,"0011":56,"0100":64,"0101":80,"0110":96,"0111":112,1e3:128,1001:160,1010:192,1011:224,1100:256,1101:320,1110:384,1111:"bad"},t.v1l3Bitrates={"0000":"free","0001":32,"0010":40,"0011":48,"0100":56,"0101":64,"0110":80,"0111":96,1e3:112,1001:128,1010:160,1011:192,1100:224,1101:256,1110:320,1111:"bad"},t.v2l1Bitrates={"0000":"free","0001":32,"0010":48,"0011":56,"0100":64,"0101":80,"0110":96,"0111":112,1e3:128,1001:144,1010:160,1011:176,1100:192,1101:224,1110:256,1111:"bad"},t.v2l2Bitrates={"0000":"free","0001":8,"0010":16,"0011":24,"0100":32,"0101":40,"0110":48,"0111":56,1e3:64,1001:80,1010:96,1011:112,1100:128,1101:144,1110:160,1111:"bad"},t.v2l3Bitrates=t.v2l2Bitrates,t.v1SamplingRates={"00":44100,"01":48e3,10:32e3,11:"reserved"},t.v2SamplingRates={"00":22050,"01":24e3,10:16e3,11:"reserved"},t.v25SamplingRates={"00":11025,"01":12e3,10:8e3,11:"reserved"},t.channelModes={"00":"Stereo","01":"Joint stereo (Stereo)",10:"Dual channel (Stereo)",11:"Single channel (Mono)"},t.mpegVersionDescription={"00":"MPEG Version 2.5 (unofficial)","01":"reserved",10:"MPEG Version 2 (ISO/IEC 13818-3)",11:"MPEG Version 1 (ISO/IEC 11172-3)"},t.layerDescription={"00":"reserved","01":"Layer III",10:"Layer II",11:"Layer I"},t.bitrateMap={11:{"01":t.v1l3Bitrates,10:t.v1l2Bitrates,11:t.v1l1Bitrates},10:{"01":t.v2l3Bitrates,10:t.v2l2Bitrates,11:t.v2l1Bitrates}},t.samplingRateMap={"00":t.v25SamplingRates,10:t.v2SamplingRates,11:t.v1SamplingRates},t.v1SampleLengths={"01":1152,10:1152,11:384},t.v2SampleLengths={"01":576,10:1152,11:384},t.sampleLengthMap={"01":t.v2SampleLengths,10:t.v2SampleLengths,11:t.v1SampleLengths},t.wordSeqFromStr=function(t){for(var e=t.length-1,i=[];e>=0;--e)i[e]=t.charCodeAt(e);return i},t.seq={id3:t.wordSeqFromStr("ID3"),xing:t.wordSeqFromStr("Xing"),info:t.wordSeqFromStr("Info")},t.noOp=function(){},t.unsynchsafe=function(t){for(var e=0,i=2130706432;i;)e>>=1,e|=t&i,i>>=8;return e},t.isSeq=function(t,e,i){for(var s=t.length-1;s>=0;s--)if(t[s]!==e.getUint8(i+s))return!1;return!0},t.locateSeq=function(e,i,s,r){for(var n=0,h=r-e.length+1;n<h;++n)if(t.isSeq(e,i,s+n))return s+n;return-1},t.locateStrTrm={iso:function(e,i,s){return t.locateSeq([0],e,i,s)},ucs:function(e,i,s){var r=t.locateSeq([0,0],e,i,s);return-1===r?-1:((r-i)%2!=0&&++r,r)}},t.readStr={iso:function(t,e,i){return String.fromCharCode.apply(null,new Uint8Array(t.buffer,e,i))},ucs:function(t,e,i){65534!==t.getUint16(e)&&65279!==t.getUint16(e)||(e+=2,i-=2);var s=t.buffer;return e%2==1&&(s=s.slice(e,e+i),e=0),String.fromCharCode.apply(null,new Uint16Array(s,e,i/2))}},t.readTrmStr={iso:function(e,i,s){var r=t.locateStrTrm.iso(e,i,s);return-1!==r&&(s=r-i),t.readStr.iso(e,i,s)},ucs:function(e,i,s){var r=t.locateStrTrm.ucs(e,i,s);return-1!==r&&(s=r-i),t.readStr.ucs(e,i,s)}},t.readFrameHeader=function(e,s){if(s||(s=0),e.byteLength-s<=4)return null;if(255!==e.getUint8(s))return null;var r=e.getUint8(s+1);if(r<224)return null;var n=i(r).substr(3,2),h=i(r).substr(5,2),a={_section:{type:"frameHeader",byteLength:4,offset:s},mpegAudioVersionBits:n,mpegAudioVersion:t.mpegVersionDescription[n],layerDescriptionBits:h,layerDescription:t.layerDescription[h],isProtected:1&r};if(a.protectionBit=a.isProtected?"1":"0","reserved"===a.mpegAudioVersion)return null;if("reserved"===a.layerDescription)return null;var o=e.getUint8(s+2);if(o=i(o),a.bitrateBits=o.substr(0,4),a.bitrate=t.bitrateMap[n][h][a.bitrateBits],"bad"===a.bitrate)return null;if(a.samplingRateBits=o.substr(4,2),a.samplingRate=t.samplingRateMap[n][a.samplingRateBits],"reserved"===a.samplingRate)return null;a.frameIsPaddedBit=o.substr(6,1),a.frameIsPadded="1"===a.frameIsPaddedBit,a.framePadding=a.frameIsPadded?1:0,a.privateBit=o.substr(7,1);var l=e.getUint8(s+3);return a.channelModeBits=i(l).substr(0,2),a.channelMode=t.channelModes[a.channelModeBits],a},t.readFrame=function(e,i,s){i||(i=0);var r={_section:{type:"frame",offset:i},header:t.readFrameHeader(e,i)},n=r.header;if(!n)return null;r._section.sampleLength=t.sampleLengthMap[n.mpegAudioVersionBits][n.layerDescriptionBits],r._section.byteLength=t.getFrameByteLength(n.bitrate,n.samplingRate,n.framePadding,n.mpegAudioVersionBits,n.layerDescriptionBits),r._section.nextFrameIndex=i+r._section.byteLength;var h=t.getXingOffset(n.mpegAudioVersionBits,n.channelModeBits);return t.isSeq(t.seq.xing,e,i+h)||t.isSeq(t.seq.info,e,i+h)||s&&!t.readFrameHeader(e,r._section.nextFrameIndex)?null:r}})?i.apply(e,s):i)&&(t.exports=r)}()},395:function(t,e,i){var s,r,n;!function(h,a){"use strict";r=[e,i(732)],void 0!==(n="function"==typeof(s=function(t,e){t.readXingTag=function(t,i){i||(i=0);var s={_section:{type:"Xing",offset:i},header:e.readFrameHeader(t,i)},r=s.header;if(!r)return null;var n=i+e.getXingOffset(r.mpegAudioVersionBits,r.channelModeBits);return t.byteLength<n+4?null:(s.identifier=e.isSeq(e.seq.xing,t,n)?"Xing":e.isSeq(e.seq.info,t,n)&&"Info",s.identifier?(s._section.byteLength=e.getFrameByteLength(r.bitrate,r.samplingRate,r.framePadding,r.mpegAudioVersionBits,r.layerDescriptionBits),s._section.nextFrameIndex=i+s._section.byteLength,s):null)}})?s.apply(e,r):s)&&(t.exports=n)}()},769:function(t,e,i){var s,r,n;!function(h,a){"use strict";r=[e,i(732),i(841),i(395)],void 0!==(n="function"==typeof(s=function(t,e,i,s){t.readFrameHeader=function(t,i){return e.readFrameHeader(t,i)},t.readFrame=function(t,i,s){return e.readFrame(t,i,s)},t.readLastFrame=function(e,i,s){i||(i=e.byteLength-1);for(var r=null;i>=0;--i)if(255===e.getUint8(i)&&(r=t.readFrame(e,i,s)))return r;return null},t.readId3v2Tag=function(t,e){return i.readId3v2Tag(t,e)},t.readXingTag=function(t,e){return s.readXingTag(t,e)},t.readTags=function(e,i){i||(i=0);for(var s=[],r=null,n=!1,h=e.byteLength,a=[t.readId3v2Tag,t.readXingTag,t.readFrame],o=a.length;i<h&&!n;++i)for(var l=0;l<o;++l)if(r=a[l](e,i)){if(s.push(r),i+=r._section.byteLength,"frame"===r._section.type){n=!0;break}l=-1}return s}})?s.apply(e,r):s)&&(t.exports=n)}()}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var s=e.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{"use strict";const t=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],e=Math.PI/180,s=180/Math.PI;function r(t,e,i){return Math.max(e,Math.min(i,t))}function n(t,e,i){return(1-i)*t+i*e}const h="srgb",a="srgb-linear";function o(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function l(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const c={[h]:{[a]:o},[a]:{[h]:l}},u={legacyMode:!0,get workingColorSpace(){return a},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(c[e]&&void 0!==c[e][i]){const s=c[e][i];return t.r=s(t.r),t.g=s(t.g),t.b=s(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},d={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},m={r:0,g:0,b:0},p={h:0,s:0,l:0},f={h:0,s:0,l:0};function g(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function y(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class _{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e="srgb"){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,u.toWorkingColorSpace(this,e),this}setRGB(t,e,i,s="srgb-linear"){return this.r=t,this.g=e,this.b=i,u.toWorkingColorSpace(this,s),this}setHSL(t,e,i,s="srgb-linear"){if(t=(t%(n=1)+n)%n,e=r(e,0,1),i=r(i,0,1),0===e)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,r=2*i-s;this.r=g(r,s,t+1/3),this.g=g(r,s,t),this.b=g(r,s,t-1/3)}var n;return u.toWorkingColorSpace(this,s),this}setStyle(t,e="srgb"){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=s[1],n=s[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,u.toWorkingColorSpace(this,e),i(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,u.toWorkingColorSpace(this,e),i(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){const s=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100;return i(t[4]),this.setHSL(s,r,n,e)}}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=s[1],i=t.length;if(3===i)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,u.toWorkingColorSpace(this,e),this;if(6===i)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,u.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e="srgb"){const i=d[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=o(t.r),this.g=o(t.g),this.b=o(t.b),this}copyLinearToSRGB(t){return this.r=l(t.r),this.g=l(t.g),this.b=l(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t="srgb"){return u.fromWorkingColorSpace(y(this,m),t),r(255*m.r,0,255)<<16^r(255*m.g,0,255)<<8^r(255*m.b,0,255)<<0}getHexString(t="srgb"){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e="srgb-linear"){u.fromWorkingColorSpace(y(this,m),e);const i=m.r,s=m.g,r=m.b,n=Math.max(i,s,r),h=Math.min(i,s,r);let a,o;const l=(h+n)/2;if(h===n)a=0,o=0;else{const t=n-h;switch(o=l<=.5?t/(n+h):t/(2-n-h),n){case i:a=(s-r)/t+(s<r?6:0);break;case s:a=(r-i)/t+2;break;case r:a=(i-s)/t+4}a/=6}return t.h=a,t.s=o,t.l=l,t}getRGB(t,e="srgb-linear"){return u.fromWorkingColorSpace(y(this,m),e),t.r=m.r,t.g=m.g,t.b=m.b,t}getStyle(t="srgb"){return u.fromWorkingColorSpace(y(this,m),t),t!==h?`color(${t} ${m.r} ${m.g} ${m.b})`:`rgb(${255*m.r|0},${255*m.g|0},${255*m.b|0})`}offsetHSL(t,e,i){return this.getHSL(p),p.h+=t,p.s+=e,p.l+=i,this.setHSL(p.h,p.s,p.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(p),t.getHSL(f);const i=n(p.h,f.h,e),s=n(p.s,f.s,e),r=n(p.l,f.l,e);return this.setHSL(i,s,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}_.NAMES=d;class b{}class v extends b{static get instance(){return v._instance}}v._instance=new v;class w extends b{constructor(t){super(),this.Et=t}get seconds(){return this.Et}}class x extends b{constructor(t){super(),this.wt=t}get predicate(){return this.wt}}class C extends b{constructor(t){super(),this.wt=t}get predicate(){return this.wt}}class S{constructor(t){this.h=t,this.Wt=[],this.Ft=0}addCoroutine(t){this.Wt.push(t),this.Ft+=1}removeCoroutine(t){const e=this.Wt.indexOf(t);e>=0&&(this.Wt[e]=null,this.Ft-=1)}tryCompact(){const t=this.Wt;if(S._needToCompactCount<=t.length-this.Ft){let e=0;for(let i=0;i<t.length;++i){const s=t[i];null!==s&&(t[e]=s,e+=1)}t.length=this.Ft}}updateAfterProcess(){const t=this.Wt;for(let e=0;e<t.length;++e){const i=t[e];null!=i&&(i.currentYieldInstructionExist?this.Pt(i):(t[e]=null,this.Ft-=1))}}Pt(t){const e=t.currentYieldInstruction;e instanceof w?(t.elapsedTime+=this.h.deltaTime,t.elapsedTime>=e.seconds&&(t.elapsedTime=0,t.fatchNextInstruction())):e instanceof x?e.predicate()&&t.fatchNextInstruction():e instanceof C?e.predicate()||t.fatchNextInstruction():null===e&&t.fatchNextInstruction()}endFrameAfterProcess(){const t=this.Wt;for(let e=0;e<t.length;++e){const i=t[e];null!=i&&(i.currentYieldInstructionExist?this.Ct(i):(t[e]=null,this.Ft-=1))}}Ct(t){t.currentYieldInstruction instanceof v&&t.fatchNextInstruction()}}S._needToCompactCount=16;class E{constructor(t){this.next=null,this.prev=null,this.value=t}}class M{constructor(){this.st=!1,this.et=null,this.lt=null,this.ht=0}get length(){return this.ht}add(t){const e=new E(t);null===this.et?(this.et=e,this.lt=e):(this.lt.next=e,e.prev=this.lt,this.lt=e),this.ht++}nt(t){null!==t.prev?t.prev.next=t.next:this.et=t.next,null!==t.next?t.next.prev=t.prev:this.lt=t.prev,this.ht--}remove(t){let e=this.et;for(;null!==e;){if(e.value===t)return void this.nt(e);e=e.next}}removeAll(){this.et=null,this.lt=null,this.ht=0,this.st=!0}forEach(t){this.st=!1;let e=this.et;for(;null!==e;)if(t(e.value),this.st){if(null===this.et)return;e=this.et,this.st=!1}else e=e.next}}class T{constructor(){this.rt=new M}addListener(t){this.rt.add(t)}removeListener(t){this.rt.remove(t)}removeAllListeners(){this.rt.removeAll()}invoke(...t){this.rt.forEach((e=>{e(...t)}))}get length(){return this.rt.length}}class k{constructor(t){this.Ks=new T,this.ks=new T,this.Hs=new T,this.Is=new T,this.Xs=new T,this.Ys=new T,this.zs=new T,this.Gs=new T,this.Js=!1,this.Zs=null,this.$s=null,this.ue=null,this.we=t=>{const e=1===t.key.length?t.key.toLowerCase():t.key;this.ve.set(e,!0),this.Ks.invoke(t)},this.me=t=>{const e=1===t.key.length?t.key.toLowerCase():t.key;this.ve.set(e,!1),this.ks.invoke(t)},this.de=t=>{this.Hs.invoke(t)},this.pe=t=>{this.$s=t,this.Is.invoke(t)},this.Ee=t=>{this.$s=null,this.Xs.invoke(t)},this.ge=t=>{this.ue=t,this.Ys.invoke(t)},this.ye=t=>{this.ue=null,this.zs.invoke(t)},this.Ce=t=>{this.$s=t,this.Gs.invoke(t)},this.Ke=t=>{this.Zs=()=>{this.be("mouseenter",t.touches[0]),this.be("mousedown",t.touches[0])}},this.Pe=t=>{this.Js&&(this.Js=!1,this.be("mouseup",t.changedTouches[0]),this.be("mouseleave",t.changedTouches[0]))},this.ke=t=>{this.Zs&&(this.Zs(),this.Zs=null),this.be("mousemove",t.touches[0]),this.Js=!0},this.He=t=>{this.Js&&(this.Js=!1,this.be("mouseleave",t.changedTouches[0]))},this.ve=new Map,this.F=!1,this.Me=t}get map(){return this.ve}dispose(){this.stopHandleEvents(),this.F=!0}startHandleEvents(){if(this.F)throw new Error("InputHandler is disposed.");window.addEventListener("keydown",this.we),window.addEventListener("keyup",this.me),window.addEventListener("wheel",this.de),this.Me.addEventListener("mousedown",this.pe),this.Me.addEventListener("mouseup",this.Ee),this.Me.addEventListener("mouseenter",this.ge),this.Me.addEventListener("mouseleave",this.ye),this.Me.addEventListener("mousemove",this.Ce),this.Me.addEventListener("touchstart",this.Ke),this.Me.addEventListener("touchend",this.Pe),this.Me.addEventListener("touchmove",this.ke),this.Me.addEventListener("touchcancel",this.He)}stopHandleEvents(){this.$s&&this.Ee(this.$s),this.ue&&this.ye(this.ue),this.ve.clear(),window.removeEventListener("keydown",this.we),window.removeEventListener("keyup",this.me),window.removeEventListener("wheel",this.de),this.Me.removeEventListener("mousedown",this.pe),this.Me.removeEventListener("mouseup",this.Ee),this.Me.removeEventListener("mouseenter",this.ge),this.Me.removeEventListener("mouseleave",this.ye),this.Me.removeEventListener("mousemove",this.Ce),this.Me.removeEventListener("touchstart",this.Ke),this.Me.removeEventListener("touchend",this.Pe),this.Me.removeEventListener("touchmove",this.ke),this.Me.removeEventListener("touchcancel",this.He)}be(t,e){const i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});e.target.dispatchEvent(i)}get onKeyDown(){return this.Ks}get onKeyUp(){return this.ks}get onWheel(){return this.Hs}get onPointerDown(){return this.Is}get onPointerUp(){return this.Xs}get onPointerEnter(){return this.Ys}get onPointerLeave(){return this.zs}get onPointerMove(){return this.Gs}}var O,D=(O=function(t,e){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},O(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new A("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}O(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});function j(t,e){return function(i){function s(s){void 0===s&&(s=e);var r=i.call(this,s)||this;return r.name=t,r}return D(s,i),s}(Error)}j("TestError","test error");var I,A=j("TypeError","type error"),z=j("RunTimeError","access out of bounds"),R=j("InternalError","internal error"),P=j("NullValueError","you can not set null value here"),W=(j("ContainerInitError","container init failed"),function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}()),F=function(){function t(){this.length=0}return t.prototype.size=function(){return this.length},t.prototype.empty=function(){return 0===this.length},t}();function B(t,e,i){if(t<e||t>i)throw new z}W((function(){return null!==I&&I.apply(this,arguments)||this}),I=F);const N=function(){function t(t,e){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=t,this.value=e}return t.prototype.rotateLeft=function(){var t=this.parent,e=this.brother,i=this.leftChild,s=this.rightChild,r=s.leftChild,n=s.rightChild;return t&&void 0!==t.key&&(t.leftChild===this?t.leftChild=s:t.rightChild===this&&(t.rightChild=s)),s.parent=t,s.brother=e,s.leftChild=this,s.rightChild=n,e&&(e.brother=s),this.parent=s,this.brother=n,this.leftChild=i,this.rightChild=r,n&&(n.parent=s,n.brother=this),i&&(i.parent=this,i.brother=r),r&&(r.parent=this,r.brother=i),s},t.prototype.rotateRight=function(){var t=this.parent,e=this.brother,i=this.leftChild,s=this.rightChild,r=i.leftChild,n=i.rightChild;return t&&void 0!==t.key&&(t.leftChild===this?t.leftChild=i:t.rightChild===this&&(t.rightChild=i)),i.parent=t,i.brother=e,i.leftChild=r,i.rightChild=this,e&&(e.brother=i),r&&(r.parent=i,r.brother=this),this.parent=i,this.brother=r,this.leftChild=n,this.rightChild=s,n&&(n.parent=this,n.brother=s),s&&(s.parent=this,s.brother=n),i},t.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new R("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},t.TreeNodeColorType={red:!0,black:!1},t}();var L=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),V=function(t){function e(e){void 0===e&&(e=function(t,e){return t<e?-1:t>e?1:0});var i=t.call(this)||this;return i.root=new N,i.header=new N,i.findSubTreeMinNode=function(t){return t.leftChild?i.findSubTreeMinNode(t.leftChild):t},i.findSubTreeMaxNode=function(t){return t.rightChild?i.findSubTreeMaxNode(t.rightChild):t},i._lowerBound=function(t,e){if(t&&void 0!==t.key){var s=i.cmp(t.key,e);if(0===s)return t;if(s<0)return i._lowerBound(t.rightChild,e);var r=i._lowerBound(t.leftChild,e);return void 0===r?t:r}},i._upperBound=function(t,e){if(t&&void 0!==t.key){if(i.cmp(t.key,e)<=0)return i._upperBound(t.rightChild,e);var s=i._upperBound(t.leftChild,e);return void 0===s?t:s}},i._reverseLowerBound=function(t,e){if(t&&void 0!==t.key){var s=i.cmp(t.key,e);if(0===s)return t;if(s>0)return i._reverseLowerBound(t.leftChild,e);var r=i._reverseLowerBound(t.rightChild,e);return void 0===r?t:r}},i._reverseUpperBound=function(t,e){if(t&&void 0!==t.key){if(i.cmp(t.key,e)>=0)return i._reverseUpperBound(t.leftChild,e);var s=i._reverseUpperBound(t.rightChild,e);return void 0===s?t:s}},i.inOrderTraversal=function(t,e){return!(!t||void 0===t.key)&&(!!i.inOrderTraversal(t.leftChild,e)||!!e(t)||i.inOrderTraversal(t.rightChild,e))},i.findInsertPos=function(t,e){if(!t||void 0===t.key)throw new R;var s=i.cmp(e,t.key);return s<0?t.leftChild?i.findInsertPos(t.leftChild,e):(t.leftChild=new N,t.leftChild.parent=t,t.leftChild.brother=t.rightChild,t.rightChild&&(t.rightChild.brother=t.leftChild),t.leftChild):s>0?t.rightChild?i.findInsertPos(t.rightChild,e):(t.rightChild=new N,t.rightChild.parent=t,t.rightChild.brother=t.leftChild,t.leftChild&&(t.leftChild.brother=t.rightChild),t.rightChild):t},i.findElementNode=function(t,e){if(t&&void 0!==t.key){var s=i.cmp(e,t.key);return s<0?i.findElementNode(t.leftChild,e):s>0?i.findElementNode(t.rightChild,e):t}},i.root.color=N.TreeNodeColorType.black,i.header.parent=i.root,i.root.parent=i.header,i.cmp=e,i}return L(e,t),e.prototype.eraseNodeSelfBalance=function(t){var e=t.parent;if(!e||e===this.header){if(t===this.root)return;throw new R}if(t.color!==N.TreeNodeColorType.red){var i=t.brother;if(!i)throw new R;if(t===e.leftChild)if(i.color===N.TreeNodeColorType.red){i.color=N.TreeNodeColorType.black,e.color=N.TreeNodeColorType.red;var s=e.rotateLeft();this.root===e&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),this.eraseNodeSelfBalance(t)}else i.color===N.TreeNodeColorType.black&&(i.rightChild&&i.rightChild.color===N.TreeNodeColorType.red?(i.color=e.color,e.color=N.TreeNodeColorType.black,i.rightChild&&(i.rightChild.color=N.TreeNodeColorType.black),s=e.rotateLeft(),this.root===e&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),t.color=N.TreeNodeColorType.black):i.rightChild&&i.rightChild.color!==N.TreeNodeColorType.black||!i.leftChild||i.leftChild.color!==N.TreeNodeColorType.red?i.leftChild&&i.leftChild.color!==N.TreeNodeColorType.black||i.rightChild&&i.rightChild.color!==N.TreeNodeColorType.black||(i.color=N.TreeNodeColorType.red,this.eraseNodeSelfBalance(e)):(i.color=N.TreeNodeColorType.red,i.leftChild&&(i.leftChild.color=N.TreeNodeColorType.black),s=i.rotateRight(),this.root===i&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),this.eraseNodeSelfBalance(t)));else t===e.rightChild&&(i.color===N.TreeNodeColorType.red?(i.color=N.TreeNodeColorType.black,e.color=N.TreeNodeColorType.red,s=e.rotateRight(),this.root===e&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),this.eraseNodeSelfBalance(t)):i.color===N.TreeNodeColorType.black&&(i.leftChild&&i.leftChild.color===N.TreeNodeColorType.red?(i.color=e.color,e.color=N.TreeNodeColorType.black,i.leftChild&&(i.leftChild.color=N.TreeNodeColorType.black),s=e.rotateRight(),this.root===e&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),t.color=N.TreeNodeColorType.black):i.leftChild&&i.leftChild.color!==N.TreeNodeColorType.black||!i.rightChild||i.rightChild.color!==N.TreeNodeColorType.red?i.leftChild&&i.leftChild.color!==N.TreeNodeColorType.black||i.rightChild&&i.rightChild.color!==N.TreeNodeColorType.black||(i.color=N.TreeNodeColorType.red,this.eraseNodeSelfBalance(e)):(i.color=N.TreeNodeColorType.red,i.rightChild&&(i.rightChild.color=N.TreeNodeColorType.black),s=i.rotateLeft(),this.root===i&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),this.eraseNodeSelfBalance(t))))}else t.color=N.TreeNodeColorType.black},e.prototype.eraseNode=function(t){for(var e,i,s,r,n,h,a=t;a.leftChild||a.rightChild;){if(a.rightChild){a=this.findSubTreeMinNode(a.rightChild);var o=t.key;t.key=a.key,a.key=o;var l=t.value;t.value=a.value,a.value=l,t=a}a.leftChild&&(a=this.findSubTreeMaxNode(a.leftChild),o=t.key,t.key=a.key,a.key=o,l=t.value,t.value=a.value,a.value=l,t=a)}if(void 0===a.key)throw new R;this.header.leftChild&&void 0!==this.header.leftChild.key&&0===this.cmp(this.header.leftChild.key,a.key)&&(this.header.leftChild!==this.root?this.header.leftChild=null===(e=this.header.leftChild)||void 0===e?void 0:e.parent:(null===(i=this.header.leftChild)||void 0===i?void 0:i.rightChild)?this.header.leftChild=null===(s=this.header.leftChild)||void 0===s?void 0:s.rightChild:this.header.leftChild=void 0),this.header.rightChild&&void 0!==this.header.rightChild.key&&0===this.cmp(this.header.rightChild.key,a.key)&&(this.header.rightChild!==this.root?this.header.rightChild=null===(r=this.header.rightChild)||void 0===r?void 0:r.parent:(null===(n=this.header.rightChild)||void 0===n?void 0:n.leftChild)?this.header.rightChild=null===(h=this.header.rightChild)||void 0===h?void 0:h.leftChild:this.header.rightChild=void 0),this.eraseNodeSelfBalance(a),a&&a.remove(),--this.length,this.root.color=N.TreeNodeColorType.black},e.prototype.insertNodeSelfBalance=function(t){var e=t.parent;if(!e||e===this.header){if(t===this.root)return;throw new R}if(e.color!==N.TreeNodeColorType.black&&e.color===N.TreeNodeColorType.red){var i=e.brother,s=e.parent;if(!s)throw new R;if(i&&i.color===N.TreeNodeColorType.red)i.color=e.color=N.TreeNodeColorType.black,s.color=N.TreeNodeColorType.red,this.insertNodeSelfBalance(s);else if(!i||i.color===N.TreeNodeColorType.black)if(e===s.leftChild)if(t===e.leftChild){e.color=N.TreeNodeColorType.black,s.color=N.TreeNodeColorType.red;var r=s.rotateRight();s===this.root&&(this.root=r,this.header.parent=this.root,this.root.parent=this.header)}else t===e.rightChild&&(r=e.rotateLeft(),e===this.root&&(this.root=r,this.header.parent=this.root,this.root.parent=this.header),this.insertNodeSelfBalance(e));else e===s.rightChild&&(t===e.leftChild?(r=e.rotateRight(),e===this.root&&(this.root=r,this.header.parent=this.root,this.root.parent=this.header),this.insertNodeSelfBalance(e)):t===e.rightChild&&(e.color=N.TreeNodeColorType.black,s.color=N.TreeNodeColorType.red,r=s.rotateLeft(),s===this.root&&(this.root=r,this.header.parent=this.root,this.root.parent=this.header)))}},e.prototype.clear=function(){this.length=0,this.root.key=this.root.value=void 0,this.root.leftChild=this.root.rightChild=this.root.brother=void 0,this.header.leftChild=this.header.rightChild=void 0},e.prototype.eraseElementByPos=function(t){var e=this;B(t,0,this.length-1);var i=0;this.inOrderTraversal(this.root,(function(s){return t===i?(e.eraseNode(s),!0):(++i,!1)}))},e.prototype.eraseElementByKey=function(t){if(!this.empty()){var e=this.findElementNode(this.root,t);void 0!==e&&void 0!==e.key&&0===this.cmp(e.key,t)&&this.eraseNode(e)}},e.prototype.getHeight=function(){if(this.empty())return 0;var t=function(e){return e?Math.max(t(e.leftChild),t(e.rightChild))+1:1};return t(this.root)},e}(F);const q=V;var H=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),G=function(t){function e(e,i,s){var r=t.call(this,e,s)||this;return r.header=i,r}return H(e,t),e.prototype._pre=function(){var t,e=this.node;if(e.color===N.TreeNodeColorType.red&&(null===(t=e.parent)||void 0===t?void 0:t.parent)===e)e=e.rightChild;else if(e.leftChild)for(e=e.leftChild;e.rightChild;)e=null==e?void 0:e.rightChild;else{for(var i=null==e?void 0:e.parent;(null==i?void 0:i.leftChild)===e;)i=null==(e=i)?void 0:e.parent;e=i}return e},e.prototype._next=function(){var t=this.node;if(null==t?void 0:t.rightChild)for(t=t.rightChild;t.leftChild;)t=null==t?void 0:t.leftChild;else{for(var e=null==t?void 0:t.parent;(null==e?void 0:e.rightChild)===t;)e=null==(t=e)?void 0:t.parent;t.rightChild!==e&&(t=e)}return t},e.prototype.pre=function(){if("reverse"===this.iteratorType){if(this.node===this.header.rightChild)throw new z("Tree iterator access denied!");this.node=this._next()}else{if(this.node===this.header.leftChild)throw new z("Tree iterator access denied!");this.node=this._pre()}return this},e.prototype.next=function(){if("reverse"===this.iteratorType){if(this.node===this.header)throw new z("Tree iterator access denied!");this.node=this._pre()}else{if(this.node===this.header)throw new z("Tree iterator access denied!");this.node=this._next()}return this},e.prototype.equals=function(t){if(t.constructor.name!==this.constructor.name)throw new TypeError("obj's constructor is not ".concat(this.constructor.name,"!"));if(this.iteratorType!==t.iteratorType)throw new TypeError("iterator type error!");return this.node===t.node},e}((function(t,e){this.node=t,this.iteratorType=e}));const U=G;var X=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),Y=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Q=function(t){function e(e,i,s){return void 0===s&&(s="normal"),t.call(this,e,i,s)||this}return X(e,t),Object.defineProperty(e.prototype,"pointer",{get:function(){if(void 0===this.node.key)throw new z("OrderedSet iterator access denied!");return this.node.key},enumerable:!1,configurable:!0}),e}(U),Z=function(t){function e(e,i){void 0===e&&(e=[]);var s=t.call(this,i)||this;return s.iterationFunc=function(t){return function(t,e){var i,s,r,n,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,s=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(!((r=(r=h.trys).length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){h=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){h.label=n[1];break}if(6===n[0]&&h.label<r[1]){h.label=r[1],r=n;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(n);break}r[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(t){n=[6,t],s=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}(this,(function(e){switch(e.label){case 0:return t&&void 0!==t.key?[5,Y(this.iterationFunc(t.leftChild))]:[2];case 1:return e.sent(),[4,t.key];case 2:return e.sent(),[5,Y(this.iterationFunc(t.rightChild))];case 3:return e.sent(),[2]}}))},e.forEach((function(t){return s.insert(t)})),s.iterationFunc=s.iterationFunc.bind(s),s}return X(e,t),e.prototype.begin=function(){return new Q(this.header.leftChild||this.header,this.header)},e.prototype.end=function(){return new Q(this.header,this.header)},e.prototype.rBegin=function(){return new Q(this.header.rightChild||this.header,this.header,"reverse")},e.prototype.rEnd=function(){return new Q(this.header,this.header,"reverse")},e.prototype.front=function(){var t;return null===(t=this.header.leftChild)||void 0===t?void 0:t.key},e.prototype.back=function(){var t;return null===(t=this.header.rightChild)||void 0===t?void 0:t.key},e.prototype.forEach=function(t){var e,i,s=0;try{for(var r=Y(this),n=r.next();!n.done;n=r.next())t(n.value,s++)}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},e.prototype.getElementByPos=function(t){var e,i;B(t,0,this.length-1);var s=0;try{for(var r=Y(this),n=r.next();!n.done;n=r.next()){var h=n.value;if(s===t)return h;++s}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},e.prototype.eraseElementByIterator=function(t){var e=t.node;return t=t.next(),this.eraseNode(e),t},e.prototype.insert=function(t){if(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t.includes(void 0)||t.includes(null))throw new P}(t),this.empty())return++this.length,this.root.key=t,this.root.color=N.TreeNodeColorType.black,this.header.leftChild=this.root,void(this.header.rightChild=this.root);var e=this.findInsertPos(this.root,t);void 0!==e.key&&0===this.cmp(e.key,t)||(++this.length,e.key=t,(void 0===this.header.leftChild||void 0===this.header.leftChild.key||this.cmp(this.header.leftChild.key,t)>0)&&(this.header.leftChild=e),(void 0===this.header.rightChild||void 0===this.header.rightChild.key||this.cmp(this.header.rightChild.key,t)<0)&&(this.header.rightChild=e),this.insertNodeSelfBalance(e),this.root.color=N.TreeNodeColorType.black)},e.prototype.find=function(t){var e=this.findElementNode(this.root,t);return void 0!==e&&void 0!==e.key?new Q(e,this.header):this.end()},e.prototype.lowerBound=function(t){var e=this._lowerBound(this.root,t);return void 0===e?this.end():new Q(e,this.header)},e.prototype.upperBound=function(t){var e=this._upperBound(this.root,t);return void 0===e?this.end():new Q(e,this.header)},e.prototype.reverseLowerBound=function(t){var e=this._reverseLowerBound(this.root,t);return void 0===e?this.end():new Q(e,this.header)},e.prototype.reverseUpperBound=function(t){var e=this._reverseUpperBound(this.root,t);return void 0===e?this.end():new Q(e,this.header)},e.prototype.union=function(t){var e=this;t.forEach((function(t){return e.insert(t)}))},e.prototype[Symbol.iterator]=function(){return this.iterationFunc(this.root)},e}(q);const $=Z;class J{constructor(t){this.dt=null,this.ut=new $(void 0,t),this.ft=new $(void 0,t),this.ot=new $(void 0,t),this.ct=new $(void 0,t)}get size(){return this.ut.size()}insert(t){t.isRemoved=!1,null!==this.dt?this.ft.insert(t):this.ut.insert(t)}delete(t){null!==this.dt?(t.isRemoved=!0,this.ct.insert(t)):this.ut.eraseElementByKey(t)}clear(){this.ut.clear(),this.ft.clear(),this.ct.clear()}forEach(t){this.dt=this.ut,this.dt.forEach((e=>{e.isRemoved||t(e)}));do{this.dt=this.Ot(),this.dt.forEach((e=>{e.isRemoved||t(e)}))}while(0<this.ft.size()||0<this.ct.size());this.dt=null}Ot(){this.dt=null,this.ct.forEach((t=>this.delete(t))),this.ft.forEach((t=>this.insert(t)));const t=this.ft;return this.ft=this.ot,this.ot=t,this.ft.clear(),this.ct.clear(),t}}class K{constructor(t,e,i,s){this.isRemoved=!1,this.Dt=i,this.St=t.generateEventId(),this.kt=s,this.Ut=e}static createAwakeEvent(t,e){return new K(t,e,0,0)}static createStartEvent(t,e,i){return new K(t,e,2,i)}static createUpdateEvent(t,e,i){return new K(t,e,3,i)}static createOnEnableEvent(t,e,i){return new K(t,e,1,i)}static createOnDisableEvent(t,e,i){return new K(t,e,1,i)}static createOnDestroyEvent(t,e,i){return new K(t,e,4,i)}static createOnCollisionEnter2DEvent(t,e,i){return new K(t,e,1,i)}static createOnCollisionStay2DEvent(t,e,i){return new K(t,e,1,i)}static createOnCollisionExit2DEvent(t,e,i){return new K(t,e,1,i)}static createOnTriggerEnter2DEvent(t,e,i){return new K(t,e,1,i)}static createOnTriggerStay2DEvent(t,e,i){return new K(t,e,1,i)}static createOnTriggerExit2DEvent(t,e,i){return new K(t,e,1,i)}get invoke(){return this.Ut}static comparator(t,e){return t.Dt===e.Dt?t.kt===e.kt?t.St-e.St:t.kt-e.kt:t.Dt-e.Dt}}function tt(t){return void 0!==t.onWorldMatrixUpdated}class et{constructor(){this.ti=new Set,this.ii=new J(K.comparator),this.ei=new J(K.comparator),this.ni=new J(K.comparator),this.oi=new J(K.comparator),this.ri=new J(K.comparator),this.si=new J(K.comparator)}registerComponent(t){tt(t)&&this.ti.add(t);const e=t._engine_internal_componentEventContainer;e.onCollisionEnter2D&&this.ii.insert(e.onCollisionEnter2D),e.onCollisionStay2D&&this.ei.insert(e.onCollisionStay2D),e.onCollisionExit2D&&this.ni.insert(e.onCollisionExit2D),e.onTriggerEnter2D&&this.oi.insert(e.onTriggerEnter2D),e.onTriggerStay2D&&this.ri.insert(e.onTriggerStay2D),e.onTriggerExit2D&&this.si.insert(e.onTriggerExit2D)}unregisterComponent(t){tt(t)&&this.ti.delete(t);const e=t._engine_internal_componentEventContainer;e.onCollisionEnter2D&&this.ii.delete(e.onCollisionEnter2D),e.onCollisionStay2D&&this.ei.delete(e.onCollisionStay2D),e.onCollisionExit2D&&this.ni.delete(e.onCollisionExit2D),e.onTriggerEnter2D&&this.oi.delete(e.onTriggerEnter2D),e.onTriggerStay2D&&this.ri.delete(e.onTriggerStay2D),e.onTriggerExit2D&&this.si.delete(e.onTriggerExit2D)}invokeOnWorldMatrixUpdated(){for(const t of this.ti)t.onWorldMatrixUpdated()}invokeOnCollisionEnter2D(t){0!==this.ii.size&&this.ii.forEach((e=>e.invoke(t)))}invokeOnCollisionStay2D(t){0!==this.ei.size&&this.ei.forEach((e=>e.invoke(t)))}invokeOnCollisionExit2D(t){0!==this.ni.size&&this.ni.forEach((e=>e.invoke(t)))}invokeOnTriggerEnter2D(t){0!==this.oi.size&&this.oi.forEach((e=>e.invoke(t)))}invokeOnTriggerStay2D(t){0!==this.ri.size&&this.ri.forEach((e=>e.invoke(t)))}invokeOnTriggerExit2D(t){0!==this.si.size&&this.si.forEach((e=>e.invoke(t)))}}class it{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerp(t,e,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,s)}static slerpFlat(t,e,i,s,r,n,h){let a=i[s+0],o=i[s+1],l=i[s+2],c=i[s+3];const u=r[n+0],d=r[n+1],m=r[n+2],p=r[n+3];if(0===h)return t[e+0]=a,t[e+1]=o,t[e+2]=l,void(t[e+3]=c);if(1===h)return t[e+0]=u,t[e+1]=d,t[e+2]=m,void(t[e+3]=p);if(c!==p||a!==u||o!==d||l!==m){let t=1-h;const e=a*u+o*d+l*m+c*p,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const r=Math.sqrt(s),n=Math.atan2(r,e*i);t=Math.sin(t*n)/r,h=Math.sin(h*n)/r}const r=h*i;if(a=a*t+u*r,o=o*t+d*r,l=l*t+m*r,c=c*t+p*r,t===1-h){const t=1/Math.sqrt(a*a+o*o+l*l+c*c);a*=t,o*=t,l*=t,c*=t}}t[e]=a,t[e+1]=o,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,r,n){const h=i[s],a=i[s+1],o=i[s+2],l=i[s+3],c=r[n],u=r[n+1],d=r[n+2],m=r[n+3];return t[e]=h*m+l*c+a*d-o*u,t[e+1]=a*m+l*u+o*c-h*d,t[e+2]=o*m+l*d+h*u-a*c,t[e+3]=l*m-h*c-a*u-o*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,s=t._y,r=t._z,n=t._order,h=Math.cos,a=Math.sin,o=h(i/2),l=h(s/2),c=h(r/2),u=a(i/2),d=a(s/2),m=a(r/2);switch(n){case"XYZ":this._x=u*l*c+o*d*m,this._y=o*d*c-u*l*m,this._z=o*l*m+u*d*c,this._w=o*l*c-u*d*m;break;case"YXZ":this._x=u*l*c+o*d*m,this._y=o*d*c-u*l*m,this._z=o*l*m-u*d*c,this._w=o*l*c+u*d*m;break;case"ZXY":this._x=u*l*c-o*d*m,this._y=o*d*c+u*l*m,this._z=o*l*m+u*d*c,this._w=o*l*c-u*d*m;break;case"ZYX":this._x=u*l*c-o*d*m,this._y=o*d*c+u*l*m,this._z=o*l*m-u*d*c,this._w=o*l*c+u*d*m;break;case"YZX":this._x=u*l*c+o*d*m,this._y=o*d*c+u*l*m,this._z=o*l*m-u*d*c,this._w=o*l*c-u*d*m;break;case"XZY":this._x=u*l*c-o*d*m,this._y=o*d*c-u*l*m,this._z=o*l*m+u*d*c,this._w=o*l*c+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],n=e[1],h=e[5],a=e[9],o=e[2],l=e[6],c=e[10],u=i+h+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-a)*t,this._y=(r-o)*t,this._z=(n-s)*t}else if(i>h&&i>c){const t=2*Math.sqrt(1+i-h-c);this._w=(l-a)/t,this._x=.25*t,this._y=(s+n)/t,this._z=(r+o)/t}else if(h>c){const t=2*Math.sqrt(1+h-i-c);this._w=(r-o)/t,this._x=(s+n)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+c-i-h);this._w=(n-s)/t,this._x=(r+o)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(r(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,n=t._w,h=e._x,a=e._y,o=e._z,l=e._w;return this._x=i*l+n*h+s*o-r*a,this._y=s*l+n*a+r*h-i*o,this._z=r*l+n*o+i*a-s*h,this._w=n*l-i*h-s*a-r*o,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,s=this._y,r=this._z,n=this._w;let h=n*t._w+i*t._x+s*t._y+r*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=n,this._x=i,this._y=s,this._z=r,this;const a=1-h*h;if(a<=Number.EPSILON){const t=1-e;return this._w=t*n+e*this._w,this._x=t*i+e*this._x,this._y=t*s+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const o=Math.sqrt(a),l=Math.atan2(o,h),c=Math.sin((1-e)*l)/o,u=Math.sin(e*l)/o;return this._w=n*c+this._w*u,this._x=i*c+this._x*u,this._y=s*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(r),i*Math.cos(r),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class st{constructor(t=0,e=0,i=0){st.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(nt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(nt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*s,this.y=r[1]*e+r[4]*i+r[7]*s,this.z=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=t.elements,n=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*s+r[12])*n,this.y=(r[1]*e+r[5]*i+r[9]*s+r[13])*n,this.z=(r[2]*e+r[6]*i+r[10]*s+r[14])*n,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,r=t.x,n=t.y,h=t.z,a=t.w,o=a*e+n*s-h*i,l=a*i+h*e-r*s,c=a*s+r*i-n*e,u=-r*e-n*i-h*s;return this.x=o*a+u*-r+l*-h-c*-n,this.y=l*a+u*-n+c*-r-o*-h,this.z=c*a+u*-h+o*-n-l*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*s,this.y=r[1]*e+r[5]*i+r[9]*s,this.z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,n=e.x,h=e.y,a=e.z;return this.x=s*a-r*h,this.y=r*n-i*a,this.z=i*h-s*n,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return rt.copy(this).projectOnVector(t),this.sub(rt)}reflect(t){return this.sub(rt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(r(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const rt=new st,nt=new it;class ht{constructor(){ht.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,s,r,n,h,a,o,l,c,u,d,m,p,f){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=s,g[1]=r,g[5]=n,g[9]=h,g[13]=a,g[2]=o,g[6]=l,g[10]=c,g[14]=u,g[3]=d,g[7]=m,g[11]=p,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ht).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/at.setFromMatrixColumn(t,0).length(),r=1/at.setFromMatrixColumn(t,1).length(),n=1/at.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*n,e[9]=i[9]*n,e[10]=i[10]*n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,s=t.y,r=t.z,n=Math.cos(i),h=Math.sin(i),a=Math.cos(s),o=Math.sin(s),l=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=n*l,i=n*c,s=h*l,r=h*c;e[0]=a*l,e[4]=-a*c,e[8]=o,e[1]=i+s*o,e[5]=t-r*o,e[9]=-h*a,e[2]=r-t*o,e[6]=s+i*o,e[10]=n*a}else if("YXZ"===t.order){const t=a*l,i=a*c,s=o*l,r=o*c;e[0]=t+r*h,e[4]=s*h-i,e[8]=n*o,e[1]=n*c,e[5]=n*l,e[9]=-h,e[2]=i*h-s,e[6]=r+t*h,e[10]=n*a}else if("ZXY"===t.order){const t=a*l,i=a*c,s=o*l,r=o*c;e[0]=t-r*h,e[4]=-n*c,e[8]=s+i*h,e[1]=i+s*h,e[5]=n*l,e[9]=r-t*h,e[2]=-n*o,e[6]=h,e[10]=n*a}else if("ZYX"===t.order){const t=n*l,i=n*c,s=h*l,r=h*c;e[0]=a*l,e[4]=s*o-i,e[8]=t*o+r,e[1]=a*c,e[5]=r*o+t,e[9]=i*o-s,e[2]=-o,e[6]=h*a,e[10]=n*a}else if("YZX"===t.order){const t=n*a,i=n*o,s=h*a,r=h*o;e[0]=a*l,e[4]=r-t*c,e[8]=s*c+i,e[1]=c,e[5]=n*l,e[9]=-h*l,e[2]=-o*l,e[6]=i*c+s,e[10]=t-r*c}else if("XZY"===t.order){const t=n*a,i=n*o,s=h*a,r=h*o;e[0]=a*l,e[4]=-c,e[8]=o*l,e[1]=t*c+r,e[5]=n*l,e[9]=i*c-s,e[2]=s*c-i,e[6]=h*l,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(lt,t,ct)}lookAt(t,e,i){const s=this.elements;return mt.subVectors(t,e),0===mt.lengthSq()&&(mt.z=1),mt.normalize(),ut.crossVectors(i,mt),0===ut.lengthSq()&&(1===Math.abs(i.z)?mt.x+=1e-4:mt.z+=1e-4,mt.normalize(),ut.crossVectors(i,mt)),ut.normalize(),dt.crossVectors(mt,ut),s[0]=ut.x,s[4]=dt.x,s[8]=mt.x,s[1]=ut.y,s[5]=dt.y,s[9]=mt.y,s[2]=ut.z,s[6]=dt.z,s[10]=mt.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,n=i[0],h=i[4],a=i[8],o=i[12],l=i[1],c=i[5],u=i[9],d=i[13],m=i[2],p=i[6],f=i[10],g=i[14],y=i[3],_=i[7],b=i[11],v=i[15],w=s[0],x=s[4],C=s[8],S=s[12],E=s[1],M=s[5],T=s[9],k=s[13],O=s[2],D=s[6],j=s[10],I=s[14],A=s[3],z=s[7],R=s[11],P=s[15];return r[0]=n*w+h*E+a*O+o*A,r[4]=n*x+h*M+a*D+o*z,r[8]=n*C+h*T+a*j+o*R,r[12]=n*S+h*k+a*I+o*P,r[1]=l*w+c*E+u*O+d*A,r[5]=l*x+c*M+u*D+d*z,r[9]=l*C+c*T+u*j+d*R,r[13]=l*S+c*k+u*I+d*P,r[2]=m*w+p*E+f*O+g*A,r[6]=m*x+p*M+f*D+g*z,r[10]=m*C+p*T+f*j+g*R,r[14]=m*S+p*k+f*I+g*P,r[3]=y*w+_*E+b*O+v*A,r[7]=y*x+_*M+b*D+v*z,r[11]=y*C+_*T+b*j+v*R,r[15]=y*S+_*k+b*I+v*P,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],n=t[1],h=t[5],a=t[9],o=t[13],l=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*a*c-s*o*c-r*h*u+i*o*u+s*h*d-i*a*d)+t[7]*(+e*a*d-e*o*u+r*n*u-s*n*d+s*o*l-r*a*l)+t[11]*(+e*o*c-e*h*d-r*n*c+i*n*d+r*h*l-i*o*l)+t[15]*(-s*h*l-e*a*c+e*h*u+s*n*c-i*n*u+i*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],h=t[5],a=t[6],o=t[7],l=t[8],c=t[9],u=t[10],d=t[11],m=t[12],p=t[13],f=t[14],g=t[15],y=c*f*o-p*u*o+p*a*d-h*f*d-c*a*g+h*u*g,_=m*u*o-l*f*o-m*a*d+n*f*d+l*a*g-n*u*g,b=l*p*o-m*c*o+m*h*d-n*p*d-l*h*g+n*c*g,v=m*c*a-l*p*a-m*h*u+n*p*u+l*h*f-n*c*f,w=e*y+i*_+s*b+r*v;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const x=1/w;return t[0]=y*x,t[1]=(p*u*r-c*f*r-p*s*d+i*f*d+c*s*g-i*u*g)*x,t[2]=(h*f*r-p*a*r+p*s*o-i*f*o-h*s*g+i*a*g)*x,t[3]=(c*a*r-h*u*r-c*s*o+i*u*o+h*s*d-i*a*d)*x,t[4]=_*x,t[5]=(l*f*r-m*u*r+m*s*d-e*f*d-l*s*g+e*u*g)*x,t[6]=(m*a*r-n*f*r-m*s*o+e*f*o+n*s*g-e*a*g)*x,t[7]=(n*u*r-l*a*r+l*s*o-e*u*o-n*s*d+e*a*d)*x,t[8]=b*x,t[9]=(m*c*r-l*p*r-m*i*d+e*p*d+l*i*g-e*c*g)*x,t[10]=(n*p*r-m*h*r+m*i*o-e*p*o-n*i*g+e*h*g)*x,t[11]=(l*h*r-n*c*r-l*i*o+e*c*o+n*i*d-e*h*d)*x,t[12]=v*x,t[13]=(l*p*s-m*c*s+m*i*u-e*p*u-l*i*f+e*c*f)*x,t[14]=(m*h*s-n*p*s-m*i*a+e*p*a+n*i*f-e*h*f)*x,t[15]=(n*c*s-l*h*s+l*i*a-e*c*a-n*i*u+e*h*u)*x,this}scale(t){const e=this.elements,i=t.x,s=t.y,r=t.z;return e[0]*=i,e[4]*=s,e[8]*=r,e[1]*=i,e[5]*=s,e[9]*=r,e[2]*=i,e[6]*=s,e[10]*=r,e[3]*=i,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),r=1-i,n=t.x,h=t.y,a=t.z,o=r*n,l=r*h;return this.set(o*n+i,o*h-s*a,o*a+s*h,0,o*h+s*a,l*h+i,l*a-s*n,0,o*a-s*h,l*a+s*n,r*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,r,n){return this.set(1,i,r,0,t,1,n,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,r=e._x,n=e._y,h=e._z,a=e._w,o=r+r,l=n+n,c=h+h,u=r*o,d=r*l,m=r*c,p=n*l,f=n*c,g=h*c,y=a*o,_=a*l,b=a*c,v=i.x,w=i.y,x=i.z;return s[0]=(1-(p+g))*v,s[1]=(d+b)*v,s[2]=(m-_)*v,s[3]=0,s[4]=(d-b)*w,s[5]=(1-(u+g))*w,s[6]=(f+y)*w,s[7]=0,s[8]=(m+_)*x,s[9]=(f-y)*x,s[10]=(1-(u+p))*x,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let r=at.set(s[0],s[1],s[2]).length();const n=at.set(s[4],s[5],s[6]).length(),h=at.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],ot.copy(this);const a=1/r,o=1/n,l=1/h;return ot.elements[0]*=a,ot.elements[1]*=a,ot.elements[2]*=a,ot.elements[4]*=o,ot.elements[5]*=o,ot.elements[6]*=o,ot.elements[8]*=l,ot.elements[9]*=l,ot.elements[10]*=l,e.setFromRotationMatrix(ot),i.x=r,i.y=n,i.z=h,this}makePerspective(t,e,i,s,r,n){void 0===n&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const h=this.elements,a=2*r/(e-t),o=2*r/(i-s),l=(e+t)/(e-t),c=(i+s)/(i-s),u=-(n+r)/(n-r),d=-2*n*r/(n-r);return h[0]=a,h[4]=0,h[8]=l,h[12]=0,h[1]=0,h[5]=o,h[9]=c,h[13]=0,h[2]=0,h[6]=0,h[10]=u,h[14]=d,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,i,s,r,n){const h=this.elements,a=1/(e-t),o=1/(i-s),l=1/(n-r),c=(e+t)*a,u=(i+s)*o,d=(n+r)*l;return h[0]=2*a,h[4]=0,h[8]=0,h[12]=-c,h[1]=0,h[5]=2*o,h[9]=0,h[13]=-u,h[2]=0,h[6]=0,h[10]=-2*l,h[14]=-d,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const at=new st,ot=new ht,lt=new st(0,0,0),ct=new st(1,1,1),ut=new st,dt=new st,mt=new st,pt=new ht,ft=new it;class gt{constructor(t=0,e=0,i=0,s=gt.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,n=s[0],h=s[4],a=s[8],o=s[1],l=s[5],c=s[9],u=s[2],d=s[6],m=s[10];switch(e){case"XYZ":this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,m),this._z=Math.atan2(-h,n)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,m),this._z=Math.atan2(-h,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,m),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-h,l));break;case"YZX":this._z=Math.asin(r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return pt.makeRotationFromQuaternion(t),this.setFromRotationMatrix(pt,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ft.setFromEuler(this),this.setFromQuaternion(ft,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}gt.DefaultOrder="XYZ",gt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class yt{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}class _t{constructor(){_t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,s,r,n,h,a,o){const l=this.elements;return l[0]=t,l[1]=s,l[2]=h,l[3]=e,l[4]=r,l[5]=a,l[6]=i,l[7]=n,l[8]=o,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,n=i[0],h=i[3],a=i[6],o=i[1],l=i[4],c=i[7],u=i[2],d=i[5],m=i[8],p=s[0],f=s[3],g=s[6],y=s[1],_=s[4],b=s[7],v=s[2],w=s[5],x=s[8];return r[0]=n*p+h*y+a*v,r[3]=n*f+h*_+a*w,r[6]=n*g+h*b+a*x,r[1]=o*p+l*y+c*v,r[4]=o*f+l*_+c*w,r[7]=o*g+l*b+c*x,r[2]=u*p+d*y+m*v,r[5]=u*f+d*_+m*w,r[8]=u*g+d*b+m*x,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],h=t[5],a=t[6],o=t[7],l=t[8];return e*n*l-e*h*o-i*r*l+i*h*a+s*r*o-s*n*a}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],h=t[5],a=t[6],o=t[7],l=t[8],c=l*n-h*o,u=h*a-l*r,d=o*r-n*a,m=e*c+i*u+s*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=c*p,t[1]=(s*o-l*i)*p,t[2]=(h*i-s*n)*p,t[3]=u*p,t[4]=(l*e-s*a)*p,t[5]=(s*r-h*e)*p,t[6]=d*p,t[7]=(i*a-o*e)*p,t[8]=(n*e-i*r)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,r,n,h){const a=Math.cos(r),o=Math.sin(r);return this.set(i*a,i*o,-i*(a*n+o*h)+n+t,-s*o,s*a,-s*(-o*n+a*h)+h+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.elements,r=s[0],n=s[3],h=s[6],a=s[1],o=s[4],l=s[7];return s[0]=e*r+i*a,s[3]=e*n+i*o,s[6]=e*h+i*l,s[1]=-i*r+e*a,s[4]=-i*n+e*o,s[7]=-i*h+e*l,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}let bt=0;const vt=new st,wt=new it,xt=new ht,Ct=new st,St=new st,Et=new st,Mt=new it,Tt=new st(1,0,0),kt=new st(0,1,0),Ot=new st(0,0,1),Dt={type:"added"},jt={type:"removed"};class It extends class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,s=i.length;e<s;e++)i[e].call(this,t);t.target=null}}}{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:bt++}),this.uuid=function(){const e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]).toLowerCase()}(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=It.DefaultUp.clone();const e=new st,i=new gt,s=new it,r=new st(1,1,1);i._onChange((function(){s.setFromEuler(i,!1)})),s._onChange((function(){i.setFromQuaternion(s,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ht},normalMatrix:{value:new _t}}),this.matrix=new ht,this.matrixWorld=new ht,this.matrixAutoUpdate=It.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new yt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return wt.setFromAxisAngle(t,e),this.quaternion.multiply(wt),this}rotateOnWorldAxis(t,e){return wt.setFromAxisAngle(t,e),this.quaternion.premultiply(wt),this}rotateX(t){return this.rotateOnAxis(Tt,t)}rotateY(t){return this.rotateOnAxis(kt,t)}rotateZ(t){return this.rotateOnAxis(Ot,t)}translateOnAxis(t,e){return vt.copy(t).applyQuaternion(this.quaternion),this.position.add(vt.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Tt,t)}translateY(t){return this.translateOnAxis(kt,t)}translateZ(t){return this.translateOnAxis(Ot,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(xt.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Ct.copy(t):Ct.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),St.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xt.lookAt(St,Ct,this.up):xt.lookAt(Ct,St,this.up),this.quaternion.setFromRotationMatrix(xt),s&&(xt.extractRotation(s.matrixWorld),wt.setFromRotationMatrix(xt),this.quaternion.premultiply(wt.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Dt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(jt)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(jt)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),xt.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),xt.multiply(t.parent.matrixWorld)),t.applyMatrix4(xt),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const s=this.children[i].getObjectByProperty(t,e);if(void 0!==s)return s}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(St,t,Et),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(St,Mt,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,s=i.length;e<s;e++){const s=i[e];r(t.shapes,s)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,s=this.material.length;i<s;i++)e.push(r(t.materials,this.material[i]));s.material=e}else s.material=r(t.materials,this.material);if(this.children.length>0){s.children=[];for(let e=0;e<this.children.length;e++)s.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];s.animations.push(r(t.animations,i))}}if(e){const e=n(t.geometries),s=n(t.materials),r=n(t.textures),h=n(t.images),a=n(t.shapes),o=n(t.skeletons),l=n(t.animations),c=n(t.nodes);e.length>0&&(i.geometries=e),s.length>0&&(i.materials=s),r.length>0&&(i.textures=r),h.length>0&&(i.images=h),a.length>0&&(i.shapes=a),o.length>0&&(i.skeletons=o),l.length>0&&(i.animations=l),c.length>0&&(i.nodes=c)}return i.object=s,i;function n(t){const e=[];for(const i in t){const s=t[i];delete s.metadata,e.push(s)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}It.DefaultUp=new st(0,1,0),It.DefaultMatrixAutoUpdate=!0;class At extends It{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}class zt{constructor(t=0,e=0,i=0,s=zt.DefaultOrder){this.isEuler=!0,this.th=t,this.sh=e,this.hh=i,this.ih=s,this._onChangeCallback=()=>{},this.eh=()=>{},this.rh=()=>{}}onBeforeGetComponent(t){this.rh=t}onBeforeChange(t){this.eh=t}get _x(){return this.rh(),this.th}set _x(t){this.th=t}get _y(){return this.rh(),this.sh}set _y(t){this.sh=t}get _z(){return this.rh(),this.hh}set _z(t){this.hh=t}get _order(){return this.rh(),this.ih}set _order(t){this.ih=t}get x(){return this.rh(),this.th}set x(t){this.eh(),this.th=t,this._onChangeCallback()}get y(){return this.rh(),this.sh}set y(t){this.eh(),this.sh=t,this._onChangeCallback()}get z(){return this.rh(),this.hh}set z(t){this.eh(),this.hh=t,this._onChangeCallback()}get order(){return this.rh(),this.ih}set order(t){this.eh(),this.ih=t,this._onChangeCallback()}set(t,e,i,s){return this.eh(),this.th=t,this.sh=e,this.hh=i,s&&(this.ih=s),this._onChangeCallback(),this}clone(){return this.rh(),new gt(this.th,this.sh,this.hh,this.ih)}copy(t){return this.eh(),this.th=t._x,this.sh=t._y,this.hh=t._z,this.ih=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,i=!0){this.rh();const s=t.elements,n=s[0],h=s[4],a=s[8],o=s[1],l=s[5],c=s[9],u=s[2],d=s[6],m=s[10];switch(e||(e=this.ih),this.eh(),e){case"XYZ":this.sh=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this.th=Math.atan2(-c,m),this.hh=Math.atan2(-h,n)):(this.th=Math.atan2(d,l),this.hh=0);break;case"YXZ":this.th=Math.asin(-r(c,-1,1)),Math.abs(c)<.9999999?(this.sh=Math.atan2(a,m),this.hh=Math.atan2(o,l)):(this.sh=Math.atan2(-u,n),this.hh=0);break;case"ZXY":this.th=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this.sh=Math.atan2(-u,m),this.hh=Math.atan2(-h,l)):(this.sh=0,this.hh=Math.atan2(o,n));break;case"ZYX":this.sh=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this.th=Math.atan2(d,m),this.hh=Math.atan2(o,n)):(this.th=0,this.hh=Math.atan2(-h,l));break;case"YZX":this.hh=Math.asin(r(o,-1,1)),Math.abs(o)<.9999999?(this.th=Math.atan2(-c,l),this.sh=Math.atan2(-u,n)):(this.th=0,this.sh=Math.atan2(a,m));break;case"XZY":this.hh=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this.th=Math.atan2(d,l),this.sh=Math.atan2(a,n)):(this.th=Math.atan2(-c,m),this.sh=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this.ih=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Rt.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Rt,e,i)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e)}reorder(t){return Pt.setFromEuler(this),this.setFromQuaternion(Pt,t)}equals(t){return this.rh(),t._x===this.th&&t._y===this.sh&&t._z===this.hh&&t._order===this.ih}fromArray(t){return this.th===t[0]&&this.sh===t[1]&&this.hh===t[2]&&this.ih===t[3]||(this.eh(),this.th=t[0],this.sh=t[1],this.hh=t[2],void 0!==t[3]&&(this.ih=t[3]),this._onChangeCallback()),this}toArray(t=[],e=0){return this.rh(),t[e]=this.th,t[e+1]=this.sh,t[e+2]=this.hh,t[e+3]=this.ih,t}_onChange(t){return this._onChangeCallback=t,this}*[Symbol.iterator](){this.rh(),yield this.th,this.rh(),yield this.sh,this.rh(),yield this.hh,this.rh(),yield this.ih}}zt.DefaultOrder="XYZ",zt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Rt=new ht,Pt=new it;class Wt{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this.th=t,this.sh=e,this.hh=i,this.hi=s,this._onChangeCallback=()=>{},this.eh=()=>{},this.rh=()=>{}}onBeforeGetComponent(t){this.rh=t}onBeforeChange(t){this.eh=t}static slerp(t,e,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,s)}static slerpFlat(t,e,i,s,r,n,h){let a=i[s+0],o=i[s+1],l=i[s+2],c=i[s+3];const u=r[n+0],d=r[n+1],m=r[n+2],p=r[n+3];if(0===h)return t[e+0]=a,t[e+1]=o,t[e+2]=l,void(t[e+3]=c);if(1===h)return t[e+0]=u,t[e+1]=d,t[e+2]=m,void(t[e+3]=p);if(c!==p||a!==u||o!==d||l!==m){let t=1-h;const e=a*u+o*d+l*m+c*p,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const r=Math.sqrt(s),n=Math.atan2(r,e*i);t=Math.sin(t*n)/r,h=Math.sin(h*n)/r}const r=h*i;if(a=a*t+u*r,o=o*t+d*r,l=l*t+m*r,c=c*t+p*r,t===1-h){const t=1/Math.sqrt(a*a+o*o+l*l+c*c);a*=t,o*=t,l*=t,c*=t}}t[e]=a,t[e+1]=o,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,r,n){const h=i[s],a=i[s+1],o=i[s+2],l=i[s+3],c=r[n],u=r[n+1],d=r[n+2],m=r[n+3];return t[e]=h*m+l*c+a*d-o*u,t[e+1]=a*m+l*u+o*c-h*d,t[e+2]=o*m+l*d+h*u-a*c,t[e+3]=l*m-h*c-a*u-o*d,t}get _x(){return this.rh(),this.th}set _x(t){this.th=t}get _y(){return this.rh(),this.sh}set _y(t){this.sh=t}get _z(){return this.rh(),this.hh}set _z(t){this.hh=t}get _w(){return this.rh(),this.hi}set _w(t){this.hi=t}get x(){return this.rh(),this.th}set x(t){this.eh(),this.th=t,this._onChangeCallback()}get y(){return this.rh(),this.sh}set y(t){this.eh(),this.sh=t,this._onChangeCallback()}get z(){return this.rh(),this.hh}set z(t){this.eh(),this.hh=t,this._onChangeCallback()}get w(){return this.rh(),this.hi}set w(t){this.eh(),this.hi=t,this._onChangeCallback()}set(t,e,i,s){return this.eh(),this.th=t,this.sh=e,this.hh=i,this.hi=s,this._onChangeCallback(),this}clone(){return this.rh(),new it(this.th,this.sh,this.hh,this.hi)}copy(t){return this.eh(),this.th=t.x,this.sh=t.y,this.hh=t.z,this.hi=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,s=t._y,r=t._z,n=t._order,h=Math.cos,a=Math.sin,o=h(i/2),l=h(s/2),c=h(r/2),u=a(i/2),d=a(s/2),m=a(r/2);switch(this.eh(),n){case"XYZ":this.th=u*l*c+o*d*m,this.sh=o*d*c-u*l*m,this.hh=o*l*m+u*d*c,this.hi=o*l*c-u*d*m;break;case"YXZ":this.th=u*l*c+o*d*m,this.sh=o*d*c-u*l*m,this.hh=o*l*m-u*d*c,this.hi=o*l*c+u*d*m;break;case"ZXY":this.th=u*l*c-o*d*m,this.sh=o*d*c+u*l*m,this.hh=o*l*m+u*d*c,this.hi=o*l*c-u*d*m;break;case"ZYX":this.th=u*l*c-o*d*m,this.sh=o*d*c+u*l*m,this.hh=o*l*m-u*d*c,this.hi=o*l*c+u*d*m;break;case"YZX":this.th=u*l*c+o*d*m,this.sh=o*d*c+u*l*m,this.hh=o*l*m-u*d*c,this.hi=o*l*c-u*d*m;break;case"XZY":this.th=u*l*c-o*d*m,this.sh=o*d*c-u*l*m,this.hh=o*l*m+u*d*c,this.hi=o*l*c+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this.eh(),this.th=t.x*s,this.sh=t.y*s,this.hh=t.z*s,this.hi=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],n=e[1],h=e[5],a=e[9],o=e[2],l=e[6],c=e[10],u=i+h+c;if(this.eh(),u>0){const t=.5/Math.sqrt(u+1);this.hi=.25/t,this.th=(l-a)*t,this.sh=(r-o)*t,this.hh=(n-s)*t}else if(i>h&&i>c){const t=2*Math.sqrt(1+i-h-c);this.hi=(l-a)/t,this.th=.25*t,this.sh=(s+n)/t,this.hh=(r+o)/t}else if(h>c){const t=2*Math.sqrt(1+h-i-c);this.hi=(r-o)/t,this.th=(s+n)/t,this.sh=.25*t,this.hh=(a+l)/t}else{const t=2*Math.sqrt(1+c-i-h);this.hi=(n-s)/t,this.th=(r+o)/t,this.sh=(a+l)/t,this.hh=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return this.eh(),i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this.th=-t.y,this.sh=t.x,this.hh=0,this.hi=i):(this.th=0,this.sh=-t.z,this.hh=t.y,this.hi=i)):(this.th=t.y*e.z-t.z*e.y,this.sh=t.z*e.x-t.x*e.z,this.hh=t.x*e.y-t.y*e.x,this.hi=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(r(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this.rh(),this.eh(),this.th*=-1,this.sh*=-1,this.hh*=-1,this._onChangeCallback(),this}dot(t){return this.rh(),this.th*t._x+this.sh*t._y+this.hh*t._z+this.hi*t._w}lengthSq(){return this.rh(),this.th*this.th+this.sh*this.sh+this.hh*this.hh+this.hi*this.hi}length(){return this.rh(),Math.sqrt(this.th*this.th+this.sh*this.sh+this.hh*this.hh+this.hi*this.hi)}normalize(){let t=this.length();return 0===t?(this.eh(),this.th=0,this.sh=0,this.hh=0,this.hi=1):(t=1/t,this.rh(),this.eh(),this.th=this.th*t,this.sh=this.sh*t,this.hh=this.hh*t,this.hi=this.hi*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):0===t._x&&0===t._y&&0===t._z&&1===t._w?this:this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,n=t._w,h=e._x,a=e._y,o=e._z,l=e._w;return this.eh(),this.th=i*l+n*h+s*o-r*a,this.sh=s*l+n*a+r*h-i*o,this.hh=r*l+n*o+i*a-s*h,this.hi=n*l-i*h-s*a-r*o,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);this.rh();const i=this.th,s=this.sh,r=this.hh,n=this.hi;let h=n*t._w+i*t._x+s*t._y+r*t._z;if(this.eh(),h<0?(this.hi=-t._w,this.th=-t._x,this.sh=-t._y,this.hh=-t._z,h=-h):this.copy(t),h>=1)return this.hi=n,this.th=i,this.sh=s,this.hh=r,this;const a=1-h*h;if(a<=Number.EPSILON){const t=1-e;return this.hi=t*n+e*this.hi,this.th=t*i+e*this.th,this.sh=t*s+e*this.sh,this.hh=t*r+e*this.hh,this.normalize(),this}const o=Math.sqrt(a),l=Math.atan2(o,h),c=Math.sin((1-e)*l)/o,u=Math.sin(e*l)/o;return this.hi=n*c+this.hi*u,this.th=i*c+this.th*u,this.sh=s*c+this.sh*u,this.hh=r*c+this.hh*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(r),i*Math.cos(r),e*Math.sin(s))}equals(t){return this.rh(),t._x===this.th&&t._y===this.sh&&t._z===this.hh&&t._w===this.hi}fromArray(t,e=0){return this.th===t[e]&&this.sh===t[e+1]&&this.hh===t[e+2]&&this.hi===t[e+3]||(this.eh(),this.th=t[e],this.sh=t[e+1],this.hh=t[e+2],this.hi=t[e+3],this._onChangeCallback()),this}toArray(t=[],e=0){return this.rh(),t[e]=this.th,t[e+1]=this.sh,t[e+2]=this.hh,t[e+3]=this.hi,t}fromBufferAttribute(t,e){return this.th=t.getX(e),this.sh=t.getY(e),this.hh=t.getZ(e),this.hi=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}multiplyVector3(t){throw new Error("deprecated")}inverse(){throw new Error("deprecated")}*[Symbol.iterator](){this.rh(),yield this.th,this.rh(),yield this.sh,this.rh(),yield this.hh,this.rh(),yield this.hi}}class Ft{constructor(t=0,e=0,i=0){this.isVector3=!0,this.nh=t,this.ah=e,this.oh=i,this.eh=()=>{},this.rh=()=>{}}onBeforeChange(t){this.eh=t}onBeforeGetComponent(t){this.rh=t}get x(){return this.rh(),this.nh}set x(t){this.eh(),this.nh=t}get y(){return this.rh(),this.ah}set y(t){this.eh(),this.ah=t}get z(){return this.rh(),this.oh}set z(t){this.eh(),this.oh=t}set(t,e,i){return void 0===i&&(this.rh(),i=this.oh),this.eh(),this.nh=t,this.ah=e,this.oh=i,this}setScalar(t){return this.eh(),this.nh=t,this.ah=t,this.oh=t,this}setX(t){return this.eh(),this.nh=t,this}setY(t){return this.eh(),this.ah=t,this}setZ(t){return this.eh(),this.oh=t,this}setComponent(t,e){switch(t){case 0:this.eh(),this.nh=e;break;case 1:this.eh(),this.ah=e;break;case 2:this.eh(),this.oh=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(this.rh(),t){case 0:return this.nh;case 1:return this.ah;case 2:return this.oh;default:throw new Error("index is out of range: "+t)}}clone(){return this.rh(),new st(this.nh,this.ah,this.oh)}copy(t){return this.eh(),this.nh=t.x,this.ah=t.y,this.oh=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(0===t.x&&0===t.y&&0===t.z||(this.rh(),this.eh(),this.nh+=t.x,this.ah+=t.y,this.oh+=t.z),this)}addScalar(t){return 0===t||(this.rh(),this.eh(),this.nh+=t,this.ah+=t,this.oh+=t),this}addVectors(t,e){return this.eh(),this.nh=t.x+e.x,this.ah=t.y+e.y,this.oh=t.z+e.z,this}addScaledVector(t,e){return this.rh(),this.eh(),this.nh+=t.x*e,this.ah+=t.y*e,this.oh+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(0===t.x&&0===t.y&&0===t.z||(this.rh(),this.eh(),this.nh-=t.x,this.ah-=t.y,this.oh-=t.z),this)}subScalar(t){return 0===t||(this.rh(),this.eh(),this.nh-=t,this.ah-=t,this.oh-=t),this}subVectors(t,e){return this.eh(),this.nh=t.x-e.x,this.ah=t.y-e.y,this.oh=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(1===t.x&&1===t.y&&1===t.z||(this.rh(),this.eh(),this.nh*=t.x,this.ah*=t.y,this.oh*=t.z),this)}multiplyScalar(t){return 1===t||(this.rh(),this.eh(),this.nh*=t,this.ah*=t,this.oh*=t),this}multiplyVectors(t,e){return this.eh(),this.nh=t.x*e.x,this.ah=t.y*e.y,this.oh=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Nt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Nt.setFromAxisAngle(t,e))}applyMatrix3(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.elements;return this.eh(),this.nh=r[0]*e+r[3]*i+r[6]*s,this.ah=r[1]*e+r[4]*i+r[7]*s,this.oh=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.elements,n=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.eh(),this.nh=(r[0]*e+r[4]*i+r[8]*s+r[12])*n,this.ah=(r[1]*e+r[5]*i+r[9]*s+r[13])*n,this.oh=(r[2]*e+r[6]*i+r[10]*s+r[14])*n,this}applyQuaternion(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.x,n=t.y,h=t.z,a=t.w,o=a*e+n*s-h*i,l=a*i+h*e-r*s,c=a*s+r*i-n*e,u=-r*e-n*i-h*s;return this.eh(),this.nh=o*a+u*-r+l*-h-c*-n,this.ah=l*a+u*-n+c*-r-o*-h,this.oh=c*a+u*-h+o*-n-l*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.elements;return this.eh(),this.nh=r[0]*e+r[4]*i+r[8]*s,this.ah=r[1]*e+r[5]*i+r[9]*s,this.oh=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return 1===t.x&&1===t.y&&1===t.z||(this.rh(),this.eh(),this.nh/=t.x,this.ah/=t.y,this.oh/=t.z),this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.rh(),this.eh(),this.nh=Math.min(this.nh,t.x),this.ah=Math.min(this.ah,t.y),this.oh=Math.min(this.oh,t.z),this}max(t){return this.rh(),this.eh(),this.nh=Math.max(this.nh,t.x),this.ah=Math.max(this.ah,t.y),this.oh=Math.max(this.oh,t.z),this}clamp(t,e){return this.rh(),this.eh(),this.nh=Math.max(t.x,Math.min(e.x,this.nh)),this.ah=Math.max(t.y,Math.min(e.y,this.ah)),this.oh=Math.max(t.z,Math.min(e.z,this.oh)),this}clampScalar(t,e){return this.rh(),this.eh(),this.nh=Math.max(t,Math.min(e,this.nh)),this.ah=Math.max(t,Math.min(e,this.ah)),this.oh=Math.max(t,Math.min(e,this.oh)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.rh(),this.eh(),this.nh=Math.floor(this.nh),this.ah=Math.floor(this.ah),this.oh=Math.floor(this.oh),this}ceil(){return this.rh(),this.eh(),this.nh=Math.ceil(this.nh),this.ah=Math.ceil(this.ah),this.oh=Math.ceil(this.oh),this}round(){return this.rh(),this.eh(),this.nh=Math.round(this.nh),this.ah=Math.round(this.ah),this.oh=Math.round(this.oh),this}roundToZero(){return this.rh(),this.eh(),this.nh=this.nh<0?Math.ceil(this.nh):Math.floor(this.nh),this.ah=this.ah<0?Math.ceil(this.ah):Math.floor(this.ah),this.oh=this.oh<0?Math.ceil(this.oh):Math.floor(this.oh),this}negate(){return this.rh(),this.eh(),this.nh=-this.nh,this.ah=-this.ah,this.oh=-this.oh,this}dot(t){return this.rh(),this.nh*t.x+this.ah*t.y+this.oh*t.z}lengthSq(){return this.rh(),this.nh*this.nh+this.ah*this.ah+this.oh*this.oh}length(){return this.rh(),Math.sqrt(this.nh*this.nh+this.ah*this.ah+this.oh*this.oh)}manhattanLength(){return this.rh(),Math.abs(this.nh)+Math.abs(this.ah)+Math.abs(this.oh)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.rh(),this.eh(),this.nh+=(t.x-this.nh)*e,this.ah+=(t.y-this.ah)*e,this.oh+=(t.z-this.oh)*e,this}lerpVectors(t,e,i){return this.eh(),this.nh=t.x+(e.x-t.x)*i,this.ah=t.y+(e.y-t.y)*i,this.oh=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,n=e.x,h=e.y,a=e.z;return this.eh(),this.nh=s*a-r*h,this.ah=r*n-i*a,this.oh=i*h-s*n,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Bt.copy(this).projectOnVector(t),this.sub(Bt)}reflect(t){return this.sub(Bt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(r(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){this.rh();const e=this.nh-t.x,i=this.ah-t.y,s=this.oh-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return this.rh(),Math.abs(this.nh-t.x)+Math.abs(this.ah-t.y)+Math.abs(this.oh-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.eh(),this.nh=s*Math.sin(i),this.ah=Math.cos(e)*t,this.oh=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.eh(),this.nh=t*Math.sin(e),this.ah=i,this.oh=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.eh(),this.nh=e[12],this.ah=e[13],this.oh=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.eh(),this.nh=e,this.ah=i,this.oh=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return this.rh(),t.x===this.nh&&t.y===this.ah&&t.z===this.oh}fromArray(t,e=0){return this.nh===t[e]&&this.ah===t[e+1]&&this.oh===t[e+2]||(this.eh(),this.nh=t[e],this.ah=t[e+1],this.oh=t[e+2]),this}toArray(t=[],e=0){return this.rh(),t[e]=this.nh,t[e+1]=this.ah,t[e+2]=this.oh,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.eh(),this.nh=t.getX(e),this.ah=t.getY(e),this.oh=t.getZ(e),this}random(){return this.eh(),this.nh=Math.random(),this.ah=Math.random(),this.oh=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-Math.pow(t,2));return this.eh(),this.nh=i*Math.cos(e),this.ah=i*Math.sin(e),this.oh=t,this}*[Symbol.iterator](){this.rh(),yield this.nh,this.rh(),yield this.ah,this.rh(),yield this.oh}lengthManhattan(){throw new Error("deprecated")}distanceToManhattan(t){throw new Error("deprecated")}}const Bt=new Ft,Nt=new it;class Lt{constructor(t,e,i){this.ts=!1,this.ss=!1,this.es=!1,this.rs=!1,this.hs=!1,this.ns=this.os.bind(this),this.ls=this.fs.bind(this),this.cs=this.us.bind(this),this.ds=this.ps.bind(this),this.vs=this.bs.bind(this),this.Ts=this._s.bind(this),this.gs=this.Os.bind(this),this.Rs=this.xs.bind(this),this.ws=!1,this.isRegisteredToProcessor=!1,this.D=e,this.Ms=i,this.Ws=new Lt._transformObject3D,this.Ws.matrixAutoUpdate=!0,this.Ws.userData=this,e.scene.unsafeGetThreeScene().add(this.Ws),Object.defineProperties(this.Ws,{position:{writable:!0},rotation:{writable:!0},quaternion:{writable:!0},scale:{writable:!0}});const s=this.ns,r=this.ls,n=new Ft;n.onBeforeGetComponent(s),n.onBeforeChange(r),this.Ws.position=n;const h=new zt;h.onBeforeGetComponent(s),h.onBeforeChange(r),h._onChange(this.cs),this.Ws.rotation=h;const a=new Wt;a.onBeforeGetComponent(s),a.onBeforeChange(r),a._onChange(this.ds),this.Ws.quaternion=a;const o=new Ft(1,1,1);o.onBeforeGetComponent(s),o.onBeforeChange(r),this.Ws.scale=o,this._t=t;const l=this.vs,c=this.Ts,u=new Ft;u.onBeforeGetComponent(l),u.onBeforeChange(c),this.Cs=u;const d=new zt;d.onBeforeGetComponent(l),d.onBeforeChange(c),d._onChange(this.gs),this.Fs=d;const m=new Wt;m.onBeforeGetComponent(l),m.onBeforeChange(c),m._onChange(this.Rs),this.ys=m;const p=new Ft(1,1,1);p.onBeforeGetComponent(l),p.onBeforeChange(c),this.Ls=p,this.Vs()}os(){this.ws||this.Ps()}fs(){this.ws||(this.Ps(),this.Ss(),this.hs=!1,this.ss=!0,this.Vs(),this.As(),this.js())}us(){this.ws||this.Ws.quaternion.setFromEuler(this.Ws.rotation,!1)}ps(){this.ws||this.Ws.rotation.setFromQuaternion(this.Ws.quaternion,void 0,!1)}bs(){this.ws||this.Ds()}_s(){this.ws||(this.Ds(),this.Ss(),this.rs=!1,this.hs=!0,this.ss=!0,this.Vs(),this.Us(),this.js())}Os(){this.ws||this.ys.setFromEuler(this.Fs,!1)}xs(){this.ws||this.Fs.setFromQuaternion(this.ys,void 0,!1)}As(){this.rs=!0;const t=this.Ws.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof Lt&&i.userData.As()}}Us(){const t=this.Ws.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof Lt&&i.userData.As()}}Vs(){this.D.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Es()}Es(){this.es=!0;const t=this.Ws.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof Lt&&i.userData.Es()}}js(){this.ts=!0;const t=this.Ws.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof Lt&&i.userData.js()}}Ps(){if(this.hs){if(this.ss){this.es&&(this.ws=!0,this.Ws.matrixWorld.compose(this.Cs,this.ys,this.Ls),this.ws=!1,this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.Qs();const e=Lt._matrix4Buffer.copy(t.Ws.matrixWorld).invert();this.Ws.matrix.multiplyMatrices(this.Ws.matrixWorld,e)}else this.Ws.matrix.copy(this.Ws.matrixWorld);this.ss=!1}this.ws=!0,this.Ws.matrix.decompose(this.localPosition,this.localRotation,this.localScale),this.localEulerAngles.setFromQuaternion(this.localRotation,void 0,!1),this.ws=!1,this.hs=!1}}Ds(){this.rs&&(this.Qs(),this.ws=!0,this.Ws.matrixWorld.decompose(this.Cs,this.ys,this.Ls),this.Fs.setFromQuaternion(this.ys,void 0,!1),this.ws=!1,this.rs=!1)}Qs(){if(!this.es)return;const t=this.Ws.matrix;if(this.ss)if(this.hs)this.ws=!0,this.Ws.matrixWorld.compose(this.Cs,this.ys,this.Ls),this.ws=!1;else{this.ss&&(this.ws=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this.ws=!1,this.ss=!1);const e=this.parent;e?(e.Qs(),this.Ws.matrixWorld.multiplyMatrices(e.Ws.matrixWorld,t)):this.Ws.matrixWorld.copy(t)}else{const e=this.parent;e?(e.Qs(),this.Ws.matrixWorld.multiplyMatrices(e.Ws.matrixWorld,t)):this.Ws.matrixWorld.copy(t)}this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated()}Ns(){if(!this.ss)return;const t=this.Ws.matrix;if(this.es)if(this.rs)this.ws=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this.ws=!1;else{this.es&&(this.ws=!0,this.Ws.matrixWorld.compose(this.Cs,this.ys,this.Ls),this.ws=!1,this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.Qs();const e=Lt._matrix4Buffer.copy(t.Ws.matrixWorld).invert();this.Ws.matrix.multiplyMatrices(this.Ws.matrixWorld,e)}else this.Ws.matrix.copy(this.Ws.matrixWorld)}else{const t=this.parent;if(t){t.Qs();const e=Lt._matrix4Buffer.copy(t.Ws.matrixWorld).invert();this.Ws.matrix.multiplyMatrices(this.Ws.matrixWorld,e)}else this.Ws.matrix.copy(this.Ws.matrixWorld)}this.ss=!1}Bs(){this.Ps();const t=this.Ws.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof Lt&&i.userData.Bs()}}Ss(){const t=this.Ws.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof Lt&&(i.userData.Ps(),i.userData.Ss())}}tryUpdateWorldMatrixRecursivelyFromThisToChildren(){return!!this._t.exists&&this.qs()}qs(){this.Qs();const t=this.Ws.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof Lt&&i.userData.qs()}return!0}foreachChild(t){const e=this.Ws.children;for(let i=0,s=e.length;i<s;++i){const s=e[i];s.userData instanceof Lt&&t(s.userData)}}iterateChild(t){const e=this.Ws.children;for(let i=0,s=e.length;i<s;++i){const s=e[i];if(s.userData instanceof Lt&&!t(s.userData))break}}get parent(){return this.Ws.parent instanceof At?null:this.Ws.parent.userData}set parent(t){this.setParent(t)}setParent(t,e=!0){if(t){const i=this.parent;this.Bs(),this.Vs(),this.As(),e&&t.getWorldToLocalMatrix(this.Ws.matrix).multiply(this.Ws.matrixWorld),this.Ws.removeFromParent(),t.Ws.add(this.Ws),this.Ms(i,t)}else{const t=this.parent;this.Bs(),this.Vs(),this.As(),e&&this.Ws.matrix.copy(this.Ws.matrixWorld),this.Ws.removeFromParent(),this.D.scene.unsafeGetThreeScene().add(this.Ws),this.Ms(t,null)}}get children(){return this.Ws.children.filter((t=>t.userData instanceof Lt)).map((t=>t.userData))}get gameObject(){return this._t}getForward(t){this.Qs();const e=this.Ws.matrixWorld.elements;return t?t.set(e[8],e[9],e[10]):new st(e[8],e[9],e[10])}setForward(t){this.D.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ss(),this.ss=!0,this.hs=!0,this.Us(),this.As(),this.rs=!0;const e=this.Ws.matrixWorld.elements,i=Lt._vector3Buffer.copy(t).normalize();e[8]=i.x,e[9]=i.y,e[10]=i.z}getRight(t){this.Qs();const e=this.Ws.matrixWorld.elements;return t?t.set(e[0],e[1],e[2]):new st(e[0],e[1],e[2])}setRight(t){this.D.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ss(),this.ss=!0,this.hs=!0,this.Us(),this.As(),this.rs=!0;const e=this.Ws.matrixWorld.elements,i=Lt._vector3Buffer.copy(t).normalize();e[0]=i.x,e[1]=i.y,e[2]=i.z}getUp(t){this.Qs();const e=this.Ws.matrixWorld.elements;return t?t.set(e[4],e[5],e[6]):new st(e[4],e[5],e[6])}setUp(t){this.D.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ss(),this.ss=!0,this.hs=!0,this.Us(),this.As(),this.rs=!0;const e=this.Ws.matrixWorld.elements,i=Lt._vector3Buffer.copy(t).normalize();e[4]=i.x,e[5]=i.y,e[6]=i.z}get localPosition(){return this.Ws.position}get localEulerAngles(){return this.Ws.rotation}get localRotation(){return this.Ws.quaternion}get localScale(){return this.Ws.scale}get position(){return this.Cs}get eulerAngles(){return this.Fs}get rotation(){return this.ys}get lossyScale(){return this.Ls}get hasChanged(){return this.ts}set hasChanged(t){this.ts=t}getWorldToLocalMatrix(t){return this.Qs(),t?t.copy(this.Ws.matrixWorld).invert():this.Ws.matrixWorld.clone().invert()}getLocalToWorldMatrix(t){return this.Qs(),t?t.copy(this.Ws.matrixWorld):this.Ws.matrixWorld.clone()}transformPoint(t){return this.Qs(),this.Ws.localToWorld(t)}inverseTransformPoint(t){return this.Qs(),this.Ws.worldToLocal(t)}transformDirection(t){const e=Lt._matrix4Buffer.copy(this.Ws.matrixWorld).makeScale(1,1,1);return t.transformDirection(e)}inverseTransformDirection(t){const e=Lt._matrix4Buffer.copy(this.Ws.matrixWorld).makeScale(1,1,1).invert();return t.transformDirection(e)}transformVector(t){return t.transformDirection(this.Ws.matrixWorld)}inverseTransformVector(t){return t.transformDirection(Lt._matrix4Buffer.copy(this.Ws.matrixWorld).invert())}isChildOf(t){if(this===t)return!0;const e=this.parent;return!!e&&e.isChildOf(t)}lookAt(t){const e=this.parent;Lt._vector3Buffer.setFromMatrixPosition(this.Ws.matrixWorld);const i=Lt._matrix4Buffer.lookAt(Lt._vector3Buffer,t,this.Ws.up);if(this.Ws.quaternion.setFromRotationMatrix(i),e){i.extractRotation(e.Ws.matrixWorld);const t=Lt._quaternionBuffer.setFromRotationMatrix(i);this.Ws.quaternion.premultiply(t.invert())}}setRotationFromAxisAngle(t,e){this.Ws.setRotationFromAxisAngle(t,e)}setRotationFromEuler(t){this.Ws.setRotationFromEuler(t)}setRotationFromMatrix(t){this.Ws.setRotationFromMatrix(t)}setRotationFromQuaternion(t){this.Ws.setRotationFromQuaternion(t)}rotateOnAxis(t,e){return this.Ws.rotateOnAxis(t,e),this}rotateOnWorldAxis(t,e){return this.Ws.rotateOnWorldAxis(t,e),this}rotateX(t){return this.Ws.rotateX(t),this}rotateY(t){return this.Ws.rotateY(t),this}rotateZ(t){return this.Ws.rotateZ(t),this}translateOnAxis(t,e){return this.Ws.translateOnAxis(t,e),this}translateX(t){return this.Ws.translateX(t),this}translateY(t){return this.Ws.translateY(t),this}translateZ(t){return this.Ws.translateZ(t),this}unsafeGetObject3D(){return this.Ws}enqueueRenderAttachedObject3D(t){this.D.transformMatrixProcessor.enqueueRenderObject(t)}dequeueRenderAttachedObject3D(t){this.D.transformMatrixProcessor.dequeueRenderObject(t)}static updateRawObject3DWorldMatrixRecursively(t){t.matrixAutoUpdate&&t.updateMatrix(),t.parent?t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix):t.matrixWorld.copy(t.matrix);const e=t.children;for(let t=0,i=e.length;t<i;++t)Lt.updateRawObject3DWorldMatrixRecursivelyInternal(e[t])}static updateRawObject3DWorldMatrixRecursivelyInternal(t){t.matrixAutoUpdate&&t.updateMatrix(),t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix);const e=t.children;for(let t=0,i=e.length;t<i;++t)Lt.updateRawObject3DWorldMatrixRecursivelyInternal(e[t])}toJSON(){return{}}getLocalMatrix(){return this.Ns(),this.Ws.matrix}setLocalMatrix(t){this.Ws.matrix.copy(t),this.ss=!1,this.hs=!0,this.es=!0,this.rs=!0}getWorldMatrix(){return this.Qs(),this.Ws.matrixWorld}setWorldMatrix(t){this.Ws.matrixWorld.copy(t),this.ss=!0,this.hs=!0,this.es=!1,this.rs=!0}forceUpdateOthersFromLocalPositionRotationScale(){this.ss=!0,this.hs=!1,this.es=!0,this.rs=!0,this.tryUpdateWorldMatrixRecursivelyFromThisToChildren()}}Lt._transformObject3D=class extends It{updateMatrix(){this.userData.Ns()}updateMatrixWorld(t){this.userData.Qs()}updateWorldMatrix(t,e){if(this.userData.Qs(),e){const t=this.children;for(let e=0,i=t.length;e<i;++e)t[e].updateWorldMatrix(!1,!0)}}},Lt._matrix4Buffer=new ht,Lt._vector3Buffer=new st,Lt._quaternionBuffer=new it;class Vt{constructor(t,e){this.$t=!1,this.D=t,this.jt=t.instantiater.generateId(),this.Qt=!0,this.Vt=!0,this._initialized=!1,this.components=[],this.gameObjectEventContainer=new et,this.Xt=new Lt(this,t,this.Zt.bind(this)),this.Xt.unsafeGetObject3D().name=e}addChildFromBuilder(t){this.te();const e=t.build(this.transform);return t.processEvent(),e}Zt(t,e){if(e&&this.D!==e.gameObject.D)throw new Error("can't change parent to another engine instance");const i=this.transform.gameObject;e?i.Vt&&i.se(e.gameObject.Qt):i.se(i.Vt)}addComponent(t){this.te();const e=new t(this);if(e.engine_internal_constructAfterProcess(),e.disallowMultipleComponent&&this.getComponent(t))return console.warn(`Component ${t.name} already exists on GameObject ${this.name}`),null;const i=e.requiredComponents;for(let e=0;e<i.length;++e){const s=i[e];if(!this.getComponent(s))return console.warn(`Component ${s.name} is required by Component ${t.name} on GameObject ${this.name}`),null}return this.components.push(e),this.gameObjectEventContainer.registerComponent(e),this.Qt&&e.enabled&&(e._engine_internal_componentEventContainer.tryCallAwake(),e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate(),this.D.sceneProcessor.tryStartProcessSyncedEvent()),e}getComponent(t){this.te();const e=this.components;for(let i=0;i<e.length;++i){const s=e[i];if(s instanceof t)return s}return null}getComponents(t){if(this.te(),!t)return this.components.slice();const e=this.components,i=[];for(let s=0;s<e.length;++s){const r=e[s];r instanceof t&&i.push(r)}return i}getComponentInChildren(t){this.te();const e=this.getComponent(t);if(e)return e;let i=null;return this.Xt.iterateChild((e=>{const s=e.gameObject.getComponentInChildren(t);return!s||(i=s,!1)})),i}getComponentsInChildren(t){if(this.te(),t){const e=this.getComponents(t);return this.Xt.foreachChild((i=>{const s=i.gameObject.getComponentsInChildren(t);e.push(...s)})),e}{const t=this.getComponents();return this.Xt.foreachChild((e=>{t.push(...e.gameObject.getComponentsInChildren())})),t}}foreachComponent(t,e){this.te();const i=this.components;if(e)for(let s=0;s<i.length;++s){const r=i[s];r instanceof e&&t(r)}else for(let e=0;e<i.length;++e)t(i[e])}foreachComponentInChildren(t,e){this.te(),e?(this.foreachComponent(t,e),this.Xt.foreachChild((i=>{i.gameObject.foreachComponentInChildren(t,e)}))):(this.foreachComponent(t),this.Xt.foreachChild((e=>{e.gameObject.foreachComponentInChildren(t)})))}destroy(){Vt.destroyRecursively(this),this.D.sceneProcessor.tryStartProcessSyncedEvent(),this.D.sceneProcessor.addRemoveGameObject(this)}static destroyRecursively(t){if(t.$t)return;t.$t=!0,t.ie();const e=t.Xt.children;for(let t=0;t<e.length;++t){const i=e[t];i instanceof Lt&&Vt.destroyRecursively(i.gameObject)}}ie(){const t=this.components;for(let e=0;e<t.length;++e){const i=t[e];i._engine_internal_destroyed||(i.enabled&&this.Qt&&(i._engine_internal_componentEventContainer.tryRegisterOnDisable(),i._engine_internal_componentEventContainer.tryUnregisterStart(),i._engine_internal_componentEventContainer.tryUnregisterUpdate()),i.stopAllCoroutines(),i._engine_internal_componentEventContainer.tryRegisterOnDestroy(),i._engine_internal_destroyed=!0)}}removeFromParent(){this.Xt.unsafeGetObject3D().removeFromParent()}removeComponent(t){const e=this.components.indexOf(t);e>=0&&this.components.splice(e,1),this.gameObjectEventContainer.unregisterComponent(t)}get engine(){return this.D}get activeInHierarchy(){return this.Qt}set activeInHierarchy(t){if(this.Qt!==t){if(this.Qt=t,this._initialized){const t=this.components;if(this.Qt)for(let e=0;e<t.length;++e){const i=t[e];i.enabled&&(i._engine_internal_componentEventContainer.tryCallAwake(),i._engine_internal_componentEventContainer.tryRegisterOnEnable(),i._engine_internal_componentEventContainer.tryRegisterStart(),i._engine_internal_componentEventContainer.tryRegisterUpdate())}else for(let e=0;e<t.length;++e){const i=t[e];i.enabled&&(i._engine_internal_componentEventContainer.tryRegisterOnDisable(),i._engine_internal_componentEventContainer.tryUnregisterUpdate(),i.stopAllCoroutines())}}this.Xt.foreachChild((t=>{const e=t.gameObject;this.Qt?e.activeInHierarchy=e.Vt:e.activeInHierarchy=!1}))}}se(t){this.Qt!==t&&(this.activeInHierarchy=t,this._initialized&&this.D.sceneProcessor.tryStartProcessSyncedEvent())}get activeSelf(){return this.Vt}set activeSelf(t){this.te(),this.Vt!==t&&(this.Vt=t,this.Xt.parent instanceof Lt?this.Xt.parent.gameObject.Qt?this.se(this.Vt):this.se(!1):this.se(this.Vt))}get transform(){return this.Xt}get name(){return this.Xt.unsafeGetObject3D().name}set name(t){this.te(),this.Xt.unsafeGetObject3D().name=t}get instanceId(){return this.jt}get initialized(){return this._initialized}get exists(){return!this.$t}te(){if(this.$t)throw new Error("GameObject "+this.name+" is destroyed")}}class qt{constructor(t,e,i,s,r){this.ne=!1,this._t=new Vt(t,e);const n=this._t.transform;i&&n.localPosition.copy(i),s&&n.localRotation.copy(s),r&&n.localScale.copy(r),this.Y=[],this.oe=[]}active(t){return this._t.activeSelf=t,this}getGameObject(t){return t.ref=this._t,this}getComponent(t,e){return e.ref=this._t.getComponent(t),this}getComponents(t,e){return t.ref=e?this._t.getComponents(e):this._t.getComponents(),this}getComponentInChildren(t,e){return e.ref=this._t.getComponentInChildren(t),this}getComponentsInChildren(t,e){return t.ref=e?this._t.getComponentsInChildren(e):this._t.getComponentsInChildren(),this}withComponent(t,e){const i=new t(this._t);return i.engine_internal_constructAfterProcess(),i.disallowMultipleComponent&&this._t.getComponent(t)?(console.warn(`Component ${t.name} already exists on GameObject ${this._t.name}`),this):(this._t.components.push(i),this._t.gameObjectEventContainer.registerComponent(i),e&&this.oe.push((()=>e(i))),this)}withChild(t){return this.Y.push(t),this}re(t){let e=!1;const i=t.components;for(let s=0;s<i.length;++s){const r=i[s],n=r.requiredComponents;for(let i=0;i<n.length;i++){const s=n[i];t.getComponent(s)||(console.warn(`Component ${s.name} is required by Component ${r.constructor.name} on GameObject ${t.name}`),t.removeComponent(r),e=!0)}}e&&this.re(t)}build(t){if(this.ne)throw new Error("GameObjectBuilder is already built");return this.ne=!0,this.he(t),this.ce(),this.le(),this._t}he(t){this._t.transform.setParent(t,!1);const e=this.Y;for(let t=0;t<e.length;++t)e[t].he(this._t.transform)}ce(){this.re(this._t);const t=this.Y;for(let e=0;e<t.length;++e)t[e].ce()}le(){const t=this.oe;for(let e=0;e<t.length;++e)t[e]();const e=this.Y;for(let t=0;t<e.length;++t)e[t].le();this._t._initialized=!0}processEvent(){qt.processEventByGroup([this],this._t.engine.sceneProcessor)}static processEventByGroup(t,e){const i=[];for(let e=0;e<t.length;++e)i.push(...t[e]._t.getComponentsInChildren());for(let t=0;t<i.length;++t){const e=i[t];e.gameObject.activeInHierarchy&&e.enabled&&e._engine_internal_componentEventContainer.tryCallAwake()}for(let t=0;t<i.length;++t){const e=i[t];e._engine_internal_destroyed||e.gameObject.activeInHierarchy&&e.enabled&&(e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate())}e.tryStartProcessSyncedEvent()}}class Ht{constructor(t){this.B=0,this.q=0,this.D=t}generateId(){const t=this.B;return this.B+=1,t}generateEventId(){const t=this.q;return this.q+=1,t}buildGameObject(t,e,i,s){return new qt(this.D,t,e,i,s)}buildPrefab(t,e,i,s,r){return new e(this.D,t,i,s,r)}}class Gt{constructor(t,e,i,s,r,n,h,a,o,l){this.t=t,this.i=e,this.h=i,this.o=s,this.u=r,this.g=n,this.p=h,this.m=a,this.l=o,this.I=l,this.P=new k(l),this.H=new Ht(this)}applyGameSetting(t){this.l.applyPhysicsSettings(t.physics)}dispose(){this.P.dispose()}get scene(){return this.t}get cameraContainer(){return this.i}get screen(){return this.u}get input(){return this.P}get time(){return this.h}get physics(){return this.l}get gameState(){return this.o}get instantiater(){return this.H}get domElement(){return this.I}get sceneProcessor(){return this.g}get coroutineProcessor(){return this.p}get transformMatrixProcessor(){return this.m}get physics2DProcessor(){return this.l}}class Ut{constructor(t){this.k=t}get kind(){return this.k}set kind(t){this.k=t}}var Xt,Yt;(Yt=Xt||(Xt={}))[Yt.WaitingForStart=0]="WaitingForStart",Yt[Yt.Initializing=1]="Initializing",Yt[Yt.Running=2]="Running",Yt[Yt.Stopped=3]="Stopped",Yt[Yt.Finalizing=4]="Finalizing",Yt[Yt.Finalized=5]="Finalized";class Qt{constructor(){this.fe=new At,this.fe.matrixAutoUpdate=!1,this.fe.autoUpdate=!1}addChildFromBuilder(t){const e=t.build(null);return t.processEvent(),e}foreachChild(t){const e=this.fe.children;for(let i=0,s=e.length;i<s;++i){const s=e[i];s.userData instanceof Lt&&t(s.userData)}}iterateChild(t){const e=this.fe.children;for(let i=0,s=e.length;i<s;++i){const s=e[i];if(s.userData instanceof Lt&&!t(s.userData))break}}get children(){return this.fe.children.filter((t=>t.userData instanceof Lt)).map((t=>t.userData))}unsafeGetThreeScene(){return this.fe}}class Zt{constructor(t=0,e=0){Zt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),r=this.x-t.x,n=this.y-t.y;return this.x=r*i-n*s+t.x,this.y=r*s+n*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class $t{constructor(){this.wi=null,this.yi=8,this.Pi=3,this.mi=!0,this.Ei=null,this.pi=null,this.Si=new Map,this.Ti=null,this.Ii=null,this.reuseCollisionCallbacks=!0,this.xi=null,this.Ni=null}applyPhysicsSettings(t){var e;if(!t.loader)return;this.Ti=t.loader,this.pi=new this.Ti.World(new this.Ti.Vec2(0,-9.81));const i=class extends this.Ti.ContactListener{constructor(t){super(),this.Bi=t,this.Oi=new this.Bi.Ti.Collision2DPool,this.Li=new this.Bi.Ti.TriggerEventPool,this.Mi=new this.Bi.Ti.CollisionEventPool}BeginContact(t){const e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e.isTrigger||i.isTrigger)this.Li.insert(0,e,i);else if(this.Bi.reuseCollisionCallbacks){const s=this.Oi.getInstance();s.setData(t),this.Mi.insert(0,e,i,s,this.Oi)}else{const s=new this.Bi.Ti.Collision2D;s.setData(t),this.Mi.insert(0,e,i,s)}}EndContact(t){const e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e.isTrigger||i.isTrigger)this.Li.insert(2,e,i);else if(this.Bi.reuseCollisionCallbacks){const s=this.Oi.getInstance();s.setData(t),this.Mi.insert(2,e,i,s,this.Oi)}else{const s=new this.Bi.Ti.Collision2D;s.setData(t),this.Mi.insert(2,e,i,s)}}PreSolve(t,e){const i=t.GetFixtureA().GetUserData(),s=t.GetFixtureB().GetUserData();if(i.isTrigger||s.isTrigger)this.Li.insert(1,i,s);else if(this.Bi.reuseCollisionCallbacks){const e=this.Oi.getInstance();e.setData(t),this.Mi.insert(1,i,s,e,this.Oi)}else{const e=new this.Bi.Ti.Collision2D;e.setData(t),this.Mi.insert(1,i,s,e)}}onTriggerInvoke(){this.Li.invoke()}onCollisionInvoke(){this.Mi.invoke()}},s=new i(this);this.Ii=s,this.pi.SetContactListener(s),t.gravity&&(null===(e=this.pi)||void 0===e||e.SetGravity(t.gravity)),t.defaultMaterial&&(this.wi=t.defaultMaterial.clone()),t.velocityIterations&&(this.yi=t.velocityIterations),t.positionIterations&&(this.Pi=t.positionIterations),t.queriesHitTriggers&&(this.mi=t.queriesHitTriggers),t.reuseCollisionCallbacks&&(this.reuseCollisionCallbacks=t.reuseCollisionCallbacks),t.collisionLayerMaskMatrix?this.Ei=new this.Ti.CollisionLayerMaskConverter(t.collisionLayerMaskMatrix):this.Ei=new this.Ti.CollisionLayerMaskConverter({default:{default:!0}}),this.xi=new this.Ti.RayCastOneCallback(this),this.Ni=new this.Ti.RayCastFilterCallback}update(t){if(this.pi){{let t=this.pi.GetBodyList();for(;t;){const e=t;t=t.GetNext();const i=e.GetUserData().gameObject.transform,s=i.position,r=i.eulerAngles,n=e.GetPosition(),h=e.GetAngle();s.x===n.x&&s.y===n.y||(e.SetPosition(s),e.SetAwake(!0)),r.z!==h&&(e.SetAngle(r.z),e.SetAwake(!0))}}this.pi.Step(t,this.yi,this.Pi);{let t=this.pi.GetBodyList();for(;t;){const e=t;t=t.GetNext();const i=e.GetUserData().gameObject.transform;i.position.x=e.GetPosition().x,i.position.y=e.GetPosition().y,i.eulerAngles.z=e.GetAngle()}}this.Ii.onTriggerInvoke(),this.Ii.onCollisionInvoke()}}addRigidBody(t,e,i){if(!this.pi)throw new Error("Physics2D is not loaded.");let s=this.Si.get(t);if(s){const t=s.addRigidBody(e),r=t.body;return r.SetType(i.type),r.SetPosition(i.position),r.SetAngle(i.angle),r.SetLinearVelocity(i.linearVelocity),r.SetAngularVelocity(i.angularVelocity),r.SetLinearDamping(i.linearDamping),r.SetAngularDamping(i.angularDamping),r.SetSleepingAllowed(i.allowSleep),r.SetAwake(i.awake),r.SetFixedRotation(i.fixedRotation),r.SetBullet(i.bullet),r.SetEnabled(i.enabled),r.SetUserData(i.userData),r.SetGravityScale(i.gravityScale),t}return s=new this.Ti.PhysicsObject2D(t,this.pi.CreateBody(i),(()=>this.Si.delete(t))),this.Si.set(t,s),s.addRigidBody(e)}removeRigidBody(t){const e=this.Si.get(t);if(!e)throw new Error("PhysicsObject2D not found");e.removeRigidBody()}Ri(t){const e=new this.Ti.BodyDef;return e.type=this.Ti.BodyType.b2_kinematicBody,e.position.x=t.transform.position.x,e.position.y=t.transform.position.y,e.angle=t.transform.eulerAngles.z,e}addCollider(t,e){if(!this.pi)throw new Error("Physics2D is not loaded.");let i=this.Si.get(t);return i||(i=new this.Ti.PhysicsObject2D(t,this.pi.CreateBody(this.Ri(t)),(()=>this.Si.delete(t)))),this.Si.set(t,i),i.addCollider(e)}removeCollider(t,e,i){const s=this.Si.get(t);if(!s)throw new Error("PhysicsObject2D not found");s.removeCollider(e,i)}get physicsLoader(){return this.Ti}get gravity(){if(!this.pi)throw new Error("Physics2D is not loaded.");const t=this.pi.GetGravity();return new Zt(t.x,t.y)}set gravity(t){if(!this.pi)throw new Error("Physics2D is not loaded.");this.pi.SetGravity(new this.Ti.Vec2(t.x,t.y))}get defaultMaterial(){return this.wi}get velocityIterations(){return this.yi}set velocityIterations(t){this.yi=t}get positionIterations(){return this.Pi}set positionIterations(t){this.Pi=t}get maxLinearCorrection(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxLinearCorrection}get maxAngularCorrection(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxAngularCorrection}get maxTranslationSpeed(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxTranslation}get maxRotationSpeed(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxRotation}get baumgarteScale(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.baumgarte}get baumgarteTimeOfImpactScale(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.toiBaumgarte}get timeToSleep(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.timeToSleep}get linearSleepTolerance(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.linearSleepTolerance}get angularSleepTolerance(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.angularSleepTolerance}get queriesHitTriggers(){return this.mi}set queriesHitTriggers(t){this.mi=t}get collisionLayerMask(){return this.Ei}raycastOne(t,e,i,s=Number.POSITIVE_INFINITY,r=4294967295,n=Number.NEGATIVE_INFINITY,h=Number.POSITIVE_INFINITY){if(!this.pi)throw new Error("Physics2D is not loaded.");i||(i=new this.Ti.RaycastHit2D);const a=$t._raycastEndPoint.copy(e).multiplyScalar(s===Number.POSITIVE_INFINITY?1e7:s).add(t);return this.xi.setRaycastData(i,t,r,n,h),this.pi.RayCast(this.xi,t,a),this.xi.hit?i:null}raycast(t,e,i,s,r=Number.POSITIVE_INFINITY){if(!this.pi)throw new Error("Physics2D is not loaded.");const n=$t._raycastEndPoint.copy(e).multiplyScalar(r===Number.POSITIVE_INFINITY?1e7:r).add(t);return this.Ni.setRaycastData(s,t,i),this.pi.RayCast(this.Ni,t,n),this.Ni.hitCount}}$t._raycastEndPoint=new Zt;class Jt{constructor(t){this.nr=null,this.ar=new Map,this.ur=new $(void 0,((t,e)=>t.info.priority===e.info.priority?t.camera.instanceId-e.camera.instanceId:e.info.priority-t.info.priority)),this.dr=t}get camera(){var t,e;return null!==(e=null===(t=this.nr)||void 0===t?void 0:t.camera)&&void 0!==e?e:null}get currentCameraPriority(){var t,e;return null!==(e=null===(t=this.nr)||void 0===t?void 0:t.info.priority)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}addCamera(t,e){this.ar.set(t,e),this.ur.insert({camera:t,info:e}),this.lr()}removeCamera(t){const e=this.ar.get(t);e&&(this.ur.eraseElementByKey({camera:t,info:e}),this.ar.delete(t),this.lr())}changeCameraPriority(t,e){const i=this.ar.get(t);i&&(this.ur.eraseElementByKey({camera:t,info:i}),i.priority=e,this.ur.insert({camera:t,info:i}),this.lr())}changeCameraBackgroundColor(t,e){var i;const s=this.ar.get(t);s&&(s.backgroundColor=e,(null===(i=this.nr)||void 0===i?void 0:i.camera)===t&&this.dr(e))}lr(){if(0===this.ur.size())return void(this.nr=null);const t=this.ur.front();t?(this.nr=t,this.dr(this.nr.info.backgroundColor)):this.nr=null}}class Kt{constructor(t,e){this.ze=t,this.Te=e,this.Ue=new T}get width(){return this.ze}get height(){return this.Te}get onResize(){return this.Ue}resize(t,e){this.ze=t,this.Te=e,this.Ue.invoke(t,e)}}const te=new st,ee=new it,ie=new st,se=new ht,re=new ht;class ne{constructor(){this.ze=0,this.Te=0,this.We=0,this.Ze=0,this.Ae={camera:{fov:0,style:""}};const t=document.createElement("div");t.style.overflow="hidden",this.domElement=t,this.Be=document.createElement("div"),this.Be.style.transformStyle="preserve-3d",this.Be.style.pointerEvents="none",this.domElement.appendChild(this.Be)}getSize(){return{width:this.ze,height:this.Te}}render(t,e,i){const s=i.projectionMatrix.elements[5]*this.Ze;let r,n;this.Ae.camera.fov!==s&&(this.domElement.style.perspective=i.isPerspectiveCamera?s+"px":"",this.Ae.camera.fov=s),!0===e.autoUpdate&&e.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),i.isOrthographicCamera?(r=-(i.right+i.left)/2,n=(i.top+i.bottom)/2):(r=1,n=1);const h=(i.isOrthographicCamera?"scale("+s+")translate("+this.Ge(r)+"px,"+this.Ge(n)+"px)"+this.Je(i.matrixWorldInverse):"translateZ("+s+"px)"+this.Je(i.matrixWorldInverse))+"translate("+this.We+"px,"+this.Ze+"px)";this.Ae.camera.style!==h&&(this.Be.style.transform=h,this.Ae.camera.style=h);for(const s of t)this.Le(s,e,i)}setSize(t,e){this.ze=t,this.Te=e,this.We=this.ze/2,this.Ze=this.Te/2,this.domElement.style.width=t+"px",this.domElement.style.height=e+"px",this.Be.style.width=t+"px",this.Be.style.height=e+"px"}Ge(t){return Math.abs(t)<1e-10?0:t}Je(t){const e=t.elements,i=this.Ge;return"matrix3d("+i(e[0])+","+i(-e[1])+","+i(e[2])+","+i(e[3])+","+i(e[4])+","+i(-e[5])+","+i(e[6])+","+i(e[7])+","+i(e[8])+","+i(-e[9])+","+i(e[10])+","+i(e[11])+","+i(e[12])+","+i(-e[13])+","+i(e[14])+","+i(e[15])+")"}Ne(t){const e=t.elements,i=this.Ge;return"translate(-50%,-50%)matrix3d("+i(e[0])+","+i(e[1])+","+i(e[2])+","+i(e[3])+","+i(-e[4])+","+i(-e[5])+","+i(-e[6])+","+i(-e[7])+","+i(e[8])+","+i(e[9])+","+i(e[10])+","+i(e[11])+","+i(e[12])+","+i(e[13])+","+i(e[14])+","+i(e[15])+")"}Le(t,e,i){if(t.isCSS3DObject){let s;t.onBeforeRender(this,e,i),t.isCSS3DSprite?(se.copy(i.matrixWorldInverse),se.transpose(),0!==t.rotation2D&&se.multiply(re.makeRotationZ(t.rotation2D)),t.matrixWorld.decompose(te,ee,ie),se.setPosition(te),se.scale(ie),se.elements[3]=0,se.elements[7]=0,se.elements[11]=0,se.elements[15]=1,s=this.Ne(se)):s=this.Ne(t.matrixWorld);const r=t.element;r.style.transform=s,r.style.display=t.visible?"":"none",r.parentNode!==this.Be&&this.Be.appendChild(r),t.onAfterRender(this,e,i)}}}class he{constructor(){this.Xe=[],this.Ye=new Set,this.$e=new Set}cr(){const t=this.Ye;this.Ye=this.$e,this.$e=t}enqueueTransformToUpdate(t){t.isRegisteredToProcessor||(t.isRegisteredToProcessor=!0,this.Xe.push(t))}enqueueRenderObject(t){this.$e.add(t)}dequeueRenderObject(t){this.$e.delete(t)}flush(){this.Ye.clear()}update(){const t=this.Xe;for(let e=0;e<t.length;++e){const i=t[e];i.tryUpdateWorldMatrixRecursivelyFromThisToChildren(),i.isRegisteredToProcessor=!1}return this.Xe.length=0,this.cr(),this.Ye}}class ae{constructor(){this.N=new J(K.comparator),this.J=new J(K.comparator),this.L=!1,this.U=[],this.V=[]}addEventToNonSyncedCollection(t){this.N.insert(t)}removeEventFromNonSyncedCollection(t){this.N.delete(t)}addEventToSyncedCollection(t){this.J.insert(t)}startProcessNonSyncedEvent(){this.N.forEach((t=>t.invoke()))}tryStartProcessSyncedEvent(){this.L||(this.L=!0,this.J.forEach((t=>t.invoke())),this.J.clear(),this.L=!1)}addRemoveGameObject(t){this.U.push(t)}addRemoveComponent(t){this.V.push(t)}processRemoveObject(){const t=this.V;for(let e=0;e<t.length;++e)t[e].gameObject.removeComponent(t[e]);const e=this.U;for(let t=0;t<e.length;++t)e[t].removeFromParent()}}class oe{constructor(){this.tm=1/3,this.im=0,this.h=0,this.sm=0,this.hm=0,this.rm=0,this.am=1}start(){this.im=performance.now()}update(){const t=performance.now();let e=(t-this.im)/1e3;this.tm<e&&(e=this.tm),this.rm=e,this.sm+=e,this.hm=e*this.am,this.h+=this.hm,this.im=t}get time(){return this.h}get unscaledTime(){return this.sm}get deltaTime(){return this.hm}get unscaledDeltaTime(){return this.rm}get timeScale(){return this.am}set timeScale(t){this.am=t}get maximumDeltaTime(){return this.tm}set maximumDeltaTime(t){this.tm=t}}class le{constructor(t,e=!0){this.S=null;const i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="relative",t.appendChild(i),t=i,this.G=new Qt,this.C=new Kt(t.clientWidth,t.clientHeight),this.K=t,this.i=new Jt((t=>{this.T?this.G.unsafeGetThreeScene().background=new _(t.r,t.g,t.b):this.v&&(this.v.domElement.style.backgroundColor="rgba("+255*t.r+","+255*t.g+","+255*t.b+","+t.a+")")})),this.h=new oe,this.o=new Ut(Xt.WaitingForStart),this.g=new ae,this.p=new S(this.h),this.m=new he,this.l=new $t,this.D=new Gt(this.G,this.i,this.h,this.o,this.C,this.g,this.p,this.m,this.l,t),this.O=null,this.F=!1,this.j=e,this.A=this.resizeFramebuffer.bind(this),e&&window.addEventListener("resize",this.A),this.M=this.R.bind(this)}resizeFramebuffer(){const t=this.K.clientWidth,e=this.K.clientHeight;t===this.C.width&&e===this.C.height||(this.C.resize(t,e),this.v&&(this.v.setSize(t,e),this.v.domElement.style.width="100%",this.v.domElement.style.height="100%"),this.T&&(this.T.setSize(t,e),this._.style.width="100%",this._.style.height="100%"))}run(t,e){if(this.F)throw new Error("Game is disposed.");if(this.o.kind!==Xt.WaitingForStart)throw new Error("Game is already running.");this.o.kind=Xt.Initializing,this.h.start();const i=new t(this.D,e),s=i.run();if(this.S=i.getGameSettingObject(),this.D.applyGameSetting(this.S),this.S.render.webGLRenderer){const t=this.K;this.T=this.S.render.webGLRenderer,this._=this.S.render.webGlRendererDomElement,this.T.setSize(t.clientWidth,t.clientHeight),this._.style.position="absolute",t.appendChild(this._)}if(this.S.render.useCss3DRenderer){const t=this.K;this.v=new ne,this.v.setSize(t.clientWidth,t.clientHeight);const e=this.v.domElement;e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.pointerEvents="none",e.onscroll=t=>{const e=t.target;e.scrollTop=0,e.scrollLeft=0},t.appendChild(e)}if(s.build(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");if(this.o.kind=Xt.Running,this.g.startProcessNonSyncedEvent(),this.l.update(this.h.deltaTime),this.p.updateAfterProcess(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");this.g.processRemoveObject();const r=this.m.update();this.v&&this.v.render(r,this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.T&&this.T.render(this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.m.flush(),this.p.endFrameAfterProcess(),this.O=requestAnimationFrame(this.M)}R(){if(this.h.update(),this.g.startProcessNonSyncedEvent(),this.l.update(this.h.deltaTime),this.p.tryCompact(),this.p.updateAfterProcess(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");this.g.processRemoveObject();const t=this.m.update();this.v&&this.v.render(t,this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.T&&this.T.render(this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.m.flush(),this.p.endFrameAfterProcess(),this.O=requestAnimationFrame(this.M)}stop(){if(this.F)throw new Error("Game is disposed.");if(this.o.kind!==Xt.Running)throw new Error("Game is not running.");this.o.kind=Xt.Stopped,this.O&&cancelAnimationFrame(this.O),this.O=null}resume(){if(this.F)throw new Error("Game is disposed.");if(this.o.kind!==Xt.Stopped)throw new Error("Game is not stopped.");this.o.kind=Xt.Running,this.R()}dispose(){if(this.F)return;this.o.kind=Xt.Finalizing,this.O&&cancelAnimationFrame(this.O),this.D.dispose();const t=this.G.children;for(let e=0;e<t.length;++e)t[e].gameObject.destroy();this.j&&window.removeEventListener("resize",this.A),this.v&&this.K.removeChild(this.v.domElement),this._&&this.K.removeChild(this._),this.K.remove(),this.F=!0,this.o.kind=Xt.Finalized}get inputHandler(){return this.D.input}get currentGameState(){return this.o.kind}}class ce{constructor(t){this.g=t,this.Y=[]}withChild(t){return this.Y.push(t),this}build(){const t=this.Y;for(let e=0;e<t.length;++e)t[e].build(null);qt.processEventByGroup(t,this.g)}}class ue{constructor(t){this.it=t}static createDefaultObject(){return{}}loader(t){return this.it.loader=t,this}gravity(t){return this.it.gravity=t,this}defaultMaterial(t){return this.it.defaultMaterial=t,this}velocityIterations(t){return this.it.velocityIterations=t,this}positionIterations(t){return this.it.positionIterations=t,this}queriesHitTriggers(t){return this.it.queriesHitTriggers=t,this}reuseCollisionCallbacks(t){return this.it.reuseCollisionCallbacks=t,this}layerCollisionMatrix(t){return this.it.collisionLayerMaskMatrix=t,this}}class de{constructor(t){this.ee=t}static createDefaultObject(){return{useCss3DRenderer:!0}}useCss3DRenderer(t){return this.ee.useCss3DRenderer=t,this}webGLRenderer(t,e){return this.ee.webGLRenderer=t,this.ee.webGlRendererDomElement=null!=e?e:t.domElement,this}}class me{constructor(t){this.Z=t,this.$=new de(this.Z.render),this.tt=new ue(this.Z.physics)}static createDefaultObject(){return{render:de.createDefaultObject(),physics:ue.createDefaultObject()}}get render(){return this.$}get physics(){return this.tt}make(){return this.Z}}class pe{constructor(t=null){this.ref=t}}class fe extends It{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ht,this.projectionMatrix=new ht,this.projectionMatrixInverse=new ht}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class ge extends fe{constructor(t=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*s*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*e*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*s*Math.atan(Math.tan(.5*e*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,s,r,n){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(.5*e*this.fov)/this.zoom,s=2*i,r=this.aspect*s,n=-.5*r;const h=this.view;if(null!==this.view&&this.view.enabled){const t=h.fullWidth,e=h.fullHeight;n+=h.offsetX*r/t,i-=h.offsetY*s/e,r*=h.width/t,s*=h.height/e}const a=this.filmOffset;0!==a&&(n+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,i,i-s,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}class ye extends fe{constructor(t=-1,e=1,i=1,s=-1,r=.1,n=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=r,this.far=n,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,r,n){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-t,n=i+t,h=s+e,a=s-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,n=r+t*this.view.width,h-=e*this.view.offsetY,a=h-e*this.view.height}this.projectionMatrix.makeOrthographic(r,n,h,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class _e{constructor(t,e,i){this.gt=t,this.vt=0,this.xt=e,this.It=null,this.Tt=!1,this.Yt=i}get component(){return this.gt}get elapsedTime(){return this.vt}set elapsedTime(t){this.vt=t}get currentYieldInstruction(){return this.It}get currentYieldInstructionExist(){return this.Tt}fatchNextInstruction(){var t;const e=this.xt.next();return e.done?(this.It=null,this.Tt=!1,null===(t=this.Yt)||void 0===t||t.call(this),this.Yt=null,null):(this.It=e.value,this.Tt=!0,this.It)}}class be{constructor(){this.awakeCalled=!1,this.startRegistered=!1,this.startCalled=!1,this.updateRegistered=!1,this.enabled=!1}}class ve{constructor(t){this.Rt=null,this.qt=null,this.zt=null,this.Bt=null,this.Gt=null,this.Ht=null,this.Jt=null,this.Kt=null,this.Lt=null,this.Mt=null,this.gt=t,this.g=t.engine.sceneProcessor,this.H=t.engine.instantiater,this.Nt=new be,function(t){return void 0!==t.awake}(t)&&(this.Rt=K.createAwakeEvent(this.H,t.awake.bind(t))),function(t){return void 0!==t.onDestroy}(t)&&(this.qt=K.createOnDestroyEvent(this.H,t.onDestroy.bind(t),t.executionOrder)),function(t){return void 0!==t.onCollisionEnter2D}(t)&&(this.zt=K.createOnCollisionEnter2DEvent(this.H,(e=>t.onCollisionEnter2D(e)),t.executionOrder)),function(t){return void 0!==t.onCollisionStay2D}(t)&&(this.Bt=K.createOnCollisionStay2DEvent(this.H,(e=>t.onCollisionStay2D(e)),t.executionOrder)),function(t){return void 0!==t.onCollisionExit2D}(t)&&(this.Gt=K.createOnCollisionExit2DEvent(this.H,(e=>t.onCollisionExit2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerEnter2D}(t)&&(this.Ht=K.createOnTriggerEnter2DEvent(this.H,(e=>t.onTriggerEnter2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerStay2D}(t)&&(this.Jt=K.createOnTriggerStay2DEvent(this.H,(e=>t.onTriggerStay2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerExit2D}(t)&&(this.Kt=K.createOnTriggerExit2DEvent(this.H,(e=>t.onTriggerExit2D(e)),t.executionOrder)),function(t){return void 0!==t.start}(t)&&(this.Lt=K.createStartEvent(this.H,(()=>{this.Nt.startCalled=!0,t.start(),this.Nt.startRegistered&&this.g.removeEventFromNonSyncedCollection(this.Lt)}),t.executionOrder)),function(t){return void 0!==t.update}(t)&&(this.Mt=K.createUpdateEvent(this.H,t.update.bind(t),t.executionOrder))}tryCallAwake(){var t;this.Nt.awakeCalled||(this.Nt.awakeCalled=!0,null===(t=this.Rt)||void 0===t||t.invoke())}tryRegisterOnEnable(){if(this.gt._engine_internal_destroyed)return;if(this.Nt.enabled)return;if(this.Nt.enabled=!0,!function(t){return void 0!==t.onEnable}(this.gt))return;const t=K.createOnEnableEvent(this.H,this.gt.onEnable.bind(this.gt),this.gt.executionOrder);this.g.addEventToSyncedCollection(t)}tryRegisterOnDisable(){if(this.gt._engine_internal_destroyed)return;if(!this.Nt.enabled)return;if(this.Nt.enabled=!1,!function(t){return void 0!==t.onDisable}(this.gt))return;const t=K.createOnDisableEvent(this.H,this.gt.onDisable.bind(this.gt),this.gt.executionOrder);this.g.addEventToSyncedCollection(t)}tryRegisterOnDestroy(){this.qt&&this.g.addEventToSyncedCollection(this.qt)}tryRegisterStart(){this.Lt&&(this.gt._engine_internal_destroyed||this.Nt.startCalled||this.Nt.startRegistered||(this.Nt.startRegistered=!0,this.g.addEventToNonSyncedCollection(this.Lt)))}tryUnregisterStart(){this.Lt&&this.Nt.startRegistered&&!this.Nt.startCalled&&(this.Nt.startRegistered=!1,this.g.removeEventFromNonSyncedCollection(this.Lt))}tryRegisterUpdate(){this.Mt&&(this.gt._engine_internal_destroyed||this.Nt.updateRegistered||(this.Nt.updateRegistered=!0,this.g.addEventToNonSyncedCollection(this.Mt)))}tryUnregisterUpdate(){this.Mt&&this.Nt.updateRegistered&&(this.Nt.updateRegistered=!1,this.g.removeEventFromNonSyncedCollection(this.Mt))}get onCollisionEnter2D(){return this.zt}get onCollisionStay2D(){return this.Bt}get onCollisionExit2D(){return this.Gt}get onTriggerEnter2D(){return this.Ht}get onTriggerStay2D(){return this.Jt}get onTriggerExit2D(){return this.Kt}}class we{constructor(t){this.disallowMultipleComponent=!1,this.requiredComponents=[],this.executionOrder=0,this._runningCoroutines=[],this._engine_internal_destroyed=!1,this._enabled=!0,this._gameObject=t,this._instanceId=t.engine.instantiater.generateId(),this._engine_internal_componentEventContainer=null}engine_internal_constructAfterProcess(){this._engine_internal_componentEventContainer=new ve(this),Object.defineProperties(this,{disallowMultipleComponent:{configurable:!1,writable:!1},requiredComponents:{configurable:!1,writable:!1},executionOrder:{configurable:!1,writable:!1}})}startCoroutine(t){this.checkComponentIsExist();const e=new _e(this,t,(()=>{const t=this._runningCoroutines.indexOf(e);t>=0&&this._runningCoroutines.splice(t,1)}));return e.fatchNextInstruction(),this._gameObject.activeInHierarchy?(this._runningCoroutines.push(e),this.engine.coroutineProcessor.addCoroutine(e),e):e}stopAllCoroutines(){this.checkComponentIsExist();const t=this._runningCoroutines,e=this.engine.coroutineProcessor;for(let i=0;i<t.length;++i){const s=t[i];if(s.component!==this)throw new Error("Coroutine is not owned by this component");e.removeCoroutine(s)}t.length=0}stopCoroutine(t){if(this.checkComponentIsExist(),t.component!==this)throw new Error("Coroutine is not owned by this component");this.engine.coroutineProcessor.removeCoroutine(t);const e=this._runningCoroutines.indexOf(t);e>=0&&this._runningCoroutines.splice(e,1)}get enabled(){return this._enabled}set enabled(t){this.checkComponentIsExist(),this._enabled!==t&&(this._enabled=t,this._gameObject.initialized&&this._gameObject.activeInHierarchy&&(this._enabled?(this._engine_internal_componentEventContainer.tryRegisterOnEnable(),this._engine_internal_componentEventContainer.tryRegisterStart(),this._engine_internal_componentEventContainer.tryRegisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent()):(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent())))}checkComponentIsExist(){if(this._engine_internal_destroyed)throw new Error("Component "+this.constructor.name+" is destroyed")}get gameObject(){return this._gameObject}get transform(){return this._gameObject.transform}get engine(){return this._gameObject.engine}get instanceId(){return this._instanceId}get initialized(){return this._gameObject.initialized}get exists(){return!this._engine_internal_destroyed}destroy(){this._engine_internal_destroyed||(this.enabled&&this.gameObject.activeInHierarchy&&(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate()),this.stopAllCoroutines(),this._engine_internal_componentEventContainer.tryRegisterOnDestroy(),this._engine_internal_destroyed=!0,this.engine.sceneProcessor.tryStartProcessSyncedEvent(),this.engine.sceneProcessor.addRemoveComponent(this))}}class xe{constructor(t=0,e=0,i=0,s=1){1<t?t=1:0>t&&(t=0),1<e?e=1:0>e&&(e=0),1<i?i=1:0>i&&(i=0),1<s?s=1:0>s&&(s=0),this.Wi=t,this.$i=e,this.Xi=i,this.Yi=s}set(t,e,i,s=1){return 1<t?t=1:0>t&&(t=0),1<e?e=1:0>e&&(e=0),1<i?i=1:0>i&&(i=0),1<s?s=1:0>s&&(s=0),this.Wi=t,this.$i=e,this.Xi=i,this.Yi=s,this}copy(t){return this.Wi=t.r,this.$i=t.g,this.Xi=t.b,this.Yi=t.a,this}clone(){return new xe(this.Wi,this.$i,this.Xi,this.Yi)}get r(){return this.Wi}set r(t){1<t?t=1:0>t&&(t=0),this.Wi=t}get g(){return this.$i}set g(t){1<t?t=1:0>t&&(t=0),this.$i=t}get b(){return this.Xi}set b(t){1<t?t=1:0>t&&(t=0),this.Xi=t}get a(){return this.Yi}set a(t){1<t?t=1:0>t&&(t=0),this.Yi=t}toString(){return"rgb("+255*this.Wi+", "+255*this.$i+", "+255*this.Xi+")"}toStringWithAlpha(){return"rgba("+255*this.Wi+", "+255*this.$i+", "+255*this.Xi+", "+this.Yi+")"}toHex(){return"#"+((Math.round(255*this.Wi)<<16)+(Math.round(255*this.$i)<<8)+(Math.round(255*this.Xi)<<0)).toString(16).padStart(6,"0")}toHexWithAlpha(){return"#"+((Math.round(255*this.Wi)<<16)+(Math.round(255*this.$i)<<8)+(Math.round(255*this.Xi)<<0)).toString(16).padStart(6,"0")+Math.round(255*this.Yi).toString(16).padStart(2,"0")}toArray(){return[this.Wi,this.$i,this.Xi,this.Yi]}static fromHex(t){const e=parseInt(t.slice(1,3),16)/255,i=parseInt(t.slice(3,5),16)/255,s=parseInt(t.slice(5,7),16)/255;return new xe(e,i,s)}static fromArray(t){return new xe(t[0],t[1],t[2],t[3])}static fromString(t){const e=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*(?:\.\d+)?)\)$/);return e?new xe(parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseFloat(e[4])):xe.fromHex(t)}hueRotate(t=0,e){t=t/180*Math.PI;const i=Math.sin(t),s=Math.cos(t);this.multiplyMatrix((null!=e?e:new _t).set(.213+.787*s-.213*i,.715-.715*s-.715*i,.072-.072*s+.928*i,.213-.213*s+.143*i,.715+.285*s+.14*i,.072-.072*s-.283*i,.213-.213*s-.787*i,.715-.715*s+.715*i,.072+.928*s+.072*i))}grayscale(t=1,e){this.multiplyMatrix((null!=e?e:new _t).set(.2126+.7874*(1-t),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)))}sepia(t=1,e){this.multiplyMatrix((null!=e?e:new _t).set(.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)))}saturate(t=1,e){this.multiplyMatrix((null!=e?e:new _t).set(.213+.787*t,.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t))}brightness(t=1){this.linear(t)}contrast(t=1){this.linear(t,-.5*t+.5)}invert(t=1){let e=t+this.Wi*(1-2*t),i=t+this.$i*(1-2*t),s=t+this.Xi*(1-2*t);1<e?e=1:e<0&&(e=0),1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),this.Wi=e,this.$i=i,this.Xi=s}multiplyMatrix(t){const e=t.elements;let i=this.Wi*e[0]+this.$i*e[1]+this.Xi*e[2],s=this.Wi*e[3]+this.$i*e[4]+this.Xi*e[5],r=this.Wi*e[6]+this.$i*e[7]+this.Xi*e[8];return 1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),1<r?r=1:r<0&&(r=0),this.Wi=i,this.$i=s,this.Xi=r,this}linear(t=1,e=0){let i=this.Wi*t+e,s=this.$i*t+e,r=this.Xi*t+e;return 1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),1<r?r=1:r<0&&(r=0),this.Wi=i,this.$i=s,this.Xi=r,this}hsl(){const t=this.Wi,e=this.$i,i=this.Xi,s=Math.max(t,e,i),r=Math.min(t,e,i);let n,h;const a=(s+r)/2;if(s===r)n=h=0;else{const o=s-r;switch(h=a>.5?o/(2-s-r):o/(s+r),s){case t:n=(e-i)/o+(e<i?6:0);break;case e:n=(i-t)/o+2;break;case i:n=(t-e)/o+4;break;default:throw new Error("Unreachable")}n/=6}return{h:n,s:h,l:a}}}class Ce{constructor(t,e){this.Dt=t,this.Cr=(new xe).copy(e)}get priority(){return this.Dt}set priority(t){this.Dt=t}get backgroundColor(){return this.Cr}set backgroundColor(t){this.Cr.copy(t)}}var Se,Ee,Me,Te;!function(t){t[t.Perspective=0]="Perspective",t[t.Orthographic=1]="Orthographic"}(Se||(Se={}));class ke extends we{constructor(){super(...arguments),this.mh=null,this.Ta=Se.Orthographic,this.va=75,this.ya=5,this.wa=1,this.Oa=.1,this.Pa=1e3,this.Dt=0,this._a=new xe(1,1,1,0),this.i=null,this.ba=(t,e)=>{const i=t/e;if(this.mh instanceof ge)this.mh.aspect=i,this.mh.updateProjectionMatrix();else if(this.mh instanceof ye){const t=this.ya;this.mh.left=-t*i,this.mh.right=t*i,this.mh.top=t,this.mh.bottom=-t,this.mh.updateProjectionMatrix()}}}awake(){this.i=this.engine.cameraContainer}onEnable(){this.engine.screen.onResize.addListener(this.ba),this.ka()}onWorldMatrixUpdated(){this.mh&&(Lt.updateRawObject3DWorldMatrixRecursively(this.mh),this.mh.matrixWorldInverse.copy(this.mh.matrixWorld).invert())}ka(){const t=this.engine.screen.width/this.engine.screen.height;if(this.Ta===Se.Perspective)this.mh?this.mh instanceof ge?(this.mh.aspect=t,this.mh.fov=this.va,this.mh.near=this.Oa,this.mh.far=this.Pa,this.mh.updateProjectionMatrix()):(this.mh.removeFromParent(),ke.removeCameraFromDuckPool(this.mh),this.mh=this.xa(),this.transform.unsafeGetObject3D().add(this.mh)):(this.mh=this.xa(),this.transform.unsafeGetObject3D().add(this.mh));else{if(this.Ta!==Se.Orthographic)throw new Error("Camera type not supported");if(this.mh)if(this.mh instanceof ye){const e=this.ya;this.mh.left=-e*t,this.mh.right=e*t,this.mh.top=e,this.mh.bottom=-e,this.mh.near=this.Oa,this.mh.far=this.Pa,this.mh.updateProjectionMatrix()}else this.mh.removeFromParent(),ke.removeCameraFromDuckPool(this.mh),this.mh=this.za(),this.transform.unsafeGetObject3D().add(this.mh);else this.mh=this.za(),this.transform.unsafeGetObject3D().add(this.mh)}Lt.updateRawObject3DWorldMatrixRecursively(this.mh),this.i.addCamera(this,new Ce(this.Dt,this._a))}xa(){const t=this.engine.screen.width/this.engine.screen.height,e=new ge(this.va,t,this.Oa,this.Pa);return 1!==this.wa&&(e.zoom=this.wa,e.updateProjectionMatrix()),e}za(){const t=this.engine.screen.width/this.engine.screen.height,e=this.ya,i=new ye(-e*t,e*t,e,-e,this.Oa,this.Pa);return 1!==this.wa&&(i.zoom=this.wa,i.updateProjectionMatrix()),i}onDisable(){this.engine.screen.onResize.removeListener(this.ba),this.mh&&this.i.removeCamera(this)}onDestroy(){this.mh&&(this.mh.removeFromParent(),ke.removeCameraFromDuckPool(this.mh))}get cameraType(){return this.Ta}set cameraType(t){this.Ta!==t&&(this.Ta=t,this.mh&&this.ka())}get fov(){return this.mh instanceof ge?this.va=this.mh.fov:this.va}set fov(t){if(this.mh instanceof ge){if(this.mh.fov===t)return;this.va=this.mh.fov=t,this.mh.updateProjectionMatrix()}else this.va=t}get viewSize(){return this.mh instanceof ye?this.ya=this.mh.top:this.ya}set viewSize(t){if(this.mh instanceof ye){if(this.mh.top===t)return;this.ya=t;const e=this.engine.screen.width/this.engine.screen.height,i=this.ya;this.mh.left=-i*e,this.mh.right=i*e,this.mh.top=i,this.mh.bottom=-i,this.mh.updateProjectionMatrix()}else this.ya=t}get zoom(){return this.mh?this.wa=this.mh.zoom:this.wa}set zoom(t){const e=this.mh;if(e){if(e.zoom===t)return;this.wa=e.zoom=t,e.updateProjectionMatrix()}else this.wa=t}get near(){return this.mh?this.Oa=this.mh.near:this.Oa}set near(t){const e=this.mh;if(e){if(e.near===t)return;this.Oa=e.near=t,e.updateProjectionMatrix()}else this.Oa=t}get far(){return this.mh?this.Pa=this.mh.far:this.Pa}set far(t){const e=this.mh;if(e){if(e.far===t)return;this.Pa=e.far=t,e.updateProjectionMatrix()}else this.Pa=t}get priority(){return this.Dt}set priority(t){this.Dt=t,this.mh&&this.i.changeCameraPriority(this,t)}get backgroundColor(){return this._a}set backgroundColor(t){this._a.copy(t),this.mh&&this.i.changeCameraBackgroundColor(this,t)}get threeCamera(){return this.mh}static removeCameraFromDuckPool(t){}}class Oe extends It{constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable","false"),this.addEventListener("removed",(()=>{this.traverse((t=>{t instanceof Oe&&t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}new st,new it,new st,new ht,new ht;class De{constructor(t=0,e=0,i=0,s=new xe,r=null){this.tc=t,this.sc=e,this.dl=i,this.fc=(new xe).copy(s),this.vl=r}get onChange(){return this.vl}set onChange(t){this.vl=t}get offsetX(){return this.tc}set offsetX(t){var e;this.tc=t,null===(e=this.vl)||void 0===e||e.call(this)}get offsetY(){return this.sc}set offsetY(t){var e;this.sc=t,null===(e=this.vl)||void 0===e||e.call(this)}get blur(){return this.dl}set blur(t){var e;this.dl=t,null===(e=this.vl)||void 0===e||e.call(this)}get color(){return this.fc}set color(t){var e;this.fc.copy(t),null===(e=this.vl)||void 0===e||e.call(this)}copy(t){var e;this.tc=t.offsetX,this.sc=t.offsetY,this.dl=t.blur,this.fc.copy(t.color),null===(e=this.vl)||void 0===e||e.call(this)}clone(){return new De(this.tc,this.sc,this.dl,this.fc.clone())}toString(){return"drop-shadow("+this.tc+"px "+this.sc+"px "+this.dl+"px "+this.fc.toString()+")"}}class je{constructor(t=null){this.dl=0,this.ud=1,this.vd=1,this.fd=null,this.gd=0,this.pd=0,this.wd=0,this.Sd=1,this.bd=0,this.vl=t}copy(t){var e;this.dl=t.dl,this.ud=t.ud,this.vd=t.vd,!this.fd&&t.fd?(this.fd=new De(void 0,void 0,void 0,void 0,this.vl),this.fd.copy(t.fd)):this.fd&&t.fd&&this.fd.copy(t.fd),this.gd=t.gd,this.pd=t.pd,this.wd=t.wd,this.Sd=t.Sd,this.bd=t.bd,null===(e=this.vl)||void 0===e||e.call(this)}clone(){const t=new je;return t.copy(this),t}get blur(){return this.dl}set blur(t){var e;this.dl=t,null===(e=this.vl)||void 0===e||e.call(this)}get brightness(){return this.ud}set brightness(t){var e;this.ud=t,null===(e=this.vl)||void 0===e||e.call(this)}get contrast(){return this.vd}set contrast(t){var e;this.vd=t,null===(e=this.vl)||void 0===e||e.call(this)}get dropShadow(){return this.fd}set dropShadow(t){t?(this.fd||(this.fd=new De(void 0,void 0,void 0,void 0,this.vl)),this.fd.copy(t)):this.fd&&(this.fd.onChange=null,this.fd=null)}get grayscale(){return this.gd}set grayscale(t){var e;this.gd=t,null===(e=this.vl)||void 0===e||e.call(this)}get hueRotate(){return this.pd}set hueRotate(t){var e;this.pd=t,null===(e=this.vl)||void 0===e||e.call(this)}get invert(){return this.wd}set invert(t){var e;this.wd=t,null===(e=this.vl)||void 0===e||e.call(this)}get saturate(){return this.Sd}set saturate(t){var e;this.Sd=t,null===(e=this.vl)||void 0===e||e.call(this)}get sepia(){return this.bd}set sepia(t){var e;this.bd=t,null===(e=this.vl)||void 0===e||e.call(this)}toString(){let t="";return 0!==this.dl&&(t+="blur("+this.dl+"px) "),1!==this.ud&&(t+="brightness("+this.ud+") "),1!==this.vd&&(t+="contrast("+this.vd+") "),0!==this.gd&&(t+="grayscale("+this.gd+") "),0!==this.pd&&(t+="hue-rotate("+this.pd+"deg) "),0!==this.wd&&(t+="invert("+this.wd+") "),1!==this.Sd&&(t+="saturate("+this.Sd+") "),0!==this.bd&&(t+="sepia("+this.bd+") "),this.fd&&(t+=this.fd.toString()),t}}class Ie extends we{constructor(){super(...arguments),this.css3DObject=null,this.htmlElement=null,this.da=new Zt,this.rn=.1,this.en=!0,this.on=()=>{this.htmlElement&&(this.htmlElement.style.filter=this.Ui.toString())},this.Ui=new je(this.on),this.Cl=!1}start(){this.Cl=!0,this.renderInitialize()}onDestroy(){this.css3DObject&&(this.transform.dequeueRenderAttachedObject3D(this.css3DObject),this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=null,this.htmlElement=null)}onEnable(){this.css3DObject&&(this.css3DObject.visible=!0,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onDisable(){this.css3DObject&&(this.css3DObject.visible=!1,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onWorldMatrixUpdated(){this.css3DObject&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}renderInitialize(){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}initializeBaseComponents(t){const e=this.htmlElement;if(!e)throw new Error("htmlElement is null");let i=!1;return t?(this.css3DObject&&this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=new Oe(e),i=!0):this.css3DObject?this.css3DObject.element=e:(this.css3DObject=new Oe(e),i=!0),i&&(e.style.pointerEvents=this.pointerEvents?"auto":"none",e.style.filter=this.Ui.toString(),this.enabled&&this.gameObject.activeInHierarchy?this.css3DObject.visible=!0:this.css3DObject.visible=!1),this.updateViewScale(!1),this.updateCenterOffset(!1),this.transform.unsafeGetObject3D().add(this.css3DObject),this.css3DObject}updateCenterOffset(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}updateViewScale(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}get centerOffset(){return this.da}set centerOffset(t){this.da.copy(t),this.updateCenterOffset(!0)}get viewScale(){return this.rn}set viewScale(t){this.rn=t,this.updateViewScale(!0)}get pointerEvents(){return this.en}set pointerEvents(t){this.en=t,this.htmlElement&&(this.htmlElement.style.pointerEvents=t?"auto":"none")}get filter(){return this.Ui}get readyToDraw(){return this.Cl}get htmlElementEventHandler(){return this.htmlElement}}!function(t){t.Left="left",t.Center="center",t.Right="right"}(Ee||(Ee={})),function(t){t.Normal="normal",t.Bold="bold"}(Me||(Me={}));class Ae extends Ie{constructor(){super(...arguments),this.tf=2,this.if=1,this.iu=!1,this.sf=8,this.hf=Me.Normal,this.ef="Arial",this.rf=Ee.Left,this.nf=new xe(1,1,1,1),this.ff=null,this.Ca=null}renderInitialize(){var t;null===(t=this.Ca)||void 0===t||t.call(this),this.htmlElement||(this.text=Ae._defaultText)}updateCenterOffset(t){if(!this.css3DObject)return;let e,i;if(this.iu)if(this.css3DObject.element.parentElement){const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="",e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t}else{const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="";const s=this.css3DObject.element.style.transform;this.css3DObject.element.style.transform="translateX(1000000px)",document.body.appendChild(this.css3DObject.element),e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t,this.css3DObject.element.style.transform=s,document.body.removeChild(this.css3DObject.element)}else e=this.tf,i=this.if;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale;this.iu?(this.css3DObject.scale.set(e,e,e),this.updateCenterOffset(!1)):(this.css3DObject.element.style.width=this.tf/this.viewScale+"px",this.css3DObject.element.style.height=this.if/this.viewScale+"px",this.css3DObject.scale.set(e,e,e)),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get text(){return this.ff}set text(t){this.ff=t,this.readyToDraw?this.lf(t):this.Ca=()=>this.lf(t)}lf(t){this.htmlElement||(this.htmlElement=document.createElement("div")),this.htmlElement.textContent=null!=t?t:"",this.iu?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.tf+"px",this.htmlElement.style.height=this.if+"px"),this.htmlElement.style.fontSize=this.sf+"px",this.htmlElement.style.fontWeight=this.hf,this.htmlElement.style.fontFamily=this.ef,this.htmlElement.style.textAlign=this.rf,this.htmlElement.style.color=this.nf.toHex(),this.htmlElement.style.opacity=this.nf.a.toString();const e=this.initializeBaseComponents(!1);Lt.updateRawObject3DWorldMatrixRecursively(e),this.transform.enqueueRenderAttachedObject3D(e)}get textWidth(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetWidth;return this.htmlElement.style.display=t,e}return 0}return this.tf}set textWidth(t){this.iu||(this.tf=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get textHeight(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetHeight;return this.htmlElement.style.display=t,e}return 0}return this.if}set textHeight(t){this.iu||(this.if=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get autoSize(){return this.iu}set autoSize(t){this.iu=t,this.htmlElement&&(t?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.tf/this.viewScale+"px",this.htmlElement.style.height=this.if/this.viewScale+"px"))}get fontSize(){return this.sf}set fontSize(t){this.sf=t,this.htmlElement&&(this.htmlElement.style.fontSize=t+"px")}get fontWeight(){return this.hf}set fontWeight(t){this.hf=t,this.htmlElement&&(this.htmlElement.style.fontWeight=t)}get fontFamily(){return this.ef}set fontFamily(t){this.ef=t,this.htmlElement&&(this.htmlElement.style.fontFamily=t)}get textAlign(){return this.rf}set textAlign(t){this.rf=t,this.htmlElement&&(this.htmlElement.style.textAlign=t)}get textColor(){return this.nf}set textColor(t){this.nf.copy(t),this.htmlElement&&(this.htmlElement.style.color=t.toHex(),this.htmlElement.style.opacity=t.a.toString())}}Ae._defaultText="Text";class ze extends we{constructor(){super(...arguments),this._player=null,this._slider=null,this._playButton=null,this._frameDisplayText=null,this.onSliderInput=t=>{if(!this._player)return;const e=t.target.valueAsNumber;this._player.isPlaying||this._player.process(e),this._player.frameTime=e},this._pausedBySlider=!1,this.onSliderMouseDown=t=>{this._player&&this._player.isPlaying&&(this._pausedBySlider=!0,this._player.pause())},this.onSliderMouseUp=t=>{this._player&&this._pausedBySlider&&(this._pausedBySlider=!1,this._player.play())},this.onPlayButtonClick=t=>{this._player&&(this._player.isPlaying?this._player.pause():this._player.play())},this.onAnimationProcess=t=>{this._slider&&(this._slider.value=t.toString(),this._frameDisplayText&&(this._frameDisplayText.textContent=Math.floor(t).toString()))},this.onAnimationStart=()=>{this._playButton&&(this._playButton.textContent="Stop")},this.onAnimationPaused=()=>{this._playButton&&(this._pausedBySlider||(this._playButton.textContent="Play"))},this.onAnimationEnd=()=>{this._playButton&&(this._playButton.textContent="Play")}}onDestroy(){this._player&&(this._player.onAnimationProcess.removeListener(this.onAnimationProcess),this._player.onAnimationStart.removeListener(this.onAnimationStart),this._player.onAnimationPaused.removeListener(this.onAnimationPaused),this._player.onAnimationEnd.removeListener(this.onAnimationEnd)),this._slider&&(this._slider.removeEventListener("input",this.onSliderInput),this._slider.removeEventListener("onmousedown",this.onSliderMouseDown),this._slider.removeEventListener("onmouseup",this.onSliderMouseUp)),this._playButton&&this._playButton.removeEventListener("click",this.onPlayButtonClick),this._player=null,this._slider=null,this._playButton=null,this._frameDisplayText=null}get player(){return this._player}set player(t){this._player&&(this._player.onAnimationProcess.removeListener(this.onAnimationProcess),this._player.onAnimationStart.removeListener(this.onAnimationStart),this._player.onAnimationPaused.removeListener(this.onAnimationPaused),this._player.onAnimationEnd.removeListener(this.onAnimationEnd)),this._player=t,t&&(t.onAnimationProcess.addListener(this.onAnimationProcess),t.onAnimationStart.addListener(this.onAnimationStart),t.onAnimationPaused.addListener(this.onAnimationPaused),t.onAnimationEnd.addListener(this.onAnimationEnd),this._playButton&&(t.isPlaying?this._playButton.textContent="Stop":this._playButton.textContent="Play"))}get slider(){return this._slider}set slider(t){var e,i,s,r;this._slider=t,t&&(this._player&&(t.min=null!==(i=null===(e=this._player.animationContainer)||void 0===e?void 0:e.startFrame.toString())&&void 0!==i?i:"0",t.max=null!==(r=null===(s=this._player.animationContainer)||void 0===s?void 0:s.endFrame.toString())&&void 0!==r?r:"0"),t.addEventListener("input",this.onSliderInput),t.addEventListener("mousedown",this.onSliderMouseDown),t.addEventListener("mouseup",this.onSliderMouseUp))}get playButton(){return this._playButton}set playButton(t){this._playButton=t,this._playButton&&(this._player&&(this._player.isPlaying?this._playButton.textContent="Stop":this._playButton.textContent="Play"),this._playButton.addEventListener("click",this.onPlayButtonClick))}get frameDisplayText(){return this._frameDisplayText}set frameDisplayText(t){this._frameDisplayText=t}}!function(t){t[t.None=0]="None",t[t.Loop=1]="Loop"}(Te||(Te={}));class Re extends we{constructor(){super(...arguments),this._animationSequnace=null,this._bindInfo=null,this._animationSequanceInstace=null,this._elapsedTime=0,this._frameRate=60,this._isPlaying=!1,this._loopMode=Te.None,this._animationClock=null,this._onAnimationProcessEvent=new T,this._onAnimationStartEvent=new T,this._onAnimationPausedEvent=new T,this._onAnimationEndEvent=new T,this.playByClock=()=>{this._isPlaying=!0,this._onAnimationStartEvent.invoke()},this.pauseByClock=()=>{this._isPlaying=!1,this._onAnimationPausedEvent.invoke()},this.stopByClock=()=>{this._isPlaying=!1,this._elapsedTime=0,this._onAnimationEndEvent.invoke()},this.processByClock=t=>{var e;const i=t*this._frameRate;null===(e=this._animationSequanceInstace)||void 0===e||e.process(i),this._onAnimationProcessEvent.invoke(i)}}get onAnimationProcess(){return this._onAnimationProcessEvent}get onAnimationStart(){return this._onAnimationStartEvent}get onAnimationPaused(){return this._onAnimationPausedEvent}get onAnimationEnd(){return this._onAnimationEndEvent}onDestroy(){const t=this._animationClock;t&&(t.onPlayed.removeListener(this.playByClock),t.onPaused.removeListener(this.pauseByClock),t.onStopped.removeListener(this.stopByClock),t.onJumped.removeListener(this.processByClock))}update(){var t;if(!this._animationSequanceInstace||!this._isPlaying)return;this._animationClock?this._elapsedTime=this._animationClock.currentTime:this._elapsedTime+=this.engine.time.deltaTime;let e=this._elapsedTime*this._frameRate;if(this._animationSequnace.endFrame<e){if(this._loopMode===Te.Loop&&(this._elapsedTime=e%this._animationSequnace.endFrame/this._frameRate,this._animationSequanceInstace.frameIndexHint(0)),this._animationClock)null===(t=this._animationClock)||void 0===t||t.setPosition(this._elapsedTime);else{e=this._elapsedTime*this._frameRate;const t=Math.floor(e);this._animationSequanceInstace.process(t),this._onAnimationProcessEvent.invoke(t)}this._loopMode===Te.None&&this.stop()}else{const t=Math.floor(e);this._animationSequanceInstace.process(t),this._onAnimationProcessEvent.invoke(t)}}play(){if(!this._isPlaying){if(!this._animationSequanceInstace){if(!this._animationSequnace)throw new Error("animationSequnace is not set");if(!this._bindInfo)throw new Error("bindInfo is not set");this._animationSequanceInstace=this._animationSequnace.createInstance(this._bindInfo)}this._animationClock?this._animationClock.play():(this._isPlaying=!0,this._onAnimationStartEvent.invoke())}}pause(){this._animationClock?this._animationClock.pause():this._isPlaying&&(this._isPlaying=!1,this._onAnimationPausedEvent.invoke())}stop(){this._animationClock?this._animationClock.stop():this._isPlaying&&(this._isPlaying=!1,this._elapsedTime=0,this._onAnimationEndEvent.invoke())}process(t){if(!this._animationSequnace)throw new Error("animationSequnace is not set");if(!this._bindInfo)throw new Error("bindInfo is not set");this._animationSequanceInstace||(this._animationSequanceInstace=this._animationSequnace.createInstance(this._bindInfo)),this._animationClock?this._animationClock.setPosition(t/this._frameRate):(this._animationSequanceInstace.process(t),this._onAnimationProcessEvent.invoke(t))}get animationSequnace(){return this._animationSequnace}get animationContainer(){return this._animationSequnace}setAnimationAndBind(t,e){this._animationSequnace=t,this._bindInfo=e,this._animationSequanceInstace&&(this._animationSequanceInstace.bindInfo=e)}get isPlaying(){return this._isPlaying}get loopMode(){return this._loopMode}set loopMode(t){this._loopMode=t}get elapsedTime(){return this._animationClock?this._animationClock.currentTime:this._elapsedTime}set elapsedTime(t){var e;this._elapsedTime=t,null===(e=this._animationClock)||void 0===e||e.setPosition(t)}get frameTime(){return this._elapsedTime*this._frameRate}set frameTime(t){this.elapsedTime=t/this._frameRate}get frameRate(){return this._frameRate}set frameRate(t){this._frameRate=t}get animationClock(){return this._animationClock}set animationClock(t){const e=this._animationClock;e&&(e.onPlayed.removeListener(this.playByClock),e.onPaused.removeListener(this.pauseByClock),e.onStopped.removeListener(this.stopByClock),e.onJumped.removeListener(this.processByClock)),this._animationClock=t,t&&(t.onPlayed.addListener(this.playByClock),t.onPaused.addListener(this.pauseByClock),t.onStopped.addListener(this.stopByClock),t.onJumped.addListener(this.processByClock))}}var Pe=i(769),We=i.n(Pe);const Fe=("undefined"!=typeof navigator&&navigator.hardwareConcurrency||1)>2?navigator.hardwareConcurrency:4;function Be(t){t.byteLength=0,t.frames.length=0}function Ne(t,e){t.byteLength=t.byteLength+e._section.byteLength,t.frames.push(e)}const Le=(t,e,i,s)=>async()=>{let r;for(;r=e.pop();)s[t.get(r)]=await i(r)};function Ve(t,e){return new Promise(t.decodeAudioData.bind(t,e))}var qe,He,Ge,Ue;!function(t){t[t.Waiting=0]="Waiting",t[t.Playing=1]="Playing",t[t.Paused=2]="Paused",t[t.Stopped=3]="Stopped",t[t.Disposed=4]="Disposed"}(qe||(qe={}));class Xe extends we{constructor(){super(...arguments),this._context=null,this._source=null,this._gainNode=null,this._gain=0,this._pendingPlay=!1,this._startTime=0,this._jumpedPosition=-1,this._state=qe.Waiting,this._onPlayedEvent=new T,this._onPausedEvent=new T,this._onStoppedEvent=new T,this._onJumpedEvent=new T,this.onEnded=()=>{this.getContext().suspend(),this._state=qe.Stopped,this._onStoppedEvent.invoke()}}getContext(){return this._state===qe.Disposed?null:(this._context||(this._context=new AudioContext,this._context.suspend()),this._context)}getGainNode(){var t;if(this._state===qe.Disposed)return null;const e=this.getContext();return this._gainNode||(this._gainNode=e.createGain(),this._gainNode.gain.value=this._gain,this._gainNode.connect(e.destination),null===(t=this._source)||void 0===t||t.connect(this._gainNode)),this._gainNode}onDestroy(){this._source&&(this._source.stop(),this._source.disconnect(),this._source=null),this._gainNode&&(this._gainNode.disconnect(),this._gainNode=null),this._context&&(this._context.close(),this._context=null),this._state=qe.Disposed}onDisable(){this.stop()}setAudioFromAudioBuffer(t){const e=this.getContext();if(!e)return;const i=this._source=e.createBufferSource();i.onended=this.onEnded,i.buffer=t,i.connect(e.destination),this._gainNode&&i.connect(this._gainNode),this._pendingPlay&&(this._pendingPlay=!1,this.play())}asyncSetAudioFromArrayBuffer(t,e,i){const s=this.getContext();s&&async function(t,e,i={}){const{native:s=!1,concurrency:r=Fe}=i;if(s)return Ve(e,t);const n=new DataView(t),h=We().readTags(n).pop(),a=new Uint8Array(t),o=[],l=function(t,e,i){return function(s){t.push(function(t,e){const i=new Uint8Array(t.byteLength+e.byteLength);return i.set(t,0),i.set(e,t.byteLength),i.buffer}(e,i.subarray(s.frames[0]._section.offset,s.frames[s.frames.length-1]._section.offset+s.frames[s.frames.length-1]._section.byteLength)))}}(o,a.subarray(0,h._section.offset),a);let c={byteLength:0,frames:[]},u=h._section.offset+h._section.byteLength;for(;u;){const t=We().readFrame(n,u);u=t&&t._section.nextFrameIndex,t&&(c&&c.byteLength+t._section.byteLength>=1e6&&(l(c),Be(c)),Ne(c,t)),!c||t&&u||l(c)}const d=[],m=new Map(o.map(((t,e)=>[t,e]))),p=new Array(o.length),f=Ve.bind(null,e);for(let t=0;t<Math.min(r,m.size);t++)d.push(Le(m,o,f,p)());await Promise.all(d);const{numberOfChannels:g,sampleRate:y}=p[0];let _=p.reduce(((t,e)=>t+e.length),0);const b=e.createBuffer(g,_,y);for(let t=0;t<g;t++){const e=b.getChannelData(t);let i=0;for(let s=0;s<p.length;s++)e.set(p[s].getChannelData(t),i),i+=p[s].length}return b}(t,s).then((t=>{this.setAudioFromAudioBuffer(t),null==e||e()})).catch((t=>{if(!(t instanceof DOMException))throw t;null==i||i(t)}))}asyncSetAudioFromUrl(t,e,i){this.getContext()&&fetch(t).then((t=>t.arrayBuffer())).then((t=>this.asyncSetAudioFromArrayBuffer(t,e,i))).catch((t=>{if(!(t instanceof DOMException))throw t;null==i||i(t)}))}play(){if(this._state!==qe.Disposed){if(!this.enabled||!this.gameObject.activeInHierarchy)throw new Error("Cannot play audio when audio player is disabled");if(this._source){if(this._state!==qe.Playing){if(this._state===qe.Waiting){const t=this.getContext(),e=t.currentTime;this._jumpedPosition>=0?(this._startTime=e-this._jumpedPosition,this._source.start(e,this._jumpedPosition),this._jumpedPosition=-1):(this._startTime=e,this._source.start(e)),t.resume()}else if(this._state===qe.Paused)if(this._jumpedPosition>=0){const t=this.getContext(),e=this.refreshSource(t),i=t.currentTime;this._startTime=i-this._jumpedPosition,e.start(i,this._jumpedPosition),this._jumpedPosition=-1,t.resume()}else this.getContext().resume();else if(this._state===qe.Stopped){const t=this.getContext(),e=this.refreshSource(t),i=t.currentTime;this._jumpedPosition>=0?(this._startTime=i-this._jumpedPosition,e.start(i,this._jumpedPosition),this._jumpedPosition=-1):(this._startTime=i,e.start(i)),t.resume()}this._state=qe.Playing,this._onPlayedEvent.invoke()}}else this._pendingPlay=!0}}pause(){this._state!==qe.Disposed&&(this._pendingPlay&&(this._pendingPlay=!1),this._state===qe.Playing&&(this.getContext().suspend(),this._state=qe.Paused,this._onPausedEvent.invoke()))}stop(){this._state!==qe.Disposed&&(this._pendingPlay&&(this._pendingPlay=!1),this._state===qe.Playing&&(this.getContext().suspend(),this._state=qe.Stopped,this._onStoppedEvent.invoke()))}setPosition(t){if(this._state!==qe.Disposed){if(this._state===qe.Playing){if(!this._source)return;const e=this.getContext(),i=this.refreshSource(e),s=e.currentTime;this._startTime=s-t,i.start(s,t)}else this._jumpedPosition=t;this._onJumpedEvent.invoke(t)}}refreshSource(t){const e=this._source;e.onended=null,e.disconnect();const i=t.createBufferSource();return i.onended=this.onEnded,i.buffer=e.buffer,i.connect(t.destination),this._gainNode&&i.connect(this._gainNode),this._source=i}get currentTime(){return this._source?this._source.context.currentTime-this._startTime:0}get duration(){return this._source?this._source.buffer.duration:0}get isPlaying(){return this._state===qe.Playing}get gain(){return this._gain}set gain(t){this._gain=t;const e=this.getGainNode();e&&(e.gain.value=t)}get onPlayed(){return this._onPlayedEvent}get onPaused(){return this._onPausedEvent}get onStopped(){return this._onStoppedEvent}get onJumped(){return this._onJumpedEvent}}class Ye extends we{constructor(){super(...arguments),this.requiredComponents=[Ae],this.text="Loading",this._textRenderer=null,this._elapsedTime=0,this._dotCount=1}awake(){this._textRenderer=this.gameObject.getComponent(Ae)}update(){this._elapsedTime+=this.engine.time.deltaTime,this._elapsedTime>.5&&(this._elapsedTime=0,this._textRenderer.text=this.text+".".repeat(this._dotCount),this._dotCount%=3,this._dotCount+=1)}}class Qe{constructor(t,e,i,s,r){this._instantiater=t.instantiater,this._gameObjectBuilder=new qt(t,e,i,s,r)}get instantiater(){return this._instantiater}get gameObjectBuilder(){return this._gameObjectBuilder}}class Ze{}Ze.defaultSpriteSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAA8SURBVDhP7dEhCgAxDADB+/k9Lh8rDCtq6yo6JrAhKt9s/k2JEjceNGlPiRI3HjRpT4kS7w81SpQ4PJhZxl3jEH3ZDWcAAAAASUVORK5CYII=",(Ge=He||(He={})).Auto="auto",Ge.CrispEdges="crisp-edges",Ge.Pixelated="pixelated";class $e extends Ie{constructor(){super(...arguments),this.Ia=0,this.ja=0,this.Ga=!1,this.Ha=!1,this.Wa=1,this.nn=He.Pixelated,this.Ca=null}renderInitialize(){this.Ca?this.Ca():this.asyncSetImageFromPath(Ze.defaultSpriteSrc)}updateCenterOffset(t){this.css3DObject&&(this.css3DObject.position.set(this.Ia*this.centerOffset.x,this.ja*this.centerOffset.y,0),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale,i=this.htmlElement;i.style.width=this.Ia/this.viewScale+"px",i.style.height=this.ja/this.viewScale+"px";const s=this.Ga?-1:1,r=this.Ha?-1:1;this.css3DObject.scale.set(e*s,e*r,e),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get image(){return this.htmlElement}asyncSetImageFromPath(t,e){var i;if(!this.readyToDraw)return void(this.Ca=()=>this.asyncSetImageFromPath(t,e));const s=null!==(i=this.htmlElement)&&void 0!==i?i:new Image;s.src=t;const r=t=>{this.exists&&(s.removeEventListener("load",r),this.setImage(s),null==e||e())};s.addEventListener("load",r)}setImage(t){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);if(this.htmlElement=t,!this.readyToDraw)return void(this.Ca=()=>this.setImage(t));t.alt=this.gameObject.name+"_sprite",t.style.imageRendering=this.nn,0===this.Ia&&(this.Ia=.1*t.naturalWidth),0===this.ja&&(this.ja=.1*t.naturalHeight),t.style.width=this.Ia/this.viewScale+"px",t.style.height=this.ja/this.viewScale+"px",t.style.opacity=this.Wa.toString();const e=this.initializeBaseComponents(!1);Lt.updateRawObject3DWorldMatrixRecursively(e),this.transform.enqueueRenderAttachedObject3D(e)}get imageWidth(){return this.Ia}set imageWidth(t){this.Ia=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageHeight(){return this.ja}set imageHeight(t){this.ja=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageFlipX(){return this.Ga}set imageFlipX(t){this.Ga=t,this.css3DObject&&(this.Ga?0<this.css3DObject.scale.x&&(this.css3DObject.scale.x*=-1):this.css3DObject.scale.x<0&&(this.css3DObject.scale.x*=-1),Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get imageFlipY(){return this.Ha}set imageFlipY(t){this.Ha=t,this.css3DObject&&(this.Ha?0<this.css3DObject.scale.y&&(this.css3DObject.scale.y*=-1):this.css3DObject.scale.y<0&&(this.css3DObject.scale.y*=-1),Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get opacity(){return this.Wa}set opacity(t){this.Wa=t,this.htmlElement&&(this.htmlElement.style.opacity=this.Wa.toString())}get imageRenderingMode(){return this.nn}set imageRenderingMode(t){this.nn=t,this.htmlElement&&(this.htmlElement.style.imageRendering=this.nn)}}class Je extends Ie{constructor(){super(...arguments),this.tu=1,this.su=1,this.iu=!1,this.Ca=null}renderInitialize(){var t;null===(t=this.Ca)||void 0===t||t.call(this),this.htmlElement||(this.element=null)}updateCenterOffset(t){if(!this.css3DObject)return;let e,i;if(this.iu)if(this.css3DObject.element.parentElement){const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="",e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t}else{const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="";const s=this.css3DObject.element.style.transform;this.css3DObject.element.style.transform="translateX(1000000px)",document.body.appendChild(this.css3DObject.element),e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t,this.css3DObject.element.style.transform=s,document.body.removeChild(this.css3DObject.element)}else e=this.tu,i=this.su;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale;this.iu?(this.css3DObject.scale.set(e,e,e),this.updateCenterOffset(!1)):(this.css3DObject.element.style.width=this.tu/this.viewScale+"px",this.css3DObject.element.style.height=this.su/this.viewScale+"px",this.css3DObject.scale.set(e,e,e)),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get element(){return this.htmlElement}set element(t){const e=this.htmlElement=null!=t?t:document.createElement("div");this.readyToDraw?this.hu(e):this.Ca=()=>this.hu(e)}hu(t){this.iu?(t.style.width="auto",t.style.height="auto"):(t.style.width=this.tu/this.viewScale+"px",t.style.height=this.su/this.viewScale+"px");const e=this.initializeBaseComponents(!0);Lt.updateRawObject3DWorldMatrixRecursively(e),this.transform.enqueueRenderAttachedObject3D(e)}get elementWidth(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetWidth*this.viewScale;return this.htmlElement.style.display=t,e}return 0}return this.tu}set elementWidth(t){this.iu||(this.tu=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get elementHeight(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetHeight*this.viewScale;return this.htmlElement.style.display=t,e}return 0}return this.su}set elementHeight(t){this.iu||(this.su=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get autoSize(){return this.iu}set autoSize(t){this.iu=t,this.htmlElement&&(t?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.tu/this.viewScale+"px",this.htmlElement.style.height=this.su/this.viewScale+"px"))}}class Ke{constructor(t,e=1,i=1){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);this.uc=t,this.Sa=i,this.pa=e}get htmlImageElement(){return this.uc}get columnCount(){return this.pa}get rowCount(){return this.Sa}}class ti extends Ie{constructor(){super(...arguments),this.pa=10,this.Sa=10,this.Kr=1,this.Jr=1,this.Qr=16,this.Zr=16,this.sn=null,this.nn=He.Pixelated,this.Hr=[]}renderInitialize(){this.dc();const t=this.Hr;for(let e=0;e<t.length;++e)t[e]();this.Hr.length=0}updateCenterOffset(t){if(!this.css3DObject)return;const e=this.pa*this.Kr,i=this.Sa*this.Jr;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale,i=this.htmlElement,s=this.pa*this.Kr,r=this.Sa*this.Jr;i.style.width=s/e+"px",i.style.height=r/e+"px",this.css3DObject.scale.set(e,e,e),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}dc(){const t=this.pa*this.Kr,e=this.Sa*this.Jr,i=this.pa*this.Qr,s=this.Sa*this.Zr;this.htmlElement=document.createElement("canvas"),this.htmlElement.width=i,this.htmlElement.height=s,this.htmlElement.style.imageRendering=this.nn,this.htmlElement.style.width=t/this.viewScale+"px",this.htmlElement.style.height=e/this.viewScale+"px";const r=this.initializeBaseComponents(!1);Lt.updateRawObject3DWorldMatrixRecursively(r),this.transform.enqueueRenderAttachedObject3D(r)}drawTile(t,e,i,s){if(!this.readyToDraw)return void this.Hr.push((()=>this.drawTile(t,e,i,s)));const r=this.htmlElement.getContext("2d"),n=this.sn[i];if(1===n.rowCount&&1===n.columnCount)r.drawImage(n.htmlImageElement,0,0,this.Qr,this.Zr,t*this.Qr,e*this.Zr,this.Qr,this.Zr);else{if(void 0===s)throw new Error("Atlas index is required.");{const i=Math.floor(s/n.columnCount),h=s%n.columnCount,a=n.htmlImageElement.width/n.columnCount,o=n.htmlImageElement.height/n.rowCount;r.drawImage(n.htmlImageElement,h*a,i*o,a,o,t*this.Qr,e*this.Zr,this.Qr,this.Zr)}}}drawTileFromTwoDimensionalArray(t,e,i){if(!this.readyToDraw)return void this.Hr.push((()=>this.drawTileFromTwoDimensionalArray(t,e,i)));const s=this.htmlElement.getContext("2d");for(let r=0;r<t.length;r++){const n=t[r];for(let t=0;t<n.length;t++){const h=n[t];if(null===h)continue;const a=this.sn[h.i];if(1===a.rowCount&&1===a.columnCount)s.drawImage(a.htmlImageElement,0,0,this.Qr,this.Zr,t*this.Qr+e*this.Qr,r*this.Zr+i*this.Zr,this.Qr,this.Zr);else{if(void 0===h.a)throw new Error("Atlas index is required.");{const n=h.a%a.columnCount,o=Math.floor(h.a/a.columnCount),l=a.htmlImageElement.width/a.columnCount,c=a.htmlImageElement.height/a.rowCount;s.drawImage(a.htmlImageElement,n*l,o*c,l,c,t*this.Qr+e*this.Qr,r*this.Zr+i*this.Zr,this.Qr,this.Zr)}}}}}clearTile(t,e){this.readyToDraw?this.htmlElement.getContext("2d").clearRect(t*this.Qr,e*this.Zr,this.Qr,this.Zr):this.Hr.push((()=>this.clearTile(t,e)))}set imageSources(t){if(this.readyToDraw){this.sn=t;for(let e=0;e<t.length;++e)if(!t[e].htmlImageElement.complete)throw new Error(`Image ${t[e].htmlImageElement.src} is not loaded.`)}else this.Hr.push((()=>this.imageSources=t))}get columnCount(){return this.pa}set columnCount(t){if(this.pa=t,this.htmlElement){const t=this.pa*this.Kr,e=this.pa*this.Qr;this.htmlElement.width=e,this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get rowCount(){return this.Sa}set rowCount(t){if(this.Sa=t,this.htmlElement){const t=this.Sa*this.Jr,e=this.Sa*this.Zr;this.htmlElement.height=e,this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellWidth(){return this.Kr}set gridCellWidth(t){if(this.Kr=t,this.htmlElement){const t=this.pa*this.Kr;this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellHeight(){return this.Jr}set gridCellHeight(t){if(this.Jr=t,this.htmlElement){const t=this.Sa*this.Jr;this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get tileResolutionX(){return this.Qr}set tileResolutionX(t){if(this.Qr=t,this.htmlElement){const t=this.pa*this.Qr;this.htmlElement.width=t}}get tileResolutionY(){return this.Zr}set tileResolutionY(t){if(this.Zr=t,this.htmlElement){const t=this.Sa*this.Zr;this.htmlElement.height=t}}get gridCenter(){const t=this.columnCount%2==1?0:this.Kr/2,e=this.rowCount%2==1?0:this.Jr/2;return new Zt(this.transform.position.x+t,this.transform.position.y+e)}get gridCenterX(){return this.transform.position.x+(this.columnCount%2==1?0:this.Kr/2)}get gridCenterY(){return this.transform.position.y+(this.rowCount%2==1?0:this.Jr/2)}get imageRenderingMode(){return this.nn}set imageRenderingMode(t){this.nn=t,this.htmlElement&&(this.htmlElement.style.imageRendering=this.nn)}}!function(t){t[t.ObjectFit=0]="ObjectFit",t[t.ClipPath=1]="ClipPath"}(Ue||(Ue={}));class ei extends Ie{constructor(){super(...arguments),this.Aa=Ue.ObjectFit,this.Ia=0,this.ja=0,this.Ga=!1,this.Ha=!1,this.Wa=1,this.nn=He.Pixelated,this.pa=1,this.Sa=1,this.Xa=0,this.Ya=0,this.Ea=0,this.Ca=null}renderInitialize(){this.Ca?this.Ca():this.asyncSetImageFromPath(Ze.defaultSpriteSrc,1,1)}updateCenterOffset(t){if(this.css3DObject)if(this.Aa===Ue.ObjectFit)this.css3DObject.position.set(this.Ia*this.centerOffset.x,this.ja*this.centerOffset.y,0),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject));else{const e=this.Xa%this.pa,i=Math.floor(this.Xa/this.pa),s=this.Ga?-(this.Ia*this.pa/2-this.Ia/2)+e*this.Ia:this.Ia*this.pa/2-this.Ia/2-e*this.Ia,r=this.Ha?this.ja*this.Sa/2-this.ja/2-i*this.ja:-(this.ja*this.Sa/2-this.ja/2)+i*this.ja;this.css3DObject.position.set(this.Ia*this.centerOffset.x+s,this.ja*this.centerOffset.y+r,0),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}}updateViewScale(t){if(this.css3DObject)if(this.Aa===Ue.ObjectFit){const e=this.viewScale,i=this.Ga?-1:1,s=this.Ha?-1:1;this.css3DObject.scale.set(this.Ia/this.Ya*e*i,this.ja/this.Ea*e*s,1),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}else{const e=this.viewScale,i=this.htmlElement;i.style.width=this.Ia*this.pa/e+"px",i.style.height=this.ja*this.Sa/e+"px";const s=this.Ga?-1:1,r=this.Ha?-1:1;this.css3DObject.scale.set(e*s,e*r,e),t&&(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}}$a(){if(this.htmlElement)if(this.Aa===Ue.ObjectFit){const t=-this.Xa%this.pa*this.Ya,e=-Math.floor(this.Xa/this.pa)*this.Ea;this.htmlElement.style.objectPosition=t+"px "+e+"px"}else{const t=Math.floor(this.Xa/this.pa),e=this.pa-this.Xa%this.pa-1;this.htmlElement.style.clipPath="inset("+100/this.Sa*t+"% "+100/this.pa*e+"% "+(100-(100/this.Sa*t+100/this.Sa))+"% "+(100-(100/this.pa*e+100/this.pa))+"%)"}}get image(){return this.htmlElement}asyncSetImageFromPath(t,e,i,s){var r;if(!this.readyToDraw)return void(this.Ca=()=>this.asyncSetImageFromPath(t,e,i,s));const n=null!==(r=this.htmlElement)&&void 0!==r?r:new Image;n.src=t;const h=t=>{this.exists&&(n.removeEventListener("load",h),this.setImage(n,e,i),null==s||s())};n.addEventListener("load",h)}setImage(t,e,i){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);this.pa=e,this.Sa=i,this.htmlElement=t,t.alt=this.gameObject.name+"_sprite_atlas",t.style.imageRendering=this.nn,t.style.opacity=this.Wa.toString(),this.Aa===Ue.ObjectFit?(1!==this.viewScale&&console.warn("CssSpriteAtlas.viewScale is not supported in CssSpriteAtlasRenderMode.ObjectFit, for supressing this warning set viewScale to 1."),this.Ya=t.naturalWidth/this.pa,this.Ea=t.naturalHeight/this.Sa,0===this.Ia&&(this.Ia=.1*this.Ya),0===this.ja&&(this.ja=.1*this.Ea),t.style.width=this.Ya+"px",t.style.height=this.Ea+"px",t.style.objectFit="none"):(0===this.Ia&&(this.Ia=t.naturalWidth/this.pa*.1),0===this.ja&&(this.ja=t.naturalHeight/this.Sa*.1),t.style.width=this.Ia*this.pa/this.viewScale+"px",t.style.height=this.ja*this.Sa/this.viewScale+"px");const s=this.initializeBaseComponents(!1);this.$a(),Lt.updateRawObject3DWorldMatrixRecursively(s),this.transform.enqueueRenderAttachedObject3D(s)}get renderMode(){return this.Aa}set renderMode(t){if(this.Aa!==t&&(this.Aa=t,this.htmlElement)){const t=this.htmlElement;this.Aa===Ue.ObjectFit?(1!==this.viewScale&&console.warn("CssSpriteAtlas.viewScale is not supported in CssSpriteAtlasRenderMode.ObjectFit"),t.style.clipPath="",this.Ya=t.naturalWidth/this.pa,this.Ea=t.naturalHeight/this.Sa,0===this.Ia&&(this.Ia=this.Ya),0===this.ja&&(this.ja=this.Ea),t.style.width=this.Ya+"px",t.style.height=this.Ea+"px",t.style.objectFit="none"):(t.style.objectFit="",t.style.objectPosition="",0===this.Ia&&(this.Ia=t.naturalWidth/this.pa),0===this.ja&&(this.ja=t.naturalHeight/this.Sa),t.style.width=this.Ia*this.pa/this.viewScale+"px",t.style.height=this.ja*this.Sa/this.viewScale+"px"),this.updateViewScale(!1),this.updateCenterOffset(!1),this.$a(),Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)}}get imageIndex(){return this.Xa}set imageIndex(t){this.Xa=t,this.$a(),this.Aa===Ue.ClipPath&&this.updateCenterOffset(!0)}get columnCount(){return this.pa}get rowCount(){return this.Sa}get imageWidth(){return this.Ia}set imageWidth(t){this.Ia=t,this.Aa===Ue.ObjectFit?this.css3DObject&&(this.css3DObject.scale.x=this.Ia/this.Ya*this.viewScale,this.css3DObject.scale.x*=this.Ga?-1:1):this.htmlElement&&(this.htmlElement.style.width=t*this.pa/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageHeight(){return this.ja}set imageHeight(t){this.ja=t,this.Aa===Ue.ObjectFit?this.css3DObject&&(this.css3DObject.scale.y=this.ja/this.Ea*this.viewScale,this.css3DObject.scale.y*=this.Ha?-1:1):this.htmlElement&&(this.htmlElement.style.height=t*this.Sa/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageFlipX(){return this.Ga}set imageFlipX(t){this.Ga=t,this.css3DObject&&(this.Ga?0<this.css3DObject.scale.x&&(this.css3DObject.scale.x*=-1):this.css3DObject.scale.x<0&&(this.css3DObject.scale.x*=-1),this.Aa===Ue.ObjectFit?(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)):(this.$a(),this.updateCenterOffset(!0)))}get imageFlipY(){return this.Ha}set imageFlipY(t){this.Ha=t,this.css3DObject&&(this.Ha?0<this.css3DObject.scale.y&&(this.css3DObject.scale.y*=-1):this.css3DObject.scale.y<0&&(this.css3DObject.scale.y*=-1),this.Aa===Ue.ObjectFit?(Lt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)):(this.$a(),this.updateCenterOffset(!0)))}get opacity(){return this.Wa}set opacity(t){this.Wa=t,this.htmlElement&&(this.htmlElement.style.opacity=this.Wa.toString())}get imageRenderingMode(){return this.nn}set imageRenderingMode(t){this.nn=t,this.htmlElement&&(this.htmlElement.style.imageRendering=this.nn)}}class ii extends we{constructor(){super(...arguments),this._sprite=null,this._blurSprite=null,this._viewScale=1,this._glowScale=1,this._imageIndex=0}awake(){this._sprite||(this._sprite=this.gameObject.addComponent(ei),this._blurSprite=this.gameObject.addComponent(ei)),this._sprite.viewScale=this._viewScale,this._blurSprite.viewScale=this._viewScale,this._blurSprite.filter.blur=this._glowScale}onEnable(){this._sprite.exists&&(this._sprite.enabled=!0,this._blurSprite.enabled=!0)}onDisable(){this._sprite.exists&&(this._sprite.enabled=!1,this._blurSprite.enabled=!1)}onDestroy(){this._sprite&&(this._sprite.destroy(),this._blurSprite.destroy())}asyncSetImage(t,e,i,s){this._sprite||(this._sprite=this.gameObject.addComponent(ei),this._blurSprite=this.gameObject.addComponent(ei)),this._sprite.asyncSetImageFromPath(t,i,e,s),this._blurSprite.asyncSetImageFromPath(t,i,e,s)}set imageIndex(t){this._imageIndex=t,this._sprite&&(this._sprite.imageIndex=t,this._blurSprite.imageIndex=t)}get imageIndex(){return this._imageIndex}get viewScale(){return this._viewScale}set viewScale(t){this._viewScale=t,this._sprite&&(this._sprite.viewScale=t,this._blurSprite.viewScale=t)}}class si extends we{constructor(){super(...arguments),this._prefab=null,this._spawnCount=3,this._padding=1,this._spawnedObjects=[],this._gradient=0}awake(){this.updateSpawnedObjects(!0)}updateSpawnedObjects(t,e=!1){if(e){for(let t=0;t<this._spawnedObjects.length;t++)this._spawnedObjects[t].destroy();this._spawnedObjects.length=0}const i=this._spawnedObjects;if(i.length<this._spawnCount)for(let t=i.length;t<this._spawnCount;t++){const e=this.engine.scene.addChildFromBuilder(this.engine.instantiater.buildPrefab("horizontal_animated_object_"+t,this._prefab,new st(t*this._padding,0,0),void 0).make());e.transform.setParent(this.gameObject.transform,!1),this._spawnedObjects.push(e)}else if(i.length>this._spawnCount)for(let t=i.length-1;t>=this._spawnCount;t--)i[t].destroy();if(t)for(let t=0;t<i.length;t++)i[t].transform.localPosition.x=(t*this._padding+this._gradient)%(this._padding*this._spawnCount)}get prefab(){return this._prefab}set prefab(t){this._prefab=t,0<this._spawnedObjects.length&&this.updateSpawnedObjects(!1,!0)}get spawnCount(){return this._spawnCount}set spawnCount(t){this._spawnCount=t,0<this._spawnedObjects.length&&this.updateSpawnedObjects(!1)}get padding(){return this._padding}set padding(t){this._padding=t,0<this._spawnedObjects.length&&this.updateSpawnedObjects(!0)}get gradient(){return this._gradient}set gradient(t){const e=this._padding*this._spawnCount;t=e-t%e,this._gradient=t,0<this._spawnedObjects.length&&this.updateSpawnedObjects(!0)}}const ri=i.p+"asset/image/firework1.png?641a34df16b66cfd42aef7e88d0abcf2",ni=i.p+"asset/image/firework2.png?0457d99292fe710b641008d08a767cf1",hi=i.p+"asset/image/firework3.png?c523e40ad8d106a58eba02b3fa9ebd08",ai=i.p+"asset/image/firework_sphere.png?36037e7ffb65c4d5b32ab39a5590bf88",oi=i.p+"asset/image/moon.png?dc53620a71fad861f5bec08a268aeea0",li=i.p+"asset/image/moon_emission.png?e4ba8b4daaa977f0898b56a78fa2aa34",ci=i.p+"asset/image/intro_background.jpg?1bffc28b3c48bb17e07057ff22a561cd",ui=i.p+"asset/image/grass.png?959200c7186ca65aca63c63da081ccd8",di=i.p+"asset/image/spaceship_blue.png?9efb9adcb780b41cf50f5adbbb647a0d",mi=i.p+"asset/image/red_helmet.png?1b505f6453c4ee3a1f7cfc55d99ed0ea";class pi extends we{constructor(){super(...arguments),this.animationInstance=null}}class fi{constructor(t,e){this._bindInfo=e,this._animationClip=t,this._animationTrackInstances=[];const i=e.data;for(let e=0;e<i.length;++e){const s=t.getTrackFromName(i[e].trackName);if(null===s)throw new Error(`AnimationClipInstance: track not found: ${i[e].trackName}`);this._animationTrackInstances.push(s.createInstance(i[e].target))}}get animationContainer(){return this._animationClip}get bindInfo(){return this._bindInfo}set bindInfo(t){this._animationTrackInstances.length=0;const e=t.data;for(let t=0;t<e.length;++t){const i=this._animationClip.getTrackFromName(e[t].trackName);if(null===i)throw new Error(`AnimationClipInstance: track not found: ${e[t].trackName}`);this._animationTrackInstances.push(i.createInstance(e[t].target))}}frameIndexHint(t){for(let e=0;e<this._animationTrackInstances.length;++e)this._animationTrackInstances[e].frameIndexHint(t)}process(t,e=t){t<this._animationClip.startFrame&&(t=this._animationClip.startFrame),this._animationClip.endFrame<t&&(t=this._animationClip.endFrame);for(let i=0;i<this._animationTrackInstances.length;++i)this._animationTrackInstances[i].process(t,e)}}class gi{constructor(t,e,i){this.tracks=[];for(let e=0;e<t.length;e++)this.tracks.push(t[e].track);this._trackMap=new Map;for(let e=0;e<this.tracks.length;e++)this._trackMap.set(t[e].name,e);const s=this.tracks;if(e)this.startFrame=e;else{let t=Number.MAX_SAFE_INTEGER;for(let e=0;e<s.length;e++)s[e].startFrame<t&&(t=s[e].startFrame);this.startFrame=t}if(i)this.endFrame=i;else{let t=Number.MIN_SAFE_INTEGER;for(let e=0;e<s.length;e++)s[e].endFrame>t&&(t=s[e].endFrame);this.endFrame=t}}getTrackFromName(t){const e=this._trackMap.get(t);return void 0===e?null:this.tracks[e]}createInstance(t){return new fi(this,t)}}const yi=new class{lerp(t,e,i){return t+(e-t)*i}hermite(t,e,i,s,r){const n=r*r,h=n*r;return t*(2*h-3*n+1)+e*(-2*h+3*n)+i*(h-2*n+r)+s*(h-n)}linearTangent(t,e){return e-t}},_i=new class{constructor(){this.tangentTempInstance=new Zt,this.tempInstance=new Zt}lerp(t,e,i,s){return s||(s=new Zt),s.x=t.x+(e.x-t.x)*i,s.y=t.y+(e.y-t.y)*i,s}hermite(t,e,i,s,r,n){n||(n=new Zt);const h=r*r,a=h*r,o=2*a-3*h+1,l=-2*a+3*h,c=a-2*h+r,u=a-h;return n.x=t.x*o+e.x*l+i.x*c+s.x*u,n.y=t.y*o+e.y*l+i.y*c+s.y*u,n}linearTangent(t,e,i){return i||(i=new Zt),i.x=e.x-t.x,i.y=e.y-t.y,i}},bi=new class{constructor(){this.tangentTempInstance=new st,this.tempInstance=new st}lerp(t,e,i,s){return s||(s=new st),s.x=t.x+(e.x-t.x)*i,s.y=t.y+(e.y-t.y)*i,s.z=t.z+(e.z-t.z)*i,s}hermite(t,e,i,s,r,n){n||(n=new st);const h=r*r,a=h*r,o=2*a-3*h+1,l=-2*a+3*h,c=a-2*h+r,u=a-h;return n.x=t.x*o+e.x*l+i.x*c+s.x*u,n.y=t.y*o+e.y*l+i.y*c+s.y*u,n.z=t.z*o+e.z*l+i.z*c+s.z*u,n}linearTangent(t,e,i){return i||(i=new st),i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i}},vi=new class{constructor(){this.tangentTempInstance=new it,this.tempInstance=new it}lerp(t,e,i,s){let r,n,h=t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w,a=!1;if(h<0&&(a=!0,h=-h),h>.999999)r=1-i,n=a?-i:i;else{const t=Math.acos(h),e=1/Math.sin(t);r=Math.sin((1-i)*t)*e,n=a?-Math.sin(i*t)*e:Math.sin(i*t)*e}return s||(s=new it),s.x=r*t.x+n*e.x,s.y=r*t.y+n*e.y,s.z=r*t.z+n*e.z,s.w=r*t.w+n*e.w,s}hermite(t,e,i,s,r,n){n||(n=new it);const h=r*r,a=h*r,o=2*a-3*h+1,l=-2*a+3*h,c=a-2*h+r,u=a-h;return n.w=t.w*o+e.w*l+i.w*c+s.w*u,n.x=t.x*o+e.x*l+i.x*c+s.x*u,n.y=t.y*o+e.y*l+i.y*c+s.y*u,n.z=t.z*o+e.z*l+i.z*c+s.z*u,n.normalize(),n}linearTangent(t,e,i){return i||(i=new it),i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i.w=e.w-t.w,i}};var wi;!function(t){t[t.Cubic=0]="Cubic",t[t.Linear=1]="Linear",t[t.Step=2]="Step"}(wi||(wi={}));class xi{constructor(t,e,i,s,r){this.value=e,this.frame=t,this.interpolation=i,this.inTangent=s,this.outTangent=r}static createRefType(t,e,i,s,r){return new xi(t,e.clone(),i,null==s?void 0:s.clone(),null==r?void 0:r.clone())}static createValueType(t,e,i,s,r){return new xi(t,e,i,s,r)}}class Ci{constructor(t,e){this._animationTrack=t,this._targetSetFunction=e,this._currentFrameIndex=0}get animationContainer(){return this._animationTrack}get targetSetFunction(){return this._targetSetFunction}set targetSetFunction(t){this._targetSetFunction=t}frameIndexHint(t){this._currentFrameIndex=t<0?0:t}process(t){const e=this._animationTrack.keys;if(0===e.length)return;if(1===e.length)return void this._targetSetFunction(e[0].value);let i=this._currentFrameIndex;if(t<0&&(t=0),2048<e.length&&540<Math.abs(t-e[i].frame)){let s=0,r=e.length-1;for(;s<r;){const i=s+r>>1;t<e[i+1].frame?r=i:s=i+1}i=s}else{for(;0<i&&t<e[i].frame;)i-=1;for(;i<e.length-1&&t>=e[i+1].frame;)i+=1}if(t<e[i].frame)return void this._targetSetFunction(e[i].value);this._currentFrameIndex=i;const s=e[i],r=e[i+1];if(void 0===r)return void this._targetSetFunction(s.value);if(s.interpolation===wi.Step)return void this._targetSetFunction(s.value);const n=this._animationTrack.interpolator,h=(t-s.frame)/(r.frame-s.frame);if(s.interpolation===wi.Linear&&(r.interpolation===wi.Linear||r.interpolation===wi.Step)){const t=n.lerp(s.value,r.value,h,n.tempInstance);return void this._targetSetFunction(t)}let a,o;if(s.interpolation!==wi.Cubic){const t=n.linearTangent(s.value,r.value,n.tangentTempInstance);a=t,o=r.interpolation!==wi.Cubic?t:r.inTangent}else a=s.outTangent,o=r.interpolation!==wi.Cubic?n.linearTangent(s.value,r.value,n.tangentTempInstance):r.inTangent;const l=n.hermite(s.value,r.value,a,o,h,n.tempInstance);this._targetSetFunction(l)}}class Si{constructor(t,e){Si.validateKeys(t),this._keys=t.slice(),this._interpolator=e}static validateKeys(t){let e=0;for(let i=0;i<t.length;i++){if(t[i].frame<e)throw new Error("AnimationTrack: keys must be sorted by frame");if(t[i].frame<0)throw new Error("AnimationTrack: keys must be positive");e=t[i].frame}}get keys(){return this._keys}get interpolator(){return this._interpolator}get startFrame(){return this._keys[0].frame}get endFrame(){return this._keys[this._keys.length-1].frame}createInstance(t){return new Ci(this,t)}static createScalarTrack(t){return new Si(t,yi)}static createVector2Track(t){return new Si(t,_i)}static createVector3Track(t){return new Si(t,bi)}static createQuaternionTrack(t){return new Si(t,vi)}}class Ei{constructor(t){this.data=[];for(let e=0;e<t.length;e++)this.data.push(Object.assign({},t[e]))}}const Mi=new class{constructor(){this._pool=new Map}get(t){if(this._pool.has(t))return this._pool.get(t);{const e=t.toString();return this._pool.set(t,e),e}}};class Ti{constructor(t){this._a=t}next(){let t=this._a+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}}class ki extends we{constructor(){super(...arguments),this._prefab=null,this._objectPool=[],this._activeParticles=0,this._linearVelocity=new Zt,this._particleCount=10,this._lifeTime=5,this._accumulatedTime=0,this._seed=0,this._velocityNoiseScale=.5,this._lifetimeNoiseScale=1,this._randomGenerator=new Ti(0),this._patticleNextId=0}update(){if(this._accumulatedTime+=this.engine.time.deltaTime,this._prefab){const t=this._particleCount;for(let e=this._activeParticles;e<=t;e++){const t=this.createParticle(this._prefab),e=this._velocityNoiseScale,i=t.linearVelocity.copy(this._linearVelocity);i.x+=(this._randomGenerator.next()-.5)*e,i.y+=(this._randomGenerator.next()-.5)*e;const s=this._lifetimeNoiseScale;t.lifeTime=this._lifeTime+(this._randomGenerator.next()-.5)*s,this._activeParticles+=1}}}createParticle(t){if(0<this._objectPool.length){const t=this._objectPool.pop();return t.gameObject.activeSelf=!0,t.gameObject.transform.position.copy(this.gameObject.transform.position),t.activeTime=this._accumulatedTime,t}const e=this.engine.scene.addChildFromBuilder(this.engine.instantiater.buildPrefab("particle_"+this._patticleNextId,t,this.gameObject.transform.position).make());this._patticleNextId+=1;const i=e.addComponent(ki.Particle);return i.emitter=this,i.prefab=t,i.activeTime=this._accumulatedTime,i}get prefab(){return this._prefab}set prefab(t){this._prefab=t}get linearVelocity(){return this._linearVelocity}set linearVelocity(t){this._linearVelocity.copy(t)}get particleCount(){return this._particleCount}set particleCount(t){this._particleCount=t}get lifeTime(){return this._lifeTime}set lifeTime(t){this._lifeTime=t}get seed(){return this._seed}set seed(t){this._seed=t,this._randomGenerator=new Ti(t)}get velocityNoiseScale(){return this._velocityNoiseScale}set velocityNoiseScale(t){this._velocityNoiseScale=t}get lifetimeNoiseScale(){return this._lifetimeNoiseScale}set lifetimeNoiseScale(t){this._lifetimeNoiseScale=t}}ki.Particle=class extends we{constructor(){super(...arguments),this.linearVelocity=new Zt,this.activeTime=0,this.lifeTime=0,this.prefab=null,this.emitter=null}update(){const t=this.linearVelocity,e=this.gameObject.transform.position;e.x+=t.x*this.engine.time.deltaTime,e.y+=t.y*this.engine.time.deltaTime;const i=this.emitter;this.activeTime+this.lifeTime<i._accumulatedTime&&(this.prefab===i._prefab?(this.gameObject.activeSelf=!1,i._objectPool.push(this)):this.gameObject.destroy(),i._activeParticles-=1)}};class Oi extends Qe{constructor(){super(...arguments),this._moonGroup=new pe,this._fireWork1=new pe,this._fireWork2=new pe,this._fireWork3=new pe,this._fireWorkSphere=new pe,this._blackScreen=new pe,this._moon=new pe,this._grass1=new pe,this._grassRender1=new pe,this._grass2=new pe,this._grassRender2=new pe,this._grass3=new pe,this._grassRender3=new pe,this._spaceship=new pe,this._warpEffect=new pe,this._warpEffectAnim=new pe,this._blackScreen2=new pe}getObjects(t){return t.ref={moonGroup:this._moonGroup,fireWork1:this._fireWork1,fireWork2:this._fireWork2,fireWork3:this._fireWork3,fireworkSphere:this._fireWorkSphere,blackScreen:this._blackScreen,moon:this._moon,grass1:this._grass1,grassRender1:this._grassRender1,grass2:this._grass2,grassRender2:this._grassRender2,grass3:this._grass3,grassRender3:this._grassRender3,spaceship:this._spaceship,warpEffect:this._warpEffect,warpEffectAnim:this._warpEffectAnim,blackScreen2:this._blackScreen2},this}make(){const t=new pe,e=new pe,i=new pe,s=new pe,r=new pe;return this.gameObjectBuilder.withChild(this.instantiater.buildGameObject("moon_group",new st(0,0,-7)).getGameObject(this._moonGroup).withChild(this.instantiater.buildGameObject("firework1",new st(-3,3,0)).withComponent(ii,(t=>{t.viewScale=1,t.asyncSetImage(ri,1,8)})).getComponent(ii,this._fireWork1)).withChild(this.instantiater.buildGameObject("firework2",new st(-2,-3.5,0)).withComponent(ii,(t=>{t.viewScale=1,t.asyncSetImage(ni,1,18)})).getComponent(ii,this._fireWork2)).withChild(this.instantiater.buildGameObject("firework3",new st(4.5,3.5,0)).withComponent(ii,(t=>{t.viewScale=1,t.asyncSetImage(hi,1,14)})).getComponent(ii,this._fireWork3)).withChild(this.instantiater.buildGameObject("fireworkSphere",new st(0,0,0),void 0,(new st).setScalar(2)).withComponent(ii,(t=>{t.viewScale=1,t.asyncSetImage(ai,1,13)})).getComponent(ii,this._fireWorkSphere)).withChild(this.instantiater.buildGameObject("moon",new st(0,0,-2),void 0,(new st).setScalar(2)).withComponent($e,(t=>{t.asyncSetImageFromPath(oi),t.filter.dropShadow=new De(.3,.7,1)})).getComponent($e,this._moon).withComponent($e,(t=>{t.asyncSetImageFromPath(li),t.filter.blur=1,t.filter.dropShadow=new De(-.3,-.3,1,new xe(1,1,1))})))).withChild(this.instantiater.buildGameObject("black_screen",new st(0,0,-8)).withComponent(Je,(t=>{const e=document.createElement("div");e.style.backgroundColor="#000000",t.element=e,t.elementWidth=1e3,t.elementHeight=1e3})).getComponent(Je,this._blackScreen)).withChild(this.instantiater.buildGameObject("background",new st(0,0,-10),void 0,(new st).setScalar(1.55)).withComponent(ti,(t=>{t.tileResolutionX=4,t.tileResolutionY=36,t.gridCellWidth=1,t.gridCellHeight=9,t.columnCount=40,t.rowCount=1;const e=new Image;e.src=ci,e.onload=()=>{t.imageSources=[new Ke(e)],t.drawTileFromTwoDimensionalArray([Array(t.columnCount).fill({i:0,a:0})],0,0)}}))).withChild(this.instantiater.buildGameObject("grass1",new st(-30,-17,-4),void 0,(new st).setScalar(6.1)).withComponent(si,(t=>{t.prefab=class extends Qe{make(){return this.gameObjectBuilder.withComponent($e,(t=>{t.asyncSetImageFromPath(ui),t.centerOffset=new Zt(0,.5),t.filter.blur=.1}))}},t.spawnCount=7,t.padding=1.57})).getComponent(si,this._grassRender1).getGameObject(this._grass1)).withChild(this.instantiater.buildGameObject("grass2",new st(-30,-14,-5),void 0,(new st).setScalar(4)).withComponent(si,(t=>{t.prefab=class extends Qe{make(){return this.gameObjectBuilder.withComponent($e,(t=>{t.asyncSetImageFromPath(ui),t.centerOffset=new Zt(0,.5),t.filter.blur=.1,t.filter.brightness=.7}))}},t.spawnCount=11,t.padding=1.57})).getComponent(si,this._grassRender2).getGameObject(this._grass2)).withChild(this.instantiater.buildGameObject("grass3",new st(-30,-12,-6),void 0,(new st).setScalar(2)).withComponent(si,(t=>{t.prefab=class extends Qe{make(){return this.gameObjectBuilder.withComponent($e,(t=>{t.asyncSetImageFromPath(ui),t.centerOffset=new Zt(0,.5),t.filter.blur=.05,t.filter.brightness=.6}))}},t.spawnCount=14,t.padding=1.57})).getComponent(si,this._grassRender3).getGameObject(this._grass3)).withChild(this.instantiater.buildGameObject("space_ship",new st(-.1,-9,-7),void 0,(new st).setScalar(.5)).withComponent($e,(t=>{t.asyncSetImageFromPath(di),t.filter.brightness=0})).withChild(this.instantiater.buildGameObject("red_helmet",new st(-.45,0,-1)).withComponent($e,(t=>{t.asyncSetImageFromPath(mi),t.filter.brightness=0}))).getGameObject(this._spaceship)).withChild(this.instantiater.buildGameObject("warp_effect",new st(0,0,12),(new it).setFromAxisAngle(new st(0,0,1),-Math.PI/4/1.2),(new st).setScalar(1.45)).withComponent(Je,(t=>{const e=document.createElement("div");e.style.backgroundColor="#FFFFFF",t.element=e,t.elementWidth=100,t.elementHeight=.8,t.filter.blur=.3})).getComponent(Je,t).withComponent(pi,(n=>{const h=t.ref,a=e.ref.transform.localScale,o=i.ref.transform.localScale,l=s.ref,c=r.ref;n.animationInstance=new gi([{name:"center",track:Si.createScalarTrack([xi.createValueType(0,.8,wi.Linear),xi.createValueType(12,0,wi.Linear)])},{name:"side",track:Si.createScalarTrack([xi.createValueType(0,1,wi.Linear),xi.createValueType(12,0,wi.Linear)])},{name:"glow_opacity",track:Si.createScalarTrack([xi.createValueType(0,.9,wi.Linear),xi.createValueType(12,0,wi.Linear)])}]).createInstance(new Ei([{trackName:"center",target:t=>{h.elementHeight=t}},{trackName:"side",target:t=>{a.y=t,o.y=t}},{trackName:"glow_opacity",target:t=>{l.element.style.opacity=Mi.get(t),c.element.style.opacity=Mi.get(t)}}]))})).getComponent(pi,this._warpEffectAnim).getGameObject(this._warpEffect).withChild(this.instantiater.buildGameObject("warp_effect_side_yellow",new st(0,.6,0)).getGameObject(e).withComponent(Je,(t=>{const e=document.createElement("div");e.style.backgroundColor="#FFFFFF",t.element=e,t.elementWidth=100,t.elementHeight=.2,t.filter.blur=.3})).withChild(this.instantiater.buildGameObject("glow_effect",new st(0,0,-1),void 0,(new st).setScalar(2.5)).withComponent(Je,(t=>{const e=document.createElement("div");e.style.backgroundColor="#FFFF00",e.style.opacity="0.9",t.element=e,t.elementWidth=100,t.elementHeight=.2,t.filter.blur=.5})).getComponent(Je,s))).withChild(this.instantiater.buildGameObject("warp_effect_side_blue",new st(0,-.6,0)).getGameObject(i).withComponent(Je,(t=>{const e=document.createElement("div");e.style.backgroundColor="#FFFFFF",t.element=e,t.elementWidth=100,t.elementHeight=.2,t.filter.blur=.3})).withChild(this.instantiater.buildGameObject("glow_effect",new st(0,0,-1),void 0,(new st).setScalar(2.5)).withComponent(Je,(t=>{const e=document.createElement("div");e.style.backgroundColor="#0000FF",e.style.opacity="0.9",t.element=e,t.elementWidth=100,t.elementHeight=.2,t.filter.blur=.5})).getComponent(Je,r)))).withChild(this.instantiater.buildGameObject("black_screen_2",new st(0,0,-3)).withComponent(Je,(t=>{const e=document.createElement("div");e.style.backgroundColor="#000000",t.element=e,t.elementWidth=1e3,t.elementHeight=1e3})).getComponent(Je,this._blackScreen2)).withChild(this.instantiater.buildGameObject("particle_emitter_test",new st(0,0,100)).withComponent(ki,(t=>{t.prefab=class extends Qe{make(){return this.gameObjectBuilder.withComponent($e)}}})))}}class Di{constructor(t,e){this.frame=t,this.animationInstance=e}}class ji{constructor(t,e){this._bindInfo=e.slice(),this._animationSequence=t;const i=[],s=this._bindInfo;for(let t=0;t<s.length;++t){const e=this._animationSequence.animationContainers[t],r=e.animation.createInstance(s[t]);i.push({offset:e.offset,start:e.startFrame,end:e.endFrame,animation:r})}i.sort(((t,e)=>t.offset+t.start-(e.offset+e.start))),this._animationActivationInfo=[];for(let t=0;t<i.length;++t){const e=i[t];this._animationActivationInfo.push(new Di(e.offset+e.start,e))}i.sort(((t,e)=>t.offset+t.end-(e.offset+e.end))),this._animationDeActivationInfo=[];for(let t=0;t<i.length;++t){const e=i[t];this._animationDeActivationInfo.push(new Di(e.offset+e.end,e))}this._currentActivationFrameIndex=-1,this._currentDeActivationFrameIndex=-1,this._runningAnimations=new Set}get animationContainer(){return this._animationSequence}get bindInfo(){return this._bindInfo}set bindInfo(t){this._bindInfo=t.slice();const e=[],i=this._bindInfo;for(let t=0;t<i.length;++t){const s=this._animationSequence.animationContainers[t],r=s.animation.createInstance(i[t]);e.push({offset:s.offset,start:s.startFrame,end:s.endFrame,animation:r})}e.sort(((t,e)=>t.offset+t.start-(e.offset+e.start))),this._animationActivationInfo=[];for(let t=0;t<e.length;++t){const i=e[t];this._animationActivationInfo.push(new Di(i.offset+i.start,i))}e.sort(((t,e)=>t.offset+t.end-(e.offset+e.end))),this._animationDeActivationInfo=[];for(let t=0;t<e.length;++t){const i=e[t];this._animationDeActivationInfo.push(new Di(i.offset+i.end,i))}this._currentActivationFrameIndex=-1,this._currentDeActivationFrameIndex=-1,this._runningAnimations.clear()}frameIndexHint(t){for(const e of this._runningAnimations)e.animation.frameIndexHint(t)}process(t,e=t){t<this._animationSequence.startFrame&&(t=this._animationSequence.startFrame),this._animationSequence.endFrame<t&&(t=this._animationSequence.endFrame);const i=this._runningAnimations,s=this._animationActivationInfo;let r=this._currentActivationFrameIndex;const n=this._animationDeActivationInfo;let h=this._currentDeActivationFrameIndex;for(;0<=h&&t<n[h].frame;)i.add(n[h].animationInstance),h-=1;for(;0<=r&&t<s[r].frame;){const n=s[r].animationInstance;i.delete(n),r-=1;const h=t-n.offset,a=e-n.offset;n.animation.process(h,a)}for(;r<s.length-1&&s[r+1].frame<=t;)i.add(s[r+1].animationInstance),r+=1;for(;h<n.length-1&&n[h+1].frame<=t;){const t=n[h+1].animationInstance;i.delete(t),h+=1,t.animation.process(t.end)}this._currentActivationFrameIndex=r,this._currentDeActivationFrameIndex=h;for(const s of i){let i=t-s.offset;const r=e-s.offset;i<s.start&&(i=s.start),s.end<i&&(i=s.end),s.animation.process(i,r)}}}class Ii{constructor(t,e=0,i,s){this.animation=t,this.offset=e,this.startFrame=i||t.startFrame,this.endFrame=s||t.endFrame}}class Ai{constructor(t,e){this._bindInfo=Object.assign({},e),this._animationTrack=t,this._currentFrameIndex=0,this._lastInvokedFrameIndex=-1,this._noRestoreEvent=!0;for(const t in e)if(e[t].eventRestore){this._noRestoreEvent=!1;break}}get animationContainer(){return this._animationTrack}get bindInfo(){return this._bindInfo}set bindInfo(t){this._bindInfo=Object.assign({},t),this._noRestoreEvent=!0;for(const e in t)if(t[e].eventRestore){this._noRestoreEvent=!1;break}}frameIndexHint(t){this._currentFrameIndex=t<0?0:t}process(t,e=t){var i,s,r,n;const h=this._animationTrack.keys;if(0===h.length)return;if(1===h.length)return void(this._lastInvokedFrameIndex<t?(this._bindInfo[h[0].eventName].event(),this._lastInvokedFrameIndex=t):this._lastInvokedFrameIndex>t&&(null===(s=(i=this._bindInfo[h[0].eventName]).eventRestore)||void 0===s||s.call(i),this._lastInvokedFrameIndex=-1));let a=this._currentFrameIndex,o=!1;if(e<0&&(o=!0),2048<h.length&&540<Math.abs(t-h[a].frame)){let e=0,i=h.length-1;for(;e<i;){const s=e+i>>1;t<h[s+1].frame?i=s:e=s+1}a=e}else{for(;0<a&&t<h[a].frame;)a-=1;for(;a<h.length-1&&t>=h[a+1].frame;)a+=1}this._currentFrameIndex=a;const l=o?-1:a;for(let t=this._lastInvokedFrameIndex+1;t<=l;t++){const e=h[t];this._bindInfo[e.eventName].event()}if(!this._noRestoreEvent)for(let t=this._lastInvokedFrameIndex;t>l;t--){const e=h[t];null===(n=(r=this._bindInfo[e.eventName]).eventRestore)||void 0===n||n.call(r)}this._lastInvokedFrameIndex=l}}class zi{constructor(t){zi.validateKeys(t),this._keys=t.slice()}static validateKeys(t){let e=0;for(let i=0;i<t.length;i++){if(t[i].frame<e)throw new Error("AnimationTrack: keys must be sorted by frame");if(t[i].frame<0)throw new Error("AnimationTrack: keys must be positive");e=t[i].frame}}get keys(){return this._keys}get startFrame(){return this._keys[0].frame}get endFrame(){return this._keys[this._keys.length-1].frame}createInstance(t){return new Ai(this,t)}}class Ri{constructor(t,e){this.event=t,this.eventRestore=e}}class Pi{constructor(t,e){this.eventName=t,this.frame=e}}var Wi;class Fi{static createActivationBindInfo(t,e){return{visible:new Ri(t,e),invisible:new Ri(e,t),invisible_norestore:new Ri(e)}}static createBindInfo(t,e,i,s,r,n,h,a,o,l,c,u,d,m,p,f,g,y,_,b,v,w,x,C,S,E,M,T,k,O,D){const j=new Ei([{trackName:"firework1",target:t},{trackName:"firework1_activation",target:Fi.createActivationBindInfo(e,i)},{trackName:"firework2",target:s},{trackName:"firework2_activation",target:Fi.createActivationBindInfo(r,n)},{trackName:"firework3",target:h},{trackName:"firework3_activation",target:Fi.createActivationBindInfo(a,o)},{trackName:"firework_sphere",target:l},{trackName:"firework_sphere_activation",target:Fi.createActivationBindInfo(c,u)}]);return[j,j,j,j,new Ei([{trackName:"black_screen_opacity",target:d},{trackName:"black_screen_activation",target:Fi.createActivationBindInfo(m,p)}]),new Ei([{trackName:"moon_hue",target:f}]),new Ei([{trackName:"scale",target:g}]),new Ei([{trackName:"grass1_x",target:y},{trackName:"grass1_y",target:_}]),new Ei([{trackName:"grass2_x",target:b},{trackName:"grass2_y",target:v}]),new Ei([{trackName:"grass3_x",target:w},{trackName:"grass3_y",target:x}]),new Ei([{trackName:"position_y",target:C},{trackName:"rotation_z",target:S}]),new Ei([{trackName:"warp_effect_activation",target:Fi.createActivationBindInfo(E,M)},{trackName:"warp_effect_anim",target:T}]),new Ei([{trackName:"black_screen2_opacity",target:k},{trackName:"black_screen2_activation",target:Fi.createActivationBindInfo(O,D)}])]}}Wi=Fi,Fi._timeScale=1,Fi._fireworkAnimationClip=new gi([{name:"firework1",track:Si.createScalarTrack([xi.createValueType(0*Wi._timeScale,0,wi.Step),xi.createValueType(2*Wi._timeScale,1,wi.Step),xi.createValueType(4*Wi._timeScale,2,wi.Step),xi.createValueType(6*Wi._timeScale,3,wi.Step),xi.createValueType(8*Wi._timeScale,4,wi.Step),xi.createValueType(10*Wi._timeScale,5,wi.Step),xi.createValueType(12*Wi._timeScale,6,wi.Step),xi.createValueType(14*Wi._timeScale,7,wi.Step)])},{name:"firework1_activation",track:new zi([new Pi("invisible_norestore",0*Wi._timeScale),new Pi("visible",0*Wi._timeScale),new Pi("invisible",16*Wi._timeScale)])},{name:"firework2",track:Si.createScalarTrack([xi.createValueType(16*Wi._timeScale,0,wi.Step),xi.createValueType(19*Wi._timeScale,1,wi.Step),xi.createValueType(22*Wi._timeScale,2,wi.Step),xi.createValueType(25*Wi._timeScale,3,wi.Step),xi.createValueType(28*Wi._timeScale,4,wi.Step),xi.createValueType(31*Wi._timeScale,5,wi.Step),xi.createValueType(34*Wi._timeScale,6,wi.Step),xi.createValueType(37*Wi._timeScale,7,wi.Step),xi.createValueType(40*Wi._timeScale,8,wi.Step),xi.createValueType(43*Wi._timeScale,9,wi.Step),xi.createValueType(46*Wi._timeScale,10,wi.Step),xi.createValueType(49*Wi._timeScale,11,wi.Step),xi.createValueType(52*Wi._timeScale,12,wi.Step),xi.createValueType(55*Wi._timeScale,13,wi.Step),xi.createValueType(58*Wi._timeScale,14,wi.Step),xi.createValueType(61*Wi._timeScale,15,wi.Step),xi.createValueType(64*Wi._timeScale,16,wi.Step),xi.createValueType(67*Wi._timeScale,17,wi.Step)])},{name:"firework2_activation",track:new zi([new Pi("invisible_norestore",0*Wi._timeScale),new Pi("visible",16*Wi._timeScale),new Pi("invisible",70*Wi._timeScale)])},{name:"firework3",track:Si.createScalarTrack([xi.createValueType(31*Wi._timeScale,0,wi.Step),xi.createValueType(33*Wi._timeScale,1,wi.Step),xi.createValueType(35*Wi._timeScale,2,wi.Step),xi.createValueType(37*Wi._timeScale,3,wi.Step),xi.createValueType(39*Wi._timeScale,4,wi.Step),xi.createValueType(41*Wi._timeScale,5,wi.Step),xi.createValueType(43*Wi._timeScale,6,wi.Step),xi.createValueType(45*Wi._timeScale,7,wi.Step),xi.createValueType(47*Wi._timeScale,8,wi.Step),xi.createValueType(49*Wi._timeScale,9,wi.Step),xi.createValueType(51*Wi._timeScale,10,wi.Step),xi.createValueType(53*Wi._timeScale,11,wi.Step),xi.createValueType(55*Wi._timeScale,12,wi.Step),xi.createValueType(57*Wi._timeScale,13,wi.Step)])},{name:"firework3_activation",track:new zi([new Pi("invisible_norestore",0*Wi._timeScale),new Pi("visible",31*Wi._timeScale),new Pi("invisible",60*Wi._timeScale)])},{name:"firework_sphere",track:Si.createScalarTrack([xi.createValueType(45*Wi._timeScale,0,wi.Step),xi.createValueType(47*Wi._timeScale,1,wi.Step),xi.createValueType(49*Wi._timeScale,2,wi.Step),xi.createValueType(51*Wi._timeScale,3,wi.Step),xi.createValueType(53*Wi._timeScale,4,wi.Step),xi.createValueType(55*Wi._timeScale,5,wi.Step),xi.createValueType(57*Wi._timeScale,6,wi.Step),xi.createValueType(59*Wi._timeScale,7,wi.Step),xi.createValueType(61*Wi._timeScale,8,wi.Step),xi.createValueType(63*Wi._timeScale,9,wi.Step),xi.createValueType(65*Wi._timeScale,10,wi.Step),xi.createValueType(67*Wi._timeScale,11,wi.Step),xi.createValueType(69*Wi._timeScale,12,wi.Step)])},{name:"firework_sphere_activation",track:new zi([new Pi("invisible_norestore",0*Wi._timeScale),new Pi("visible",45*Wi._timeScale),new Pi("invisible",71*Wi._timeScale)])}]),Fi._blackScreenAnimationClip=new gi([{name:"black_screen_opacity",track:Si.createScalarTrack([xi.createValueType(75*Wi._timeScale,1,wi.Linear),xi.createValueType(180*Wi._timeScale,0,wi.Linear)])},{name:"black_screen_activation",track:new zi([new Pi("visible",0*Wi._timeScale),new Pi("invisible",190*Wi._timeScale)])}]),Fi._moonAnimationClip=new gi([{name:"moon_hue",track:Si.createScalarTrack([xi.createValueType(0*Wi._timeScale,0,wi.Linear),xi.createValueType(553*Wi._timeScale-75,1728,wi.Linear)])}]),Fi._zoomOutAnimationClip=new gi([{name:"scale",track:Si.createScalarTrack([xi.createValueType(0*Wi._timeScale,1,wi.Linear),xi.createValueType(384*Wi._timeScale-75,.6,wi.Cubic,0,0)])}]),Fi._grassAnimationClip=new gi([{name:"grass1_x",track:Si.createScalarTrack([xi.createValueType(392*Wi._timeScale-392,0,wi.Linear),xi.createValueType(541*Wi._timeScale-392,-40,wi.Linear)])},{name:"grass1_y",track:Si.createScalarTrack([xi.createValueType(392*Wi._timeScale-392,-17,wi.Linear),xi.createValueType(481*Wi._timeScale-392,-11,wi.Cubic,0,0)])}]),Fi._grassAnimationClip2=new gi([{name:"grass2_x",track:Si.createScalarTrack([xi.createValueType(392*Wi._timeScale-392,0,wi.Linear),xi.createValueType(541*Wi._timeScale-392,-30,wi.Linear)])},{name:"grass2_y",track:Si.createScalarTrack([xi.createValueType(392*Wi._timeScale-392,-14,wi.Linear),xi.createValueType(481*Wi._timeScale-392,-7.2,wi.Cubic,0,0)])}]),Fi._grassAnimationClip3=new gi([{name:"grass3_x",track:Si.createScalarTrack([xi.createValueType(392*Wi._timeScale-392,0,wi.Linear),xi.createValueType(541*Wi._timeScale-392,-20,wi.Linear)])},{name:"grass3_y",track:Si.createScalarTrack([xi.createValueType(392*Wi._timeScale-392,-12,wi.Linear),xi.createValueType(481*Wi._timeScale-392,-4,wi.Cubic,0,0)])}]),Fi._spaceshipAnimationClip=new gi([{name:"position_y",track:Si.createScalarTrack([xi.createValueType(372*Wi._timeScale-372,-9,wi.Linear),xi.createValueType(481*Wi._timeScale-372,-.5,wi.Cubic,0,0),xi.createValueType(540*Wi._timeScale-372,-.5,wi.Cubic,0,0),xi.createValueType(546*Wi._timeScale-372,.1,wi.Cubic,0,0),xi.createValueType(547*Wi._timeScale-372,-9,wi.Step)])},{name:"rotation_z",track:Si.createScalarTrack([xi.createValueType(540*Wi._timeScale-372,0,wi.Cubic,0,0),xi.createValueType(546*Wi._timeScale-372,-Math.PI/4/1.2,wi.Cubic,0,0)])}]),Fi._warpEffectAnimationClip=new gi([{name:"warp_effect_activation",track:new zi([new Pi("invisible_norestore",0*Wi._timeScale),new Pi("visible",547*Wi._timeScale),new Pi("invisible",558*Wi._timeScale)])},{name:"warp_effect_anim",track:Si.createScalarTrack([xi.createValueType(547*Wi._timeScale,0,wi.Linear),xi.createValueType(558*Wi._timeScale,12,wi.Linear)])}]),Fi._blackScreen2AnimationClip=new gi([{name:"black_screen2_opacity",track:Si.createScalarTrack([xi.createValueType(547*Wi._timeScale,0,wi.Linear),xi.createValueType(558*Wi._timeScale,1,wi.Linear)])},{name:"black_screen2_activation",track:new zi([new Pi("invisible",0*Wi._timeScale),new Pi("visible",547*Wi._timeScale),new Pi("visible",558*Wi._timeScale)])}]),Fi.sequance=new class{constructor(t){this.animationContainers=t;let e=Number.MAX_SAFE_INTEGER,i=0;for(let s=0;s<t.length;s++){const r=t[s],n=r.startFrame+r.offset,h=r.endFrame+r.offset;n<e&&(e=n),h>i&&(i=h)}this.startFrame=e,this.endFrame=i}createInstance(t){return new ji(this,t)}}([new Ii(Wi._fireworkAnimationClip),new Ii(Wi._fireworkAnimationClip,115*Wi._timeScale),new Ii(Wi._fireworkAnimationClip,222*Wi._timeScale),new Ii(Wi._fireworkAnimationClip,330*Wi._timeScale),new Ii(Wi._blackScreenAnimationClip),new Ii(Wi._moonAnimationClip,75*Wi._timeScale),new Ii(Wi._zoomOutAnimationClip,75*Wi._timeScale),new Ii(Wi._grassAnimationClip,392*Wi._timeScale),new Ii(Wi._grassAnimationClip2,392*Wi._timeScale),new Ii(Wi._grassAnimationClip3,392*Wi._timeScale),new Ii(Wi._spaceshipAnimationClip,372*Wi._timeScale),new Ii(Wi._warpEffectAnimationClip),new Ii(Wi._blackScreen2AnimationClip)]);const Bi=i.p+"asset/audio/498 tokio.mp3?40960bc9af6d48edab746693ae244be1";class Ni extends we{constructor(){super(...arguments),this.requiredComponents=[ke],this._camera=null,this._htmlRenderer=null,this.onScreenResize=(t,e)=>{if(this._htmlRenderer){const i=this._camera.viewSize,s=t/e;this._htmlRenderer.elementWidth=2*i*s,this._htmlRenderer.elementHeight=2*i}}}awake(){this.engine.screen.onResize.addListener(this.onScreenResize),this._camera=this.gameObject.getComponent(ke);const t=this.createRenderer(),e=this._camera.viewSize,i=this.engine.screen,s=i.width/i.height;t.elementWidth=2*e*s,t.elementHeight=2*e}createRenderer(){return this._htmlRenderer||(this._htmlRenderer=this.gameObject.addComponent(Je),this._htmlRenderer.enabled=this.enabled),this._htmlRenderer}onEnable(){this._htmlRenderer.exists&&(this._htmlRenderer.enabled=!0)}onDisable(){this._htmlRenderer.exists&&(this._htmlRenderer.enabled=!1)}onDestroy(){this.engine.screen.onResize.removeListener(this.onScreenResize),this._htmlRenderer&&(this._htmlRenderer.destroy(),this._htmlRenderer=null)}get cssHtmlElementRenderer(){return this.createRenderer()}}class Li extends class{constructor(t,e){this.H=t.instantiater,this.W=e||null,this.X=new ce(t.sceneProcessor),this.S=new me(me.createDefaultObject())}getGameSettingObject(){return Object.freeze(this.S),this.S.make()}get instantiater(){return this.H}get interopObject(){return this.W}get sceneBuilder(){return this.X}get setting(){return this.S}}{run(){const t=this.instantiater,e=new pe,i=new pe,s=new pe;return this.sceneBuilder.withChild(t.buildGameObject("camera",new st(0,0,10)).withComponent(ke,(t=>{t.viewSize=7,t.backgroundColor=new xe(0,0,0)})).withComponent(Ae,(t=>{t.text="Decoding Audio Data",t.textColor=new xe(1,1,1),t.autoSize=!0})).withComponent(Ye,(t=>{t.text="Decoding Audio Data"})).withComponent(Xe,(t=>{t.asyncSetAudioFromUrl(Bi,(()=>{t.exists&&(t.gameObject.getComponent(Ae).destroy(),t.gameObject.getComponent(Ye).destroy())}))})).withComponent(Ni,(t=>{const e=document.createElement("div");e.style.boxShadow="0 0 20px rgba(0,0,0,0.9) inset",t.cssHtmlElementRenderer.element=e})).getComponent(Xe,i)).withChild(t.buildPrefab("intro",Oi).getObjects(e).make()).withChild(t.buildGameObject("sequence_player").withComponent(Re,(t=>{const s=e.ref.fireWork1.ref,r=e.ref.fireWork2.ref,n=e.ref.fireWork3.ref,h=e.ref.fireworkSphere.ref,a=e.ref.blackScreen.ref,o=e.ref.moon.ref.filter,l=e.ref.moonGroup.ref.transform.localScale,c=e.ref.grass1.ref.transform.position,u=e.ref.grassRender1.ref,d=e.ref.grass2.ref.transform.position,m=e.ref.grassRender2.ref,p=e.ref.grass3.ref.transform.position,f=e.ref.grassRender3.ref,g=e.ref.spaceship.ref.transform.position,y=e.ref.spaceship.ref.transform.eulerAngles,_=e.ref.warpEffect.ref,b=e.ref.warpEffectAnim.ref.animationInstance,v=e.ref.blackScreen2.ref;t.animationClock=i.ref,t.setAnimationAndBind(Fi.sequance,Fi.createBindInfo((t=>s.imageIndex=t),(()=>s.enabled=!0),(()=>s.enabled=!1),(t=>r.imageIndex=t),(()=>r.enabled=!0),(()=>r.enabled=!1),(t=>n.imageIndex=t),(()=>n.enabled=!0),(()=>n.enabled=!1),(t=>h.imageIndex=t),(()=>h.enabled=!0),(()=>h.enabled=!1),(t=>a.element.style.opacity=Mi.get(t)),(()=>a.enabled=!0),(()=>a.enabled=!1),(t=>o.hueRotate=t),(t=>l.setScalar(t)),(t=>u.gradient=t),(t=>c.y=t),(t=>m.gradient=t),(t=>d.y=t),(t=>f.gradient=t),(t=>p.y=t),(t=>g.y=t),(t=>y.z=t),(()=>_.activeSelf=!0),(()=>_.activeSelf=!1),(t=>b.process(t)),(t=>v.element.style.opacity=Mi.get(t)),(()=>v.enabled=!0),(()=>v.enabled=!1))),t.frameRate=30,t.loopMode=Te.None,t.play()})).getComponent(Re,s)).withChild(t.buildGameObject("animation_control").withComponent(ze,(t=>{t.player=s.ref,t.playButton=document.getElementById("play_button"),t.slider=document.getElementById("animation_slider"),t.frameDisplayText=document.getElementById("frame_display"),t.slider.value="0"})))}}const Vi=i.p+"asset/audio/audioTest.mp3?630c76711127d96bec075e1bd74305a8";function qi(){const t=new le(document.getElementById("game_view"),!0);t.run(Li),t.inputHandler.startHandleEvents()}let Hi=new Audio(Vi);Hi.play().then((t=>{Hi.pause(),Hi.remove(),Hi=null,qi()})).catch((t=>{if(!(t instanceof DOMException&&"NotAllowedError"===t.name))throw t;{Hi.remove(),Hi=null;const t=document.createElement("button");t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.border="none",t.style.fontSize="32px",t.innerText="Play",t.onclick=()=>{t.parentElement.removeChild(t),qi()},document.body.appendChild(t)}}))})()})();